var L=Object.defineProperty;var F=(h,e,t)=>e in h?L(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var o=(h,e,t)=>F(h,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();class G{constructor(){o(this,"events");o(this,"eventHandlers");this.events=[],this.eventHandlers=new Map}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e).push(t)}off(e,t){if(this.eventHandlers.has(e)){const s=this.eventHandlers.get(e),i=s.indexOf(t);i>-1&&s.splice(i,1)}}emit(e,t){this.eventHandlers.has(e)&&this.eventHandlers.get(e).forEach(s=>{try{s(t)}catch(i){console.error(`Error in event handler for ${e}:`,i)}})}triggerRandomEvent(e){const t=["healing_wave","power_surge","defense_boost","chaos_mode","bonus_round"],s=t[Math.floor(Math.random()*t.length)];this.executeRandomEvent(s,e)}executeRandomEvent(e,t){const s=Array.from(t.values());switch(e){case"healing_wave":this.healingWaveEvent(s);break;case"power_surge":this.powerSurgeEvent(s);break;case"defense_boost":this.defenseBoostEvent(s);break;case"chaos_mode":this.chaosModeEvent(s);break;case"bonus_round":this.bonusRoundEvent(s);break}}healingWaveEvent(e){e.forEach(t=>{t.isDead||(t.health=Math.min(t.health+20,t.maxHealth),t.addEffect("heal"),window.effectsManager&&window.effectsManager.triggerHealEffect(t))}),this.emit("actionFeed",{message:"üåä Heilwelle! Alle Spieler regenerieren 20 HP!",type:"event"})}powerSurgeEvent(e){e.forEach(t=>{t.isDead||(t.addPowerCharge(1),t.addEffect("power"),window.effectsManager&&window.effectsManager.triggerPowerEffect(t))}),this.emit("actionFeed",{message:"‚ö° Kraftsto√ü! Alle Spieler erhalten +1 Power!",type:"event"})}defenseBoostEvent(e){e.forEach(t=>{t.isDead||(t.startDefense(1e4),t.addEffect("defending"),window.effectsManager&&window.effectsManager.triggerDefendEffect(t,1e4))}),this.emit("actionFeed",{message:"üõ°Ô∏è Verteidigungsboost! Alle Spieler sind 10 Sekunden gesch√ºtzt!",type:"event"})}chaosModeEvent(e){if(this.emit("chaosMode",{duration:15e3}),this.emit("actionFeed",{message:"üí• Chaos-Modus! 15 Sekunden intensiver Kampf!",type:"event"}),window.effectsManager){const s=document.querySelector(".battlefield").getBoundingClientRect();for(let i=0;i<3;i++)setTimeout(()=>{window.effectsManager.triggerExplosionEffect({x:Math.random()*s.width,y:Math.random()*s.height})},i*1e3)}}bonusRoundEvent(e){e.forEach(t=>{t.addScore(25)}),this.emit("actionFeed",{message:"üéÅ Bonus-Runde! Alle Spieler erhalten +25 Punkte!",type:"event"})}createBananaEvent(e){const t=["üçå Banana Power! Alle Spieler tanzen kurz!","üçå Eine riesige Banane schwebt √ºber dem Schlachtfeld!","üçå Bananen-Regen! Alle Spieler sind verwirrt!","üçå Monkey Mode aktiviert! Oook ook ook!","üçå Die Banane des Schicksals erscheint!","üçå Bananen-Blitz! Alle Spieler leuchten gelb!","üçå Potassium-Boost! Alle f√ºhlen sich ges√ºnder!","üçå Banana Split! Das Schlachtfeld wird rutschig!","üçå Affenalarm! Alle Spieler klettern kurz herum!"],s=t[Math.floor(Math.random()*t.length)];this.emit("actionFeed",{message:`${s} (von ${e.displayName})`,type:"banana-fun"}),this.emit("bananaEvent",{player:e})}getEventHistory(){return[...this.events]}clearEventHistory(){this.events=[]}}class O{constructor(){o(this,"battlefield");o(this,"playerElements");this.battlefield=document.getElementById("battlefield"),this.playerElements=new Map}spawnPlayer(e){this.playerElements.has(e.id)&&this.removePlayer(e.id);const t=this.createPlayerAvatar(e);this.battlefield.appendChild(t),e.element=t,this.playerElements.set(e.id,t),e.addEffect("spawn"),window.effectsManager&&window.effectsManager.triggerSpawnEffect(e),e.hasBeenAnnounced||(this.showClassAnnouncement(e),e.hasBeenAnnounced=!0)}spawnAIEnemy(e){this.playerElements.has(e.id)&&this.removePlayer(e.id);const t=this.createAIAvatar(e);this.battlefield.appendChild(t),e.element=t,this.playerElements.set(e.id,t),e.addEffect("spawn"),window.effectsManager&&window.effectsManager.triggerSpawnEffect(e)}spawnEmojiPawn(e){this.playerElements.has(e.id)&&this.removePlayer(e.id);const t=this.createEmojiAvatar(e);this.battlefield.appendChild(t),e.element=t,this.playerElements.set(e.id,t),window.effectsManager&&window.effectsManager.triggerSpawnEffect(e)}createEmojiAvatar(e){const t=document.createElement("div");t.className="emoji-pawn",t.style.position="absolute",t.style.left=e.position.x+"px",t.style.top=e.position.y+"px",t.style.width=e.size+"px",t.style.height=e.size+"px",t.style.zIndex="75",t.style.fontSize=e.size*.8+"px",t.style.display="flex",t.style.alignItems="center",t.style.justifyContent="center",t.style.borderRadius="50%",t.style.background=`radial-gradient(circle, ${e.color}80, ${e.color}40)`,t.style.border=`2px solid ${e.color}`,t.style.boxShadow=`0 0 10px ${e.color}60`,t.textContent=e.emoji,t.title=e.displayName,t.setAttribute("data-emoji-id",e.id);const s=document.createElement("div");s.className="health-bar emoji-health-bar",s.style.cssText=`
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: ${e.size}px;
      height: 4px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 2px;
      overflow: hidden;
    `;const i=document.createElement("div");return i.className="health-fill",i.style.cssText=`
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, #26de81, #20bf6b);
      transition: width 0.3s ease;
    `,s.appendChild(i),t.appendChild(s),this.updateEmojiHealth(e,t),t}updateEmojiHealth(e,t){const s=t||e.element;if(!s)return;const i=s.querySelector(".health-fill");if(i){const a=Math.max(0,e.health/e.maxHealth*100);i.style.width=a+"%",a>60?i.style.background="linear-gradient(90deg, #26de81, #20bf6b)":a>30?i.style.background="linear-gradient(90deg, #feca57, #ff9ff3)":i.style.background="linear-gradient(90deg, #ff6b6b, #ee5a6f)"}}createPlayerAvatar(e){const t=document.createElement("div");t.className="fighter-avatar",t.style.position="absolute",t.style.left=e.position.x+"px",t.style.top=e.position.y+"px",t.style.zIndex="100",t.style.background=`linear-gradient(45deg, ${e.color}, ${this.lightenColor(e.color)})`;const s=e.displayName.length>1?e.displayName.charAt(0).toUpperCase()+e.displayName.charAt(e.displayName.length-1).toLowerCase():e.displayName.substring(0,2).toUpperCase();t.textContent=s,t.style.fontWeight="900",t.style.fontSize="14px",t.style.textShadow=`
            0 0 3px rgba(0,0,0,0.8), 
            0 0 6px ${e.color}, 
            0 0 9px ${e.color}
        `;const i=this.generatePlayerBorder(e.displayName);return t.style.border=`3px ${i.type} ${i.color}`,t.style.boxShadow=`0 0 15px ${i.color}`,this.addHealthBar(t),this.addStatusBar(t,e),this.addNameLabel(t,e),this.updatePlayerTitle(e),t}createAIAvatar(e){const t=document.createElement("div");t.className="fighter-avatar ai-enemy",t.style.position="absolute",t.style.left=e.position.x+"px",t.style.top=e.position.y+"px",t.style.zIndex="50",t.style.background=`linear-gradient(45deg, ${e.color}, ${this.lightenColor(e.color)})`,t.textContent=e.displayName.substring(0,2).toUpperCase(),t.title=e.displayName+" (KI)";const s=e.getBorderStyle();return t.style.border=s.border,t.style.boxShadow=s.boxShadow,this.addHealthBar(t,e.getHealthBarColor()),t}addHealthBar(e,t=null){const s=document.createElement("div");s.className="health-bar";const i=document.createElement("div");i.className="health-fill",i.style.width="100%",t&&(i.style.background=t),s.appendChild(i),e.appendChild(s)}addStatusBar(e,t){const s=document.createElement("div");s.className="status-bar player-status-bar",s.style.cssText=`
            position: absolute;
            top: -35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px !important;
            color: white !important;
            text-align: center !important;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8) !important;
            pointer-events: none;
            background: rgba(0,0,0,0.9) !important;
            border-radius: 8px !important;
            padding: 3px 8px !important;
            white-space: nowrap !important;
            min-width: fit-content !important;
            border: 1px solid rgba(255,255,255,0.3) !important;
            font-family: 'Orbitron', monospace !important;
            font-weight: bold !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        `;const i=Math.max(0,5-(t.healsUsed||0)),a=t.powerCharge||0;s.textContent=`‚ö°${a} | üíö${i}`,e.appendChild(s)}addNameLabel(e,t){const s=document.createElement("div");s.className="player-name-label",s.textContent=t.displayName,s.style.cssText=`
            position: absolute;
            top: -55px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 9px;
            color: ${t.color};
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.9);
            pointer-events: none;
            background: rgba(0,0,0,0.7);
            border-radius: 4px;
            padding: 1px 4px;
            white-space: nowrap;
            max-width: 80px;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: bold;
            border: 1px solid ${t.color};
        `,e.appendChild(s)}updatePlayerHealth(e){if("powerCharge"in e){const t=e.element;if(!t)return;const s=t.querySelector(".health-fill");if(s){const i=Math.max(0,e.health/e.maxHealth*100);s.style.width=i+"%"}}else this.updateEmojiHealth(e)}updatePlayerTitle(e){if(!e.element)return;const t=Math.max(0,5-(e.healsUsed||0)),s=e.powerCharge||0,i=`${e.displayName} | HP: ${e.health}/${e.maxHealth} | ‚ö°${s}/5 | üíö${t}/5 | Punkte: ${e.score}`;e.element.title=i;const a=e.element.querySelector(".status-bar");a?a.textContent=`‚ö°${s} | üíö${t}`:console.warn(`[RenderSystem] Status bar not found for ${e.displayName}`);const n=e.element.querySelector(".player-name-label");if(n){const r=e.health/e.maxHealth;r<.3?(n.style.color="#ff4444",n.style.borderColor="#ff4444",n.style.animation="pulse 1s infinite"):r<.6?(n.style.color="#ffaa00",n.style.borderColor="#ffaa00",n.style.animation="none"):(n.style.color=e.color,n.style.borderColor=e.color,n.style.animation="none")}const c=e.element;e.activityCount>10?c.style.filter="drop-shadow(0 0 10px rgba(255, 215, 0, 0.6))":e.activityCount>5?c.style.filter="drop-shadow(0 0 5px rgba(255, 215, 0, 0.4))":e.activityCount>0&&(c.style.filter="none")}removePlayer(e){const t=this.playerElements.get(e);t&&(t.remove(),this.playerElements.delete(e))}updatePlayerPosition(e){e.element&&(e.element.style.left=e.position.x+"px",e.element.style.top=e.position.y+"px")}updatePlayerEffects(e){if(e.updateDefenseStatus(),e.element&&Math.random()<.1){const t={x:e.position.x+(Math.random()-.5)*20,y:e.position.y+(Math.random()-.5)*20},s=this.battlefield.getBoundingClientRect();t.x=Math.max(20,Math.min(t.x,s.width-60)),t.y=Math.max(20,Math.min(t.y,s.height-60)),e.updatePosition(t)}}clearBattlefield(){if(!this.battlefield)return;this.battlefield.querySelectorAll(".fighter-avatar").forEach(t=>t.remove()),this.playerElements.clear()}generatePlayerBorder(e){const t=this.hashCode(e),s=["solid","dashed","dotted","double"],i=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43","#a55eea","#26de81","#fd79a8","#fdcb6e","#e17055"],a=Math.abs(t)%s.length,n=Math.abs(t*7)%i.length;return{type:s[a],color:i[n]}}hashCode(e){let t=0;for(let s=0;s<e.length;s++){const i=e.charCodeAt(s);t=(t<<5)-t+i,t=t&t}return t}lightenColor(e){const t=parseInt(e.replace("#",""),16),s=44,i=(t>>16)+s,a=(t>>8&255)+s,n=(t&255)+s;return"#"+(16777216+(i<255?i<1?0:i:255)*65536+(a<255?a<1?0:a:255)*256+(n<255?n<1?0:n:255)).toString(16).slice(1)}showClassAnnouncement(e){if(!e.element||!this.battlefield)return;const t=document.createElement("div");t.className="class-announcement";const s=e.element.getBoundingClientRect(),i=this.battlefield.getBoundingClientRect(),a=s.left-i.left+s.width/2;let n=s.top-i.top-80;n<20&&(n=s.top-i.top+s.height+50),n>i.height-60&&(n=i.height-60);const c=Math.max(50,Math.min(a,i.width-50));t.style.cssText=`
            position: absolute;
            left: ${c}px;
            top: ${n}px;
            transform: translateX(-50%);
            font-family: 'Orbitron', monospace;
            font-weight: 900;
            font-size: 18px;
            color: ${e.color};
            text-shadow: 
                0 0 10px ${e.color},
                0 0 20px ${e.color},
                0 0 30px ${e.color},
                2px 2px 4px rgba(0,0,0,0.9);
            text-align: center;
            z-index: 10000;
            pointer-events: none;
            white-space: nowrap;
            opacity: 0;
            animation: classAnnouncement 3s ease-out forwards;
        `,t.textContent=e.playerClass,this.battlefield.appendChild(t),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t)},3e3)}}var m=(h=>(h.Player="Player",h.Enemy="Enemy",h.Emoji="Emoji",h.Neutral="Neutral",h))(m||{});class N{constructor(e,t,s,i){o(this,"id");o(this,"displayName");o(this,"color");o(this,"health");o(this,"maxHealth");o(this,"position");o(this,"element");o(this,"isDead");o(this,"eventSystem");o(this,"tags");this.id=e,this.displayName=t,this.color=s,this.health=i,this.maxHealth=i,this.position=this.generateRandomPosition(),this.element=null,this.isDead=!1,this.eventSystem=null,this.tags=new Set}addTag(e){this.tags.add(e)}removeTag(e){this.tags.delete(e)}hasTag(e){return this.tags.has(e)}hasAnyTag(...e){return e.some(t=>this.tags.has(t))}setEventSystem(e){this.eventSystem=e}generateRandomColor(){const e=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43","#a55eea","#26de81","#fd79a8","#fdcb6e","#e17055","#74b9ff","#0984e3","#6c5ce7","#a29bfe","#fd79a8"];return e[Math.floor(Math.random()*e.length)]}generateRandomPosition(){const e=document.getElementById("battlefield");if(!e)return{x:400,y:300};const t=e.getBoundingClientRect(),s=50;return{x:Math.random()*(t.width-2*s)+s,y:Math.random()*(t.height-2*s)+s}}updatePosition(e){this.position=e,this.element&&(this.element.style.left=e.x+"px",this.element.style.top=e.y+"px")}takeDamage(e,t){const s=this.calculateReceivedDamage(e,t);this.health=Math.max(0,this.health-s),this.eventSystem&&this.eventSystem.emit("healthUpdate",{pawn:this,health:this.health,maxHealth:this.maxHealth});const i=this.health<=0;return i&&!this.isDead&&this.onDeath(t),i}tryDamage(e,t){const s=this.calculateReceivedDamage(e,t);return this.takeDamage(s,t)}calculateReceivedDamage(e,t){return e}onDeath(e){this.kill()}gainHealth(e){const t=this.health;return this.health=Math.min(this.health+e,this.maxHealth),this.health!==t&&this.eventSystem&&this.eventSystem.emit("healthUpdate",{pawn:this,player:this,health:this.health,maxHealth:this.maxHealth}),this.health-t}kill(){this.isDead=!0,this.element&&(this.element.style.opacity="0.3",this.element.style.filter="grayscale(100%)",this.element.classList.add("dead"))}respawn(){this.health=this.maxHealth,this.position=this.generateRandomPosition(),this.isDead=!1,this.eventSystem&&this.eventSystem.emit("healthUpdate",{pawn:this,health:this.health,maxHealth:this.maxHealth}),this.element&&(this.element.style.opacity="1",this.element.style.filter="none",this.element.classList.remove("dead"),this.updatePosition(this.position))}getBasicStats(){return{id:this.id,displayName:this.displayName,health:this.health,maxHealth:this.maxHealth,isDead:this.isDead}}}class V{constructor(e){o(this,"settings");o(this,"autoAttackTimer");o(this,"gameEngine");this.settings=e,this.autoAttackTimer=null,this.gameEngine=null}setGameEngine(e){this.gameEngine=e}getAllPawns(){return this.gameEngine?[...Array.from(this.gameEngine.players.values()),...Array.from(this.gameEngine.aiEnemies.values()),...Array.from(this.gameEngine.emojiPawns.values())]:[]}executeAttack(e,t,s=null){let i=this.settings.baseDamage,a=!1;if("calculateAttackDamage"in e&&typeof e.calculateAttackDamage=="function"){const r=e,l=r.powerCharge;i=r.calculateAttackDamage(this.settings.baseDamage,!0),a=r.powerCharge<l}"handleHit"in t&&typeof t.handleHit=="function"&&(t.handleHit(e),this.gameEngine&&"powerCharge"in e&&this.gameEngine.renderSystem.updatePlayerTitle(e));const n=t.takeDamage(i,e);if("addScore"in e&&typeof e.addScore=="function"&&e.addScore(Math.floor(i)),"addEffect"in e&&typeof e.addEffect=="function"&&e.addEffect("attacking"),"addEffect"in t&&typeof t.addEffect=="function"&&t.addEffect("damaged"),window.effectsManager){const r=e,l=t;r?.element&&l?.element&&window.effectsManager.triggerAttackEffect(r,l,a)}const c={damage:Math.floor(i),wasKilled:n,attacker:e.displayName,target:t.displayName,messageData:s};if(n&&(this.handleKill(e,t,()=>this.getAllPawns()),this.gameEngine?.eventSystem&&"addKill"in e&&this.gameEngine.eventSystem.emit("elimination",{victim:t,killer:e})),"isDefenseActive"in t&&t.isDefenseActive()&&"isAI"in e&&e.isAI&&this.executeCounterAttack(t,e),this.gameEngine&&"powerCharge"in e&&"calculateAttackDamage"in e){const r=e;this.gameEngine.renderSystem.updatePlayerTitle(r),a&&console.log(`[CombatSystem] Power attack used, Power Charges remaining: ${r.powerCharge}`)}return c}executeAutoAttack(e,t){let s=this.settings.baseDamage,i=!1;if("calculateAutoAttackDamage"in e&&typeof e.calculateAutoAttackDamage=="function"){const c=e;i=c.powerCharge>0,s=c.calculateAutoAttackDamage(this.settings.baseDamage)}"handleHit"in t&&typeof t.handleHit=="function"&&(t.handleHit(e),this.gameEngine&&"powerCharge"in e&&this.gameEngine.renderSystem.updatePlayerTitle(e));const a=t.takeDamage(s,e);if("addScore"in e&&typeof e.addScore=="function"&&e.addScore(Math.floor(s*.5)),"addEffect"in e&&typeof e.addEffect=="function"&&e.addEffect("attacking"),"addEffect"in t&&typeof t.addEffect=="function"&&t.addEffect("damaged"),window.effectsManager){const c=e,r=t;c?.element&&r?.element&&window.effectsManager.triggerAttackEffect(c,r,i)}const n={damage:Math.floor(s),wasKilled:a,attacker:e.displayName,target:t.displayName,isAutoAttack:!0};return a&&(this.handleKill(e,t,()=>this.getAllPawns()),"emoji"in t&&"handleHit"in t||this.gameEngine?.eventSystem&&"addKill"in e&&this.gameEngine.eventSystem.emit("elimination",{victim:t,killer:e})),"isDefenseActive"in t&&t.isDefenseActive()&&"isAI"in e&&e.isAI&&this.executeCounterAttack(t,e),n}handleKill(e,t,s){if("addKill"in e&&typeof e.addKill=="function"&&e.addKill(),!("emoji"in t&&"handleHit"in t)&&!("isAI"in t&&t.isAI)){const i=t,a=i.isAggressiveClass();if(a&&window.effectsManager&&t.element&&s){const n=t.element.getBoundingClientRect(),r=document.getElementById("battlefield")?.getBoundingClientRect();if(!r)return;const l={x:n.left-r.left+n.width/2,y:n.top-r.top+n.height/2};if(a){const d=new Set;window.effectsManager.triggerShockwaveEffect(l,(u,f)=>{const v=s(),y=this.settings.baseDamage*.5;v.forEach(g=>{if(d.has(g.id)||g.isDead||g.id===t.id||g.health<=0)return;const x=Math.sqrt(Math.pow(g.position.x-f.x,2)+Math.pow(g.position.y-f.y,2));if(x<=u+5&&!d.has(g.id)){d.add(g.id);const S=Math.min(1,x/u),C=Math.floor(y*(1-S*.8));if(C>0){"handleHit"in g&&typeof g.handleHit=="function"&&g.handleHit(i);const A=g.takeDamage(C,i);window.effectsManager&&g.element&&window.effectsManager.createShockwaveHitEffect(g.element),"addEffect"in g&&typeof g.addEffect=="function"&&g.addEffect("damaged",500),A&&this.handleKill(i,g,s)}}})})}else window.effectsManager.triggerExplosionEffect(l)}}this.addScreenShake()}executeCounterAttack(e,t){let s=this.settings.baseDamage*.5;"calculateAttackDamage"in e&&typeof e.calculateAttackDamage=="function"&&(s=e.calculateAttackDamage(s,!1));const i=t.takeDamage(s,e);e.addScore(Math.floor(s)),setTimeout(()=>{window.effectsManager&&window.effectsManager.triggerAttackEffect(e,t,!1,!0)},300),i&&setTimeout(()=>{this.handleKill(e,t,()=>this.getAllPawns())},300)}processAutoAttacks(){if(!this.gameEngine)return[];const e=Date.now(),t=this.getAllPawns().filter(i=>!i.isDead&&i.health>0);if(t.length<2)return[];const s=[];return t.forEach(i=>{if(!this.canAutoAttack(i,e))return;const a=this.selectTargetByTags(i,t);if(a){const n=Math.random()*500;setTimeout(()=>{const c=this.executeAutoAttack(i,a);s.push(c)},n)}this.updateNextAttackTime(i,e)}),s}canAutoAttack(e,t){return e.hasAnyTag(m.Player,m.Enemy)&&"nextAutoAttack"in e?t>=e.nextAutoAttack:!1}selectTargetByTags(e,t){const s=this.getValidTargetTags(e);if(s.length===0)return null;const i=t.filter(n=>n.id!==e.id&&!n.isDead&&n.health>0&&n.hasAnyTag(...s));if(i.length===0)return null;const a=this.getTargetPriorityOrder(e);for(const n of a){const c=i.filter(r=>r.hasTag(n));if(c.length>0&&this.shouldAttack(e))return c[Math.floor(Math.random()*c.length)]}return null}getValidTargetTags(e){return e.hasTag(m.Player)?[m.Emoji,m.Enemy,m.Player]:e.hasTag(m.Enemy)?[m.Player]:[]}getTargetPriorityOrder(e){return e.hasTag(m.Player)?[m.Emoji,m.Enemy,m.Player]:e.hasTag(m.Enemy)?[m.Player]:[]}shouldAttack(e){if(!e.hasAnyTag(m.Player,m.Enemy))return!1;const t=e;if("personality"in t){const s=e.hasTag(m.Enemy)?.4:.6+t.personality*.2;return Math.random()<=s}return!1}updateNextAttackTime(e,t){if(!e.hasAnyTag(m.Player,m.Enemy)||!("nextAutoAttack"in e))return;const s=e;if(e.hasTag(m.Enemy)&&"updateNextAttackTime"in e&&typeof e.updateNextAttackTime=="function"){e.updateNextAttackTime();return}if("autoAttackInterval"in s&&"activityCount"in s&&"personality"in s){const i=s.autoAttackInterval||2e3,a=Math.max(.3,1-s.activityCount*.01),n=s.personality>.7?.5:.7;s.nextAutoAttack=t+i*a*n}}addScreenShake(){const e=document.querySelector(".game-container");e&&(e.classList.add("screen-shake"),setTimeout(()=>{e.classList.remove("screen-shake")},500))}startAutoAttackSystem(e){this.stopAutoAttackSystem(),this.autoAttackTimer=setInterval(()=>{const t=this.processAutoAttacks();e&&t.length>0&&e(t)},1e3)}stopAutoAttackSystem(){this.autoAttackTimer&&(clearInterval(this.autoAttackTimer),this.autoAttackTimer=null)}}class K{constructor(e){o(this,"settings");o(this,"currentWave");o(this,"nextWaveTime");o(this,"waveTimer");o(this,"waveTimerDisplay");o(this,"isActive");o(this,"eventSystem");o(this,"gameEngine");this.settings=e,this.currentWave=1,this.nextWaveTime=null,this.waveTimer=null,this.waveTimerDisplay=null,this.isActive=!1,this.eventSystem=null,this.gameEngine=null}setEventSystem(e){this.eventSystem=e}setGameEngine(e){this.gameEngine=e}start(){this.isActive=!0,this.currentWave=0,this.nextWaveTime=null,this.updateWaveDisplay(),this.updateWaveTimer(),this.waveTimer=setInterval(()=>{this.checkWaveStartCondition(),this.checkAndProcessWave()},100),this.waveTimerDisplay=setInterval(()=>{this.updateWaveTimer()},1e3)}checkWaveStartCondition(){this.currentWave!==0||this.nextWaveTime!==null||this.gameEngine?.players?.size>0&&(console.log("[WaveSystem] Player detected, starting 5 second countdown to wave 1"),this.nextWaveTime=Date.now()+5e3,this.updateWaveTimer())}stop(){this.isActive=!1,this.waveTimer&&(clearInterval(this.waveTimer),this.waveTimer=null),this.waveTimerDisplay&&(clearInterval(this.waveTimerDisplay),this.waveTimerDisplay=null)}checkAndProcessWave(){!this.isActive||!this.nextWaveTime||(Date.now()>=this.nextWaveTime?this.nextWave():this.recalculateWaveTimerIfNeeded())}recalculateWaveTimerIfNeeded(){if(!this.nextWaveTime||this.currentWave===0)return;const e=Array.from(this.gameEngine?.players?.values()||[]).filter(a=>!a.isDead&&a.health>0),t=Array.from(this.gameEngine?.aiEnemies?.values()||[]).filter(a=>!a.isDead&&a.health>0),s=e.length===1&&t.length===0,i=this.nextWaveTime-Date.now()<=5500;if(s&&!i){const a=Date.now(),n=this.nextWaveTime-a;if(n>1e4){const c=this.settings.waveInterval-n;this.nextWaveTime=a+Math.max(5e3-c,1e3),console.log(`[WaveSystem] Adjusted wave timer from ${Math.ceil(n/1e3)}s to ${Math.ceil((this.nextWaveTime-a)/1e3)}s`),this.updateWaveTimer()}}}processWave(){this.isActive&&this.nextWave()}nextWave(){this.currentWave++;const e={waveNumber:this.currentWave,difficultyIncrease:{baseDamage:2,baseHealth:10}};this.eventSystem&&this.eventSystem.emit("waveStart",e);let t=this.settings.waveInterval;return this.gameEngine&&this.gameEngine.players&&this.gameEngine.players.size===1&&(this.gameEngine.aiEnemies&&Array.from(this.gameEngine.aiEnemies.values()).some(i=>!i.isDead&&i.health>0)||(t=5e3)),this.nextWaveTime=Date.now()+t,this.updateWaveDisplay(),this.updateWaveTimer(),this.settings.baseDamage+=2,this.settings.baseHealth+=10,e}updateWaveDisplay(){const e=document.getElementById("waveNumber");e&&(e.textContent=this.currentWave.toString())}updateWaveTimer(){const e=document.getElementById("waveTimer");if(!e)return;if(!this.isActive){e.textContent="--";return}if(this.currentWave===0&&!this.nextWaveTime){e.textContent="Warte auf Spieler...",e.style.color="#ffc107",e.style.textShadow="0 0 10px rgba(255, 193, 7, 0.5)";return}if(!this.nextWaveTime){e.textContent="--";return}const t=Date.now(),s=Math.max(0,this.nextWaveTime-t),i=Math.ceil(s/1e3);this.updateTimerDisplay(e,i)}updateTimerDisplay(e,t){t<=0?e.textContent="0s":t<=10?(e.style.color="#ff4444",e.style.textShadow="0 0 10px rgba(255, 68, 68, 0.8)",e.textContent=`${t}s`):t<=30?(e.style.color="#ff8800",e.style.textShadow="0 0 10px rgba(255, 136, 0, 0.8)",e.textContent=`${t}s`):(e.style.color="#ffc107",e.style.textShadow="0 0 10px rgba(255, 193, 7, 0.5)",e.textContent=`${t}s`)}getCurrentWave(){return this.currentWave}getTimeToNextWave(){return this.nextWaveTime?Math.max(0,this.nextWaveTime-Date.now()):0}setNextWaveTime(e){this.nextWaveTime=e,this.updateWaveTimer()}isWaveActive(){return this.isActive}forceNextWave(){return this.isActive?this.nextWave():null}getWaveInfo(){return{currentWave:this.currentWave,nextWaveTime:this.nextWaveTime,timeToNextWave:this.getTimeToNextWave(),isActive:this.isActive}}}class q{constructor(){o(this,"actionFeed");o(this,"leaderboard");o(this,"activeViewers");o(this,"gameOverBanner");this.actionFeed=document.getElementById("actionFeed"),this.leaderboard=document.getElementById("leaderboard"),this.activeViewers=document.getElementById("activeViewers"),this.gameOverBanner=null}updateActiveViewers(e,t){this.activeViewers&&(this.activeViewers.textContent=`${e} (${t} KI)`)}updateLeaderboard(e){if(!this.leaderboard)return;const t=Array.from(e.values()).sort((s,i)=>i.score-s.score).slice(0,5);this.leaderboard.innerHTML="",t.forEach((s,i)=>{const a=document.createElement("div");a.className="leaderboard-item";const n=document.createElement("span");n.className="player-rank",n.textContent=`#${i+1}`;const c=document.createElement("span");c.className="player-name",c.textContent=s.displayName,c.style.color=s.color;const r=document.createElement("span");r.className="player-score",r.textContent=s.score.toString(),a.appendChild(n),a.appendChild(c),a.appendChild(r),this.leaderboard.appendChild(a)})}addActionToFeed(e,t){if(!this.actionFeed)return;const s=document.createElement("div");s.className=`action-item ${t}`,s.textContent=e,s.style.opacity="0",this.actionFeed.insertBefore(s,this.actionFeed.firstChild),setTimeout(()=>{s.style.opacity="1"},10);const i=this.actionFeed.querySelectorAll(".action-item");i.length>50&&i[i.length-1].remove()}showGameOverBanner(e){this.removeGameOverBanner();let t="";e.length>0&&(t=`
                <div class="game-over-leaderboard">
                    <h3 class="leaderboard-title">üèÜ TOP SPIELER</h3>
                    <div class="top-players">
                        ${e.map((i,a)=>`
                            <div class="top-player rank-${a+1}">
                                <span class="player-rank">${a===0?"ü•á":a===1?"ü•à":"ü•â"}</span>
                                <span class="player-name" style="color: ${i.color};">${i.displayName}</span>
                                <span class="player-score">${i.score} Punkte</span>
                            </div>
                        `).join("")}
                    </div>
                </div>
            `);const s=document.createElement("div");s.id="gameOverBanner",s.className="game-over-banner",s.innerHTML=`
            <div class="game-over-content">
                <h1 class="game-over-title">GAME OVER</h1>
                <p class="game-over-subtitle">Alle Spieler wurden besiegt!</p>
                ${t}
                <div class="game-over-timer">
                    <span class="timer-text">Neues Spiel in:</span>
                    <span class="timer-count" id="gameOverTimer">10</span>
                </div>
            </div>
        `,document.body.appendChild(s),this.gameOverBanner=s,this.startGameOverCountdown()}startGameOverCountdown(){let e=10;const t=document.getElementById("gameOverTimer"),s=setInterval(()=>{e--,t&&(t.textContent=e.toString()),e<=0&&clearInterval(s)},1e3)}removeGameOverBanner(){this.gameOverBanner&&(this.gameOverBanner.remove(),this.gameOverBanner=null);const e=document.getElementById("gameOverBanner");e&&e.remove()}addScreenShake(){const e=document.querySelector(".game-container");e&&(e.classList.add("screen-shake"),setTimeout(()=>{e.classList.remove("screen-shake")},500))}addBananaShake(){const e=document.querySelector(".game-container");e&&(e.classList.add("banana-shake"),setTimeout(()=>{e.classList.remove("banana-shake")},1500))}createBananaRain(){const e=document.getElementById("battlefield");if(!e)return;const t=e.getBoundingClientRect(),s=15+Math.floor(Math.random()*6);for(let i=0;i<s;i++)setTimeout(()=>{const a=document.createElement("div");a.className="falling-banana",a.textContent="üçå",a.style.cssText=`
                    position: absolute;
                    font-size: ${20+Math.random()*15}px;
                    left: ${Math.random()*t.width}px;
                    top: -50px;
                    pointer-events: none;
                    z-index: 1000;
                    animation: bananaFall ${2+Math.random()*2}s linear forwards;
                    transform: rotate(${Math.random()*360}deg);
                `,e.appendChild(a),setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},4e3)},i*100)}showNotification(e,t="info",s=3e3){const i=document.createElement("div");i.className=`notification ${t}`,i.textContent=e,i.style.cssText=`
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 10000;
            font-family: 'Orbitron', monospace;
            font-weight: bold;
            border-left: 4px solid ${t==="error"?"#ff4444":t==="warning"?"#ffaa00":"#00ff00"};
            animation: slideInRight 0.3s ease-out;
        `,document.body.appendChild(i),setTimeout(()=>{i.style.animation="slideOutRight 0.3s ease-in",setTimeout(()=>{i.parentNode&&i.parentNode.removeChild(i)},300)},s)}updateConnectionStatus(e){const t=document.getElementById("connectionStatus");if(t){const s=t.querySelector(".status-dot"),i=t.querySelector("span:last-child");s&&i&&(e?(s.style.backgroundColor="#00ff00",i.textContent="Verbunden",t.style.color="#00ff00"):(s.style.backgroundColor="#ff4444",i.textContent="Getrennt",t.style.color="#ff4444"))}}showPlayerStats(e){const t=e.getStats(),s=t.remainingHeals,i=`üìä ${t.displayName}: HP ${t.health}/${t.maxHealth}, Power ${t.powerCharge}/5, Heilungen ${s}/5, Punkte ${t.score}, Siege ${t.kills}`;this.addActionToFeed(i,"stats")}clearActionFeed(){this.actionFeed&&(this.actionFeed.innerHTML="")}highlightPlayer(e){const t=document.querySelector(`[data-player-id="${e}"]`);t&&(t.classList.add("highlighted"),setTimeout(()=>{t.classList.remove("highlighted")},2e3))}}class T{constructor(){o(this,"entity",null)}_setEntity(e){this.entity=e}getEntity(){if(!this.entity)throw new Error(`Component ${this.componentType} is not attached to an entity`);return this.entity}}class U{constructor(){o(this,"components",new Map);o(this,"entity",null)}setEntity(e){this.entity=e}addComponent(e){if(this.components.has(e.componentType))throw new Error(`Component ${e.componentType} already exists on entity`);if(e instanceof T){const t=this.entity||this;e._setEntity(t)}this.components.set(e.componentType,e),e.onAttach&&e.onAttach()}removeComponent(e){const t=this.components.get(e);return t?(t.onDetach&&t.onDetach(),t instanceof T&&t._setEntity(null),this.components.delete(e)):!1}getComponent(e){return this.components.get(e)}hasComponent(e){return this.components.has(e)}updateComponents(e){for(const t of this.components.values())t.update&&t.update(e)}getAllComponents(){return Array.from(this.components.values())}}class M extends N{constructor(t,s,i,a,n){super(t,s,i,a);o(this,"componentContainer");o(this,"score");o(this,"kills");o(this,"deaths");o(this,"powerCharge");o(this,"healsUsed");o(this,"isDefending");o(this,"defenseEndTime");o(this,"lastCommand");o(this,"commandCooldowns");o(this,"lastActivity");o(this,"activityCount");o(this,"nextAutoAttack");o(this,"autoAttackInterval");o(this,"personality");o(this,"isAI");o(this,"playerClass");o(this,"hasBeenAnnounced");o(this,"effects");o(this,"defenseReduction");this.componentContainer=new U,"setEntity"in this.componentContainer&&typeof this.componentContainer.setEntity=="function"&&this.componentContainer.setEntity(this),this.score=0,this.kills=0,this.deaths=0,this.powerCharge=0,this.healsUsed=0,this.isDefending=!1,this.defenseEndTime=0,this.lastCommand=Date.now(),this.commandCooldowns=new Map,this.lastActivity=Date.now(),this.activityCount=0,this.nextAutoAttack=Date.now()+Math.random()*2e3,this.autoAttackInterval=1e3+Math.random()*2e3,this.personality=Math.random(),this.isAI=!1,this.playerClass=this.determinePlayerClass(),this.hasBeenAnnounced=!1,this.effects=new Set,this.defenseReduction=n.defenseReduction}determinePlayerClass(){if(this.personality>=.7){const t=["Krieger","K√§mpfer","Berserker"];return t[Math.floor(Math.random()*t.length)]}else if(this.personality<.3){const t=["W√§chter","Tank","Paladin"];return t[Math.floor(Math.random()*t.length)]}else{const t=["Scout","Ninja","Sch√ºtze"];return t[Math.floor(Math.random()*t.length)]}}isAggressiveClass(){return["Krieger","K√§mpfer","Berserker"].includes(this.playerClass)}calculateReceivedDamage(t,s){let i=t;return this.isDefenseActive()&&(i*=this.defenseReduction),i}onDeath(t){this.kill(),t&&"addKill"in t&&typeof t.addKill=="function"&&t.addKill()}calculateAttackDamage(t,s=!1){let i=t;const a=1+this.activityCount*.05;if(i=Math.floor(i*a),s&&this.powerCharge>0){const n=this.usePower();n!==!1&&n>0&&(i*=1+n*.5)}return Math.floor(i)}calculateAutoAttackDamage(t){let s=Math.floor(t*(.5+Math.random()*.8));const i=1+this.activityCount*.05;return s=Math.floor(s*i),this.powerCharge>0&&(s*=1+this.powerCharge*.3,Math.random()<.5&&(this.powerCharge=Math.max(0,this.powerCharge-1))),Math.floor(s)}attack(t,s,i=!1){const a=this.powerCharge,n=i&&a>0,c=this.calculateAttackDamage(s,i),r=this.powerCharge,l=n&&r<a;"handleHit"in t&&typeof t.handleHit=="function"&&t.handleHit(this);const d=t.tryDamage(c,this);if(!d&&"addScore"in this&&typeof this.addScore=="function"&&this.addScore(Math.floor(c*(l?.5:.3))),this.addEffect("attacking"),"addEffect"in t&&typeof t.addEffect=="function"&&t.addEffect("damaged"),this.element&&t.element&&window.effectsManager&&window.effectsManager.triggerAttackEffect(this,t,l),!d&&t instanceof M){const u=t;u.isDefenseActive()&&this.executeCounterAttack(u,this,s)}return{damage:c,wasKilled:d,isPowerAttack:l}}executeCounterAttack(t,s,i){const a=Math.floor(i*.5);setTimeout(()=>{const n=t.attack(s,a,!1);t.eventSystem&&t.eventSystem.emit("actionFeed",{message:`üí• ${t.displayName} startet einen Gegenangriff auf ${s.displayName}!`,type:"counter-attack"}),n.wasKilled&&t.eventSystem&&t.eventSystem.emit("elimination",{victim:s,killer:t}),t.element&&window.effectsManager&&window.effectsManager.triggerAttackEffect(t,s,!1,!0)},300)}heal(t){return this.healsUsed>=5?!1:(this.healsUsed++,this.gainHealth(t)>0)}usePower(){if(this.powerCharge<=0)return!1;const t=this.powerCharge;return this.powerCharge--,t}addPowerCharge(t=1){this.powerCharge=Math.min(this.powerCharge+t,5)}startDefense(t=5e3){this.isDefending=!0,this.defenseEndTime=Date.now()+t,this.element&&this.element.classList.add("defending")}isDefenseActive(){return this.isDefending&&Date.now()<this.defenseEndTime}updateDefenseStatus(){this.isDefending&&Date.now()>this.defenseEndTime&&(this.isDefending=!1,this.element&&this.element.classList.remove("defending"))}kill(){super.kill(),this.deaths++}respawn(){super.respawn(),this.isDefending=!1,this.defenseEndTime=0,this.powerCharge=0,this.healsUsed=0,this.nextAutoAttack=Date.now()+Math.random()*3e3}addScore(t){this.score+=t,this.eventSystem&&this.eventSystem.emit("scoreUpdate",{character:this,score:this.score,points:t})}addKill(){this.kills++,this.score+=50,this.eventSystem&&this.eventSystem.emit("scoreUpdate",{character:this,score:this.score,points:50})}addEffect(t,s=1e4){this.element&&(this.effects.add(t),this.element.classList.add(t),setTimeout(()=>{this.effects.delete(t),this.element&&this.element.classList.remove(t)},s))}getStats(){return{id:this.id,displayName:this.displayName,health:this.health,maxHealth:this.maxHealth,score:this.score,kills:this.kills,deaths:this.deaths,powerCharge:this.powerCharge,healsUsed:this.healsUsed,remainingHeals:5-this.healsUsed,isDefending:this.isDefenseActive(),isDead:this.isDead}}updateActivity(){this.lastActivity=Date.now(),this.activityCount++}isInactive(t=3e5){return Date.now()-this.lastActivity>t}addComponent(t){this.componentContainer.addComponent(t)}removeComponent(t){return this.componentContainer.removeComponent(t)}getComponent(t){return this.componentContainer.getComponent(t)}hasComponent(t){return this.componentContainer.hasComponent(t)}updateComponents(t){this.componentContainer.updateComponents(t)}}class H extends T{constructor(t){super();o(this,"componentType","AutoCombat");o(this,"config");o(this,"character",null);o(this,"nextAttackTime",0);o(this,"gameEngine",null);this.config=t}onAttach(){try{this.character=this.getEntity(),this.nextAttackTime=Date.now()+Math.random()*this.config.attackInterval+1e3}catch{setTimeout(()=>{try{this.character=this.getEntity(),this.nextAttackTime=Date.now()+Math.random()*this.config.attackInterval+1e3}catch{}},10)}}setGameEngine(t){this.gameEngine=t}update(t){if(!this.character)try{this.character=this.getEntity(),this.nextAttackTime===0&&(this.nextAttackTime=Date.now()+Math.random()*this.config.attackInterval)}catch{return}if(!this.config.canAutoAttack||!this.gameEngine||!this.character)return;const s=Date.now();if(s<this.nextAttackTime||this.character.isDead||this.character.health<=0)return;const i=this.findTarget();if(!i){this.nextAttackTime=s+this.config.attackInterval*.5;return}if(!this.character)return;if(!this.shouldAttack()){this.nextAttackTime=s+this.config.attackInterval*.3;return}if(!this.character)try{this.character=this.getEntity()}catch{return}if(!this.character||!i||!this.gameEngine)return;const a=this.gameEngine.settings.baseDamage,n=this.character.powerCharge>0;if(this.character.attack(i,a,n),this.gameEngine.renderSystem.updatePlayerTitle(this.character),"health"in i&&"maxHealth"in i){const c=i;this.gameEngine.renderSystem.updatePlayerHealth(c)}this.updateNextAttackTime(s)}findTarget(){if(!this.gameEngine||!this.character){if(!this.character)try{this.character=this.getEntity()}catch{return null}if(!this.character||!this.gameEngine)return null}const s=this.getAllPawns().filter(i=>{if(!this.character)return!1;const a=i.id===this.character.id,n=!i.isDead&&i.health>0,c=this.isEnemy(i);return!a&&n&&c});if(s.length===0)return null;for(const i of this.config.targetPriority){const a=s.filter(n=>n.hasTag(i));if(a.length>0)return a[Math.floor(Math.random()*a.length)]}return s[Math.floor(Math.random()*s.length)]}isEnemy(t){return this.config.enemyTags.some(s=>t.hasTag(s))}shouldAttack(){if(!this.character)return!1;const t=this.character.personality??.5,s=this.config.aggressiveness??.5,i=t*.5+s*.5;return Math.random()<i}updateNextAttackTime(t){const s=this.config.attackInterval*.2,i=this.config.attackInterval+(Math.random()*2-1)*s;this.nextAttackTime=t+i}getAllPawns(){if(!this.gameEngine)return[];const t=[];return this.gameEngine.players.forEach(s=>t.push(s)),this.gameEngine.aiEnemies.forEach(s=>t.push(s)),this.gameEngine.emojiPawns.forEach(s=>t.push(s)),t}getConfig(){return this.config}updateConfig(t){this.config={...this.config,...t}}}class R extends M{constructor(e,t,s){const i=t||{},a=i.displayName||i.username||e||"Unknown Player",n=new N(e,"","",0),c=i.color||n.generateRandomColor();super(e,a,c,s.baseHealth,s),this.isAI=!1,this.addTag(m.Player);const r=new H({enemyTags:[m.Emoji,m.Enemy,m.Player],targetPriority:[m.Emoji,m.Enemy,m.Player],attackInterval:this.autoAttackInterval,aggressiveness:this.personality,canAutoAttack:!0});this.addComponent(r)}}class j{execute(e,t,s){const{gameEngine:i}=s;if(i.players.has(e)){i.eventSystem.emit("actionFeed",{message:`${t.displayName} ist bereits im Spiel!`,type:"error"});return}if(i.players.size>=i.settings.maxPlayers){i.eventSystem.emit("actionFeed",{message:`Spiel ist voll! Maximal ${i.settings.maxPlayers} Spieler.`,type:"error"});return}const a=new R(e,t,i.settings);a.setEventSystem(i.eventSystem),console.log("Created player:",a.displayName,"from messageData:",t),i.players.set(e,a),i.renderSystem.spawnPlayer(a);const n=a.getComponent("AutoCombat");n&&n.setGameEngine(i),i.eventSystem.emit("actionFeed",{message:`‚öîÔ∏è ${a.displayName} ist dem Kampf beigetreten! (${a.playerClass})`,type:"join"}),i.updateActiveViewers()}}class X{execute(e,t,s){const{gameEngine:i,commandHandler:a}=s,n=i.players.get(e);if(!n){a.executeCommand("join",e,t,s);return}if(n.isDead||n.health<=0){i.eventSystem.emit("actionFeed",{message:`${t.displayName} kann nicht verteidigen - wartet auf Respawn!`,type:"error"});return}const c=Date.now(),r=8e3,l=n.commandCooldowns.get("defend")||0;if(c-l<r){const d=Math.ceil((r-(c-l))/1e3);i.eventSystem.emit("actionFeed",{message:`${t.displayName} - Verteidigung noch ${d}s im Cooldown!`,type:"error"});return}n.commandCooldowns.set("defend",c),n.lastCommand=c,n.startDefense(1e4),n.addEffect("defending",1e4),window.effectsManager&&window.effectsManager.triggerDefendEffect(n,1e4),i.eventSystem.emit("actionFeed",{message:`üõ°Ô∏è ${t.displayName} aktiviert Verteidigung!`,type:"defend"})}}class Y{execute(e,t,s){const{gameEngine:i,commandHandler:a}=s,n=i.players.get(e);if(!n){a.executeCommand("join",e,t,s);return}if(n.isDead||n.health<=0){i.eventSystem.emit("actionFeed",{message:`${t.displayName} kann nicht aufladen - wartet auf Respawn!`,type:"error"});return}const c=Date.now(),r=5e3,l=n.commandCooldowns.get("power")||0;if(c-l<r){const d=Math.ceil((r-(c-l))/1e3);i.eventSystem.emit("actionFeed",{message:`${t.displayName} - Power-Aufladung noch ${d}s im Cooldown!`,type:"error"});return}n.commandCooldowns.set("power",c),n.lastCommand=c,n.powerCharge=5,n.addEffect("power"),i.renderSystem.updatePlayerTitle(n),window.effectsManager&&window.effectsManager.triggerPowerEffect(n),i.eventSystem.emit("actionFeed",{message:`‚ö° ${t.displayName} l√§dt Spezialattacke! (${n.powerCharge}/5)`,type:"power"})}}class _{execute(e,t,s){const{gameEngine:i,commandHandler:a}=s,n=i.players.get(e);if(!n){a.executeCommand("join",e,t,s);return}if(n.isDead||n.health<=0){i.eventSystem.emit("actionFeed",{message:`${t.displayName} kann nicht heilen - wartet auf Respawn!`,type:"error"});return}if(n.healsUsed>=5){i.eventSystem.emit("actionFeed",{message:`${t.displayName} hat alle Heilungen aufgebraucht! (5/5 verwendet)`,type:"error"});return}const c=Date.now(),r=3e3,l=n.commandCooldowns.get("heal")||0;if(c-l<r){const f=Math.ceil((r-(c-l))/1e3);i.eventSystem.emit("actionFeed",{message:`${t.displayName} - Heilung noch ${f}s im Cooldown!`,type:"error"});return}n.commandCooldowns.set("heal",c),n.lastCommand=c;const d=i.settings.healAmount;if(n.heal(d)){i.renderSystem.updatePlayerHealth(n),i.renderSystem.updatePlayerTitle(n),n.addEffect("heal"),window.effectsManager&&window.effectsManager.triggerHealEffect(n);const f=5-n.healsUsed;i.eventSystem.emit("actionFeed",{message:`üíö ${t.displayName} heilt sich um ${d} HP! (${f} Heilungen √ºbrig)`,type:"heal"}),i.gameStats.totalHeals++}}}class Q{execute(e,t,s){const{gameEngine:i}=s,a=i.players.get(e);if(!a){i.eventSystem.emit("actionFeed",{message:`${t.displayName} ist nicht im Spiel!`,type:"error"});return}i.uiSystem.showPlayerStats(a)}}class z extends N{constructor(t,s,i,a,n,c,r,l=[m.Emoji]){super(t,i,n,a);o(this,"emoji");o(this,"size");o(this,"behavior");o(this,"movementSpeed");o(this,"movementTarget");o(this,"lastMovementUpdate");o(this,"movementInterval");this.emoji=s,this.size=c,this.behavior=r,this.movementSpeed=r.movementSpeed||0,this.movementTarget=null,this.lastMovementUpdate=Date.now(),this.movementInterval=100,l.forEach(d=>this.addTag(d))}kill(){super.kill()}handleHit(t){this.behavior.onHit&&this.behavior.onHit(this,t)}updateMovement(t){if(!this.element||this.isDead)return;const s=Date.now();if(!(s-this.lastMovementUpdate<this.movementInterval)&&(this.lastMovementUpdate=s,this.movementSpeed!==0))switch(this.behavior.movementPattern){case"random":this.moveRandom();break;case"follow":this.moveTowardsClosest(t);break;case"flee":this.moveAwayFromClosest(t);break}}moveRandom(){const t={x:(Math.random()-.5)*this.movementSpeed*2,y:(Math.random()-.5)*this.movementSpeed*2},s={x:this.position.x+t.x,y:this.position.y+t.y},i=document.getElementById("battlefield");if(i){const a=i.getBoundingClientRect();s.x=Math.max(20,Math.min(s.x,a.width-this.size-20)),s.y=Math.max(20,Math.min(s.y,a.height-this.size-20))}this.updatePosition(s)}moveTowardsClosest(t){if(t.length===0)return;const s=t.reduce((c,r)=>{if(r.isDead||r.health<=0)return c;const l=this.getDistanceTo(r.position),d=c?this.getDistanceTo(c.position):1/0;return l<d?r:c},null);if(!s)return;const i=s.position.x-this.position.x,a=s.position.y-this.position.y,n=Math.sqrt(i*i+a*a);if(n>this.size){const c=i/n*this.movementSpeed,r=a/n*this.movementSpeed,l={x:this.position.x+c,y:this.position.y+r},d=document.getElementById("battlefield");if(d){const u=d.getBoundingClientRect();l.x=Math.max(20,Math.min(l.x,u.width-this.size-20)),l.y=Math.max(20,Math.min(l.y,u.height-this.size-20))}this.updatePosition(l)}}moveAwayFromClosest(t){if(t.length===0)return;const s=t.reduce((c,r)=>{if(r.isDead||r.health<=0)return c;const l=this.getDistanceTo(r.position),d=c?this.getDistanceTo(c.position):1/0;return l<d?r:c},null);if(!s)return;const i=this.position.x-s.position.x,a=this.position.y-s.position.y,n=Math.sqrt(i*i+a*a);if(n>0){const c=i/n*this.movementSpeed,r=a/n*this.movementSpeed,l={x:this.position.x+c,y:this.position.y+r},d=document.getElementById("battlefield");if(d){const u=d.getBoundingClientRect();l.x=Math.max(20,Math.min(l.x,u.width-this.size-20)),l.y=Math.max(20,Math.min(l.y,u.height-this.size-20))}this.updatePosition(l)}}getDistanceTo(t){const s=this.position.x-t.x,i=this.position.y-t.y;return Math.sqrt(s*s+i*i)}onDeath(t){if(super.onDeath(t),this.behavior.onDeath){const s=t&&"addKill"in t?t:void 0;this.behavior.onDeath(this,s)}this.behavior.autoRemoveOnDeath!==!1&&setTimeout(()=>{this.removeSelf()},2e3)}removeSelf(){this.eventSystem&&this.eventSystem.emit("emojiPawnDeath",{pawnId:this.id,pawn:this})}}const w=class w extends z{constructor(e,t,s,i){const a=Math.floor(t*w.HEALTH_MULTIPLIER),n={movementPattern:"random",movementSpeed:1,autoRemoveOnDeath:!0,onHit:(r,l)=>{l&&!l.isDead&&(l.addPowerCharge(2),r.eventSystem&&r.eventSystem.emit("actionFeed",{message:`üêµ ${l.displayName} hat Power Charge vom Affen erhalten!`,type:"power"}))}},c=i||[m.Emoji];super(e,w.EMOJI,w.DISPLAY_NAME,a,w.COLOR,w.SIZE,n,c),s&&this.setEventSystem(s)}};o(w,"HEALTH_MULTIPLIER",.3),o(w,"EMOJI","üêµ"),o(w,"DISPLAY_NAME","Wilder Affe"),o(w,"COLOR","#8B4513"),o(w,"SIZE",50);let k=w;const b=class b extends z{constructor(e,t,s,i){const a=Math.floor(t*b.HEALTH_MULTIPLIER),n={movementPattern:"static",autoRemoveOnDeath:!0,onHit:(r,l)=>{l&&!l.isDead&&(l.addPowerCharge(2),l.gainHealth(10),r.eventSystem&&r.eventSystem.emit("actionFeed",{message:`‚ö° ${l.displayName} hat Power Charge erhalten!`,type:"power"}))}},c=i||[m.Emoji];super(e,b.EMOJI,b.DISPLAY_NAME,a,b.COLOR,b.SIZE,n,c),s&&this.setEventSystem(s)}};o(b,"HEALTH_MULTIPLIER",.15),o(b,"EMOJI","üçå"),o(b,"DISPLAY_NAME","Bananen-Power"),o(b,"COLOR","#FFD700"),o(b,"SIZE",35);let D=b;class J{execute(e,t,s){const{gameEngine:i}=s,a=i.players.get(e);i.eventSystem.createBananaEvent(a||{displayName:t.displayName}),i.uiSystem.addBananaShake(),i.uiSystem.createBananaRain();const n=2+Math.floor(Math.random()*3);for(let r=0;r<n;r++){const l=`emoji_monkey_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=new k(l,i.settings.baseHealth,i.eventSystem);i.addEmojiPawn(d)}const c=1+Math.floor(Math.random()*3);for(let r=0;r<c;r++){const l=`emoji_banana_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,d=new D(l,i.settings.baseHealth,i.eventSystem);i.addEmojiPawn(d)}if(i.players.forEach(r=>{if(r.element){r.addEffect("banana-glow",5e3),r.gainHealth(10),r.addPowerCharge(1),i.renderSystem.updatePlayerTitle(r);const l={x:(Math.random()-.5)*30,y:(Math.random()-.5)*30},d={...r.position};r.position.x+=l.x,r.position.y+=l.y;const f=document.getElementById("battlefield").getBoundingClientRect();r.position.x=Math.max(20,Math.min(r.position.x,f.width-60)),r.position.y=Math.max(20,Math.min(r.position.y,f.height-60)),i.renderSystem.updatePlayerPosition(r),setTimeout(()=>{r.updatePosition(d)},2e3)}}),window.effectsManager){const l=document.getElementById("battlefield").getBoundingClientRect();for(let d=0;d<3;d++)setTimeout(()=>{window.effectsManager.triggerExplosionEffect({x:Math.random()*l.width,y:Math.random()*l.height})},d*400)}}}class Z{execute(e,t,s){const{gameEngine:i,commandHandler:a}=s;let n=i.players.get(e);if(n||(a.executeCommand("join",e,t,s),n=i.players.get(e)),!n||(n.addScore(i.settings.chatActivityReward),n.updateActivity(),n.isDead||n.health<=0))return;const c=Math.min(.15,.05+n.activityCount*.002);if(Math.random()<c){const r=Math.random();r<.4&&n.health<n.maxHealth?(n.health=Math.min(n.health+5,n.maxHealth),n.addEffect("heal"),i.renderSystem.updatePlayerHealth(n),i.eventSystem.emit("actionFeed",{message:`üíö ${t.displayName} regeneriert durch Chat-Aktivit√§t! (+5 HP)`,type:"activity-bonus"})):r<.7?(n.addPowerCharge(1),n.addEffect("power"),i.renderSystem.updatePlayerTitle(n),i.eventSystem.emit("actionFeed",{message:`‚ö° ${t.displayName} sammelt Energie! (+1 Power)`,type:"activity-bonus"})):(n.addScore(10),i.eventSystem.emit("actionFeed",{message:`üåü ${t.displayName} erh√§lt Chat-Bonus! (+10 Punkte)`,type:"activity-bonus"}))}if(i.players.size>1){const r=Array.from(i.players.values()).filter(l=>l.id!==n.id&&!l.isDead&&l.health>0);if(r.length>0){const l=r[Math.floor(Math.random()*r.length)],d=n.personality*1e3,u=Math.random()*2e3,f=200+d+u;setTimeout(()=>{const v=i.settings.baseDamage,y=n.attack(l,v,!1);Math.random()<.7&&i.eventSystem.emit("actionFeed",{message:`‚öîÔ∏è ${n.displayName} greift ${l.displayName} an! (${y.damage} Schaden)`,type:"auto-attack"}),i.renderSystem.updatePlayerHealth(l),i.renderSystem.updatePlayerTitle(n),y.wasKilled&&i.eventSystem.emit("elimination",{victim:l,killer:n})},f),n.nextAutoAttack=Math.max(n.nextAutoAttack,Date.now()+f+1e3)}}}}const ee=()=>({JoinCommand:j,DefendCommand:X,PowerCommand:Y,HealCommand:_,StatsCommand:Q,BananaCommand:J,ActivityCommand:Z}),te=()=>{const h=ee();return{join:h.JoinCommand,defend:h.DefendCommand,power:h.PowerCommand,heal:h.HealCommand,stats:h.StatsCommand,banana:h.BananaCommand,activity:h.ActivityCommand}},I=te();function W(h){return I[h]||null}function se(h){return h in I}function ie(){return Object.keys(I)}function ae(h,e,t,s,i){const a=W(h);if(!a){console.error(`Command "${h}" nicht gefunden!`);return}new a().execute(e,t,s,i)}const ne={getCommand:W,hasCommand:se,getAllCommandNames:ie,executeCommand:ae};class oe{constructor(e){o(this,"gameEngine");this.gameEngine=e}normalizeMessageData(e,t){const s=e||{};return{username:s.username||t||"unknown",displayName:s.displayName||s.username||t||"Unknown Player",message:s.message||"",color:s.color||this.generateRandomColor(),badges:s.badges||[],isMod:s.isMod||!1,isSubscriber:s.isSubscriber||!1,isVip:s.isVip||!1,timestamp:s.timestamp||new Date}}generateRandomColor(){const e=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43","#a55eea","#26de81","#fd79a8","#fdcb6e","#e17055"];return e[Math.floor(Math.random()*e.length)]}processCommand(e,t){if(!this.gameEngine.isRunning){this.gameEngine.eventSystem.emit("actionFeed",{message:"Spiel ist nicht aktiv! Warte auf den Start.",type:"error"});return}t=this.normalizeMessageData(t,e.user),this.executeCommand(e.type,e.user,t,void 0,e.target||null)}executeCommand(e,t,s,i,a){const n=i||{gameEngine:this.gameEngine,commandHandler:this};ne.executeCommand(e,t,s,n,a)}}const E=class E extends M{constructor(t,s,i,a){const n=E.ENEMY_TYPES[i],c=n.names[Math.floor(Math.random()*n.names.length)],r=n.colors[Math.floor(Math.random()*n.colors.length)],l=`${c} Lv.${s}`,d=1+(s-1)*.15,u=Math.floor(a.baseHealth*n.healthMultiplier*d);super(t,l,r,u,a);o(this,"aiType");o(this,"enemyType");o(this,"aiBehavior");o(this,"damageMultiplier");o(this,"waveNumber");this.isAI=!0,this.aiType=i,this.enemyType=i,this.autoAttackInterval=n.attackInterval,this.personality=.3+Math.random()*.4,this.aiBehavior=Math.random(),this.damageMultiplier=n.damageMultiplier,this.waveNumber=s,this.activityCount=Math.floor(Math.random()*5),this.removeTag(m.Player),this.addTag(m.Enemy);const f=new H({enemyTags:[m.Player],targetPriority:[m.Player],attackInterval:this.autoAttackInterval,aggressiveness:this.personality,canAutoAttack:!0});this.addComponent(f)}static createRandom(t,s){const i=[];Object.entries(E.ENEMY_TYPES).forEach(([c,r])=>{for(let l=0;l<r.spawnWeight;l++)i.push(c)});const a=i[Math.floor(Math.random()*i.length)],n="ai_"+Date.now()+"_"+Math.random().toString(36).substr(2,9);return new E(n,t,a,s)}getBorderStyle(){switch(this.enemyType){case"weak":return{border:"2px solid #ffaa00",boxShadow:"0 0 8px rgba(255, 170, 0, 0.5)"};case"medium":return{border:"2px solid #ff6600",boxShadow:"0 0 10px rgba(255, 102, 0, 0.5)"};case"strong":return{border:"2px solid #ff0000",boxShadow:"0 0 12px rgba(255, 0, 0, 0.7)"};case"elite":return{border:"3px solid #8B008B",boxShadow:"0 0 15px rgba(139, 0, 139, 0.8)"};default:return{border:"2px solid #ff0000",boxShadow:"0 0 10px rgba(255, 0, 0, 0.5)"}}}getHealthBarColor(){return"linear-gradient(90deg, #ff4444, #cc0000)"}shouldAttack(t){if(t.length===0)return null;const s=t.filter(n=>n.hasTag(m.Player)&&!n.isDead&&n.health>0);return s.length===0||Date.now()<this.nextAutoAttack||Math.random()>.4?null:s[Math.floor(Math.random()*s.length)]}updateNextAttackTime(){const t=this.autoAttackInterval||2e3,s=Math.max(.3,1-this.activityCount*.01),i=this.personality>.7?.5:.7,a=1.5;this.nextAutoAttack=Date.now()+t*s*i*a}calculateAttackDamage(t,s=!1){let i=Math.floor(t*(.5+Math.random()*.8));return this.damageMultiplier&&(i=Math.floor(i*this.damageMultiplier)),i=super.calculateAttackDamage(i,!1),i}calculateAutoAttackDamage(t){let s=Math.floor(t*(.5+Math.random()*.8));return this.damageMultiplier&&(s=Math.floor(s*this.damageMultiplier)),s=super.calculateAutoAttackDamage(s),s}addKill(){super.addKill(),this.score=this.score-50+25}getDisplayInfo(){return{...this.getStats(),type:this.enemyType,waveNumber:this.waveNumber,damageMultiplier:this.damageMultiplier,isAI:!0}}};o(E,"ENEMY_TYPES",{weak:{healthMultiplier:.5,damageMultiplier:.4,attackInterval:3e3,spawnWeight:40,names:["Goblin","Kobold","Bandit","Rogue","Thief","Imp","Minion"],colors:["#8B4513","#A0522D","#CD853F","#DEB887","#F4A460","#D2691E","#B8860B"]},medium:{healthMultiplier:.9,damageMultiplier:.7,attackInterval:2500,spawnWeight:30,names:["Orc","Troll","Warrior","Guardian","Berserker","Brute","Savage"],colors:["#228B22","#32CD32","#7CFC00","#9ACD32","#ADFF2F","#98FB98","#90EE90"]},strong:{healthMultiplier:1.5,damageMultiplier:1.1,attackInterval:2e3,spawnWeight:20,names:["Demon","Dragon","Boss","Champion","Overlord","Destroyer","Tyrant"],colors:["#FF0000","#DC143C","#B22222","#8B0000","#FF6347","#FF4500","#FF1493"]},elite:{healthMultiplier:2.2,damageMultiplier:1.5,attackInterval:1500,spawnWeight:10,names:["Archfiend","Ancient","Nightmare","Apocalypse","Nemesis","Harbinger","Sovereign"],colors:["#4B0082","#8B008B","#9400D3","#8A2BE2","#9932CC","#BA55D3","#DDA0DD"]}});let P=E;class re{constructor(){o(this,"isRunning");o(this,"isGameOver");o(this,"players");o(this,"aiEnemies");o(this,"emojiPawns");o(this,"settings");o(this,"gameStats");o(this,"gameLoop");o(this,"gameOverTimer");o(this,"gameSeed");o(this,"survivingPlayers");o(this,"eventSystem");o(this,"renderSystem");o(this,"combatSystem");o(this,"waveSystem");o(this,"uiSystem");o(this,"commandHandler");o(this,"currentWave");o(this,"gameMode");this.isRunning=!1,this.isGameOver=!1,this.players=new Map,this.aiEnemies=new Map,this.emojiPawns=new Map,this.settings={maxPlayers:50,baseHealth:100,baseDamage:10,healAmount:75,defenseReduction:.2,chatActivityReward:2,waveInterval:6e4,inactiveTimeout:3e5,autoAttackChance:.3},this.gameStats={totalDamage:0,totalHeals:0,totalAttacks:0,startTime:null,uptime:0},this.gameLoop=null,this.gameOverTimer=null,this.gameSeed=null,this.survivingPlayers=[],this.currentWave=1,this.gameMode="endless",this.initializeSystems(),this.startGameLoop()}initializeSystems(){this.eventSystem=new G,this.renderSystem=new O,this.combatSystem=new V(this.settings),this.waveSystem=new K(this.settings),this.uiSystem=new q,this.commandHandler=new oe(this),this.combatSystem.setGameEngine(this),this.waveSystem.setEventSystem(this.eventSystem),this.waveSystem.setGameEngine(this),this.setupEventListeners()}setupEventListeners(){this.eventSystem.on("actionFeed",e=>{const t=e;this.uiSystem.addActionToFeed(t.message,t.type)}),this.eventSystem.on("elimination",e=>{const t=e;this.handleElimination(t.victim,t.killer)}),this.eventSystem.on("emojiPawnDeath",e=>{const t=e;this.removeEmojiPawn(t.pawnId)}),this.eventSystem.on("bananaEvent",e=>{const t=e;this.handleBananaEvent(t.player)}),this.eventSystem.on("chaosMode",e=>{const t=e;this.handleChaosMode(t.duration)}),this.eventSystem.on("waveComplete",e=>{const t=e;this.handleWaveComplete(t.waveNumber)}),this.eventSystem.on("waveStart",e=>{const t=e;this.handleWaveComplete(t.waveNumber)}),this.eventSystem.on("healthUpdate",e=>{const t=e,s=t.pawn||t.player;s&&this.renderSystem.updatePlayerHealth(s)}),this.eventSystem.on("scoreUpdate",e=>{this.updateLeaderboard()})}initializeGame(){console.log("Game initialized"),this.startGameLoop()}startGame(){this.isRunning||(this.gameSeed=Math.random(),console.log("New game seed generated:",this.gameSeed),this.isRunning=!0,this.isGameOver=!1,this.gameStats.startTime=Date.now(),this.waveSystem.start(),this.updateActiveViewers(),this.updateLeaderboard(),console.log("Game started!"),this.eventSystem.emit("actionFeed",{message:"üéÆ Spiel gestartet! Schreibt einfach im Chat um mitzuk√§mpfen!",type:"system"}))}stopGame(){this.isRunning=!1,this.isGameOver=!1,this.gameStats.startTime=null,this.waveSystem.stop(),this.gameOverTimer&&(clearTimeout(this.gameOverTimer),this.gameOverTimer=null),this.renderSystem.clearBattlefield(),this.players.clear(),this.aiEnemies.clear(),this.updateActiveViewers(),this.updateLeaderboard(),this.uiSystem.removeGameOverBanner(),console.log("Game stopped!"),this.eventSystem.emit("actionFeed",{message:"üõë Spiel gestoppt!",type:"system"})}startGameLoop(){this.gameLoop||(this.gameLoop=setInterval(()=>{if(this.isRunning){const e=[...Array.from(this.players.values()),...Array.from(this.aiEnemies.values())];this.emojiPawns.forEach(t=>{t.updateMovement(e)})}this.updateGame()},100))}updateGame(){if(!this.isRunning)return;const e=100;this.players.forEach(t=>{t.updateComponents(e)}),this.aiEnemies.forEach(t=>{t.updateComponents(e)}),this.gameStats.uptime=Date.now()-(this.gameStats.startTime||Date.now()),this.players.forEach(t=>{this.renderSystem.updatePlayerEffects(t)}),Math.random()<.002&&this.eventSystem.triggerRandomEvent(this.players),this.checkGameOverCondition()}processCommand(e,t){this.commandHandler.processCommand(e,t)}handleElimination(e,t){if("emoji"in e&&"handleHit"in e)return;const s=t.isAI?`${t.displayName} (KI)`:t.displayName,i=e.isAI?`${e.displayName} (KI)`:e.displayName,a=e.isAI?"+25":"+50";this.eventSystem.emit("actionFeed",{message:`üíÄ ${i} wurde eliminiert! (${a} Punkte f√ºr ${s})`,type:"elimination"}),e.isAI?setTimeout(()=>{this.removeAIEnemy(e.id)},2e3):this.eventSystem.emit("actionFeed",{message:`üíÄ ${e.displayName} wartet auf die n√§chste Welle zum Respawn!`,type:"death"}),this.checkAndAdjustWaveTimer(),this.uiSystem.addScreenShake()}checkAndAdjustWaveTimer(){if(!this.isRunning||!this.waveSystem.isActive)return;const e=Array.from(this.players.values()).filter(s=>!s.isDead&&s.health>0),t=Array.from(this.aiEnemies.values()).filter(s=>!s.isDead&&s.health>0);if(e.length===1&&t.length===0&&this.waveSystem.currentWave>0){const s=Date.now(),i=this.waveSystem.getTimeToNextWave();i>5500&&(this.waveSystem.setNextWaveTime(s+5e3),console.log(`[GameEngine] Only 1 player alive, setting next wave timer to 5 seconds (was ${Math.ceil(i/1e3)}s)`))}}handleBananaEvent(e){}handleChaosMode(e){const t=this.settings.autoAttackChance;this.settings.autoAttackChance=.8,setTimeout(()=>{this.settings.autoAttackChance=t},e)}handleWaveComplete(e){if(this.players.forEach(t=>{t.isDead||t.health<=0?(t.respawn(),this.renderSystem.updatePlayerTitle(t)):(t.health=t.maxHealth,this.eventSystem.emit("healthUpdate",{pawn:t,player:t,health:t.health,maxHealth:t.maxHealth})),t.healsUsed=0,this.renderSystem.updatePlayerTitle(t)}),this.aiEnemies.forEach(t=>{t.isDead||t.health<=0?(this.renderSystem.removePlayer(t.id),this.aiEnemies.delete(t.id)):t.health=t.maxHealth}),e===1)this.eventSystem.emit("actionFeed",{message:`üåä Wave ${e} gestartet! Schreibt im Chat um beizutreten! Gegner erscheinen ab Wave 2.`,type:"wave"});else{const t=this.players.size,s=Math.min(t+(e-1),t+10),i=this.aiEnemies.size,a=Math.max(0,s-i);a>0&&this.spawnAIEnemies(a,e),this.eventSystem.emit("actionFeed",{message:`üåä Wave ${e} gestartet! Alle Spieler vollst√§ndig geheilt und Heilungen zur√ºckgesetzt!`,type:"wave"})}this.uiSystem.addScreenShake()}handleAutoAttackResults(e){}spawnAIEnemies(e,t){for(let s=0;s<e;s++){const i=P.createRandom(t,this.settings);i.setEventSystem(this.eventSystem),this.aiEnemies.set(i.id,i),this.renderSystem.spawnAIEnemy(i);const a=i.getComponent("AutoCombat");a&&a.setGameEngine(this),setTimeout(()=>{this.eventSystem.emit("actionFeed",{message:`üëπ ${i.displayName} erscheint auf dem Schlachtfeld!`,type:"enemy-spawn"})},s*500)}}removeAIEnemy(e){this.aiEnemies.get(e)&&(this.renderSystem.removePlayer(e),this.aiEnemies.delete(e),this.updateActiveViewers())}addEmojiPawn(e){e.setEventSystem(this.eventSystem),this.emojiPawns.set(e.id,e),this.renderSystem.spawnEmojiPawn(e)}removeEmojiPawn(e){this.emojiPawns.get(e)&&(this.renderSystem.removePlayer(e),this.emojiPawns.delete(e))}checkGameOverCondition(){if(!this.isRunning||this.isGameOver)return;const e=Array.from(this.players.values()).filter(i=>i.health>0),t=Array.from(this.aiEnemies.values()).filter(i=>i.health>0);this.waveSystem.getCurrentWave()!==1&&e.length===0&&t.length>0&&this.triggerGameOver()}triggerGameOver(){this.isGameOver=!0,this.waveSystem.stop(),this.combatSystem.stopAutoAttackSystem();const e=Array.from(this.players.values()).sort((t,s)=>s.score-t.score).slice(0,3);this.uiSystem.showGameOverBanner(e),this.survivingPlayers=e,this.gameOverTimer=setTimeout(()=>{this.restartGame()},1e4),this.eventSystem.emit("actionFeed",{message:"üíÄ GAME OVER! Alle Spieler sind besiegt! Neues Spiel startet in 10 Sekunden...",type:"game-over"})}restartGame(){const e=this.survivingPlayers||[];this.stopGame(),this.settings.baseDamage=10,this.settings.baseHealth=100,this.gameStats={totalDamage:0,totalHeals:0,totalAttacks:0,startTime:null,uptime:0},this.startGame(),e.length>0?(e.forEach(t=>{const s={displayName:t.displayName,username:t.displayName,color:t.color,message:"",badges:[],isMod:!1,isSubscriber:!1,isVip:!1,timestamp:new Date},i=new R(t.id,s,this.settings);i.setEventSystem(this.eventSystem),this.players.set(t.id,i),this.renderSystem.spawnPlayer(i);const a=i.getComponent("AutoCombat");a&&a.setGameEngine(this),this.eventSystem.emit("actionFeed",{message:`‚öîÔ∏è ${i.displayName} ist dem Kampf beigetreten! (${i.playerClass})`,type:"join"})}),this.updateActiveViewers(),this.updateLeaderboard()):this.eventSystem.emit("actionFeed",{message:"üéÆ Neues Spiel gestartet! Schreibt im Chat um beizutreten!",type:"system"}),this.survivingPlayers=[]}updateActiveViewers(){this.uiSystem.updateActiveViewers(this.players.size,this.aiEnemies.size)}updateLeaderboard(){this.uiSystem.updateLeaderboard(this.players)}getGameStats(){return{...this.gameStats,activePlayers:this.players.size,currentWave:this.waveSystem.getCurrentWave(),topPlayer:this.getTopPlayer()}}getTopPlayer(){return this.players.size===0?null:Array.from(this.players.values()).reduce((e,t)=>t.score>e.score?t:e)}}class le{constructor(e,t,s={}){o(this,"x");o(this,"y");o(this,"velocity");o(this,"color");o(this,"size");o(this,"life");o(this,"maxLife");o(this,"gravity");o(this,"friction");o(this,"element");this.x=e,this.y=t,this.velocity=s.velocity||{x:0,y:0},this.color=s.color||"#ffffff",this.size=s.size||2,this.life=s.life||60,this.maxLife=this.life,this.gravity=s.gravity||.1,this.friction=s.friction||.98,this.createElement()}createElement(){this.element=document.createElement("div"),this.element.className="particle",this.element.style.position="fixed",this.element.style.left=this.x+"px",this.element.style.top=this.y+"px",this.element.style.width=this.size+"px",this.element.style.height=this.size+"px",this.element.style.background=this.color,this.element.style.borderRadius="50%",this.element.style.pointerEvents="none",this.element.style.zIndex="1000"}update(){if(this.life--,this.life<=0){this.element.remove();return}this.velocity.y+=this.gravity,this.velocity.x*=this.friction,this.velocity.y*=this.friction,this.x+=this.velocity.x,this.y+=this.velocity.y,this.element.style.left=this.x+"px",this.element.style.top=this.y+"px";const e=this.life/this.maxLife;this.element.style.opacity=e.toString()}}class ce{constructor(){o(this,"particles");o(this,"maxParticles");o(this,"container");this.particles=[],this.maxParticles=200,this.container=null}initialize(){this.container=document.getElementById("particles"),this.container||(this.container=document.createElement("div"),this.container.id="particles",this.container.className="particles",document.body.appendChild(this.container))}update(){this.particles=this.particles.filter(e=>(e.update(),e.life>0))}createParticle(e,t,s={}){this.particles.length>=this.maxParticles&&this.particles.shift();const i=new le(e,t,s);return this.particles.push(i),this.container&&this.container.appendChild(i.element),i}createImpactParticles(e){const t=e.getBoundingClientRect(),s=t.left+t.width/2,i=t.top+t.height/2;for(let a=0;a<8;a++){const n=a/8*Math.PI*2,c={x:Math.cos(n)*3,y:Math.sin(n)*3};this.createParticle(s,i,{velocity:c,color:"#ff6b6b",size:3,life:30})}}createHealingParticles(e){const t=e.getBoundingClientRect(),s=t.left+t.width/2,i=t.top+t.height/2;for(let a=0;a<12;a++){const n=Math.random()*Math.PI*2,c={x:Math.cos(n)*2,y:Math.sin(n)*2-1};this.createParticle(s,i,{velocity:c,color:"#4ecdc4",size:2,life:60})}}createDefenseParticles(e){const t=e.getBoundingClientRect(),s=t.left+t.width/2,i=t.top+t.height/2;for(let a=0;a<16;a++){const n=a/16*Math.PI*2,c=30,r=s+Math.cos(n)*c,l=i+Math.sin(n)*c;this.createParticle(r,l,{velocity:{x:0,y:-.5},color:"#45b7d1",size:1,life:120})}}createPowerParticles(e){const t=e.getBoundingClientRect(),s=t.left+t.width/2,i=t.top+t.height/2;for(let a=0;a<10;a++){const n={x:(Math.random()-.5)*4,y:(Math.random()-.5)*4};this.createParticle(s,i,{velocity:n,color:"#ff6b6b",size:4,life:40})}}createExplosionParticles(e){for(let t=0;t<20;t++){const s=Math.random()*Math.PI*2,i=Math.random()*8+2,a={x:Math.cos(s)*i,y:Math.sin(s)*i};this.createParticle(e.x,e.y,{velocity:a,color:["#ff6b6b","#ff4757","#ffa502"][Math.floor(Math.random()*3)],size:Math.random()*4+2,life:Math.random()*60+30})}}createSpawnParticles(e){const t=e.getBoundingClientRect(),s=t.left+t.width/2,i=t.top+t.height/2;for(let a=0;a<15;a++){const n={x:(Math.random()-.5)*3,y:(Math.random()-.5)*3-1};this.createParticle(s,i,{velocity:n,color:"#96ceb4",size:3,life:90})}}}class he{constructor(){o(this,"sounds");o(this,"volume");o(this,"enabled");o(this,"audioContext");this.sounds={},this.volume=.3,this.enabled=!0,this.audioContext=null}initialize(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext),this.createSounds()}catch(e){console.warn("Audio not supported:",e),this.enabled=!1}}createSounds(){this.sounds={attack:this.createAttackSound(),heal:this.createHealSound(),defend:this.createDefendSound(),power:this.createPowerSound(),explosion:this.createExplosionSound(),spawn:this.createSpawnSound()}}createAttackSound(){return()=>{if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(800,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(200,this.audioContext.currentTime+.1),t.gain.setValueAtTime(this.volume,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),e.start(),e.stop(this.audioContext.currentTime+.1)}}createHealSound(){return()=>{if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(400,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(800,this.audioContext.currentTime+.3),t.gain.setValueAtTime(this.volume*.5,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),e.start(),e.stop(this.audioContext.currentTime+.3)}}createDefendSound(){return()=>{if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(300,this.audioContext.currentTime),e.type="square",t.gain.setValueAtTime(this.volume*.3,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),e.start(),e.stop(this.audioContext.currentTime+.2)}}createPowerSound(){return()=>{if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(600,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(1200,this.audioContext.currentTime+.15),t.gain.setValueAtTime(this.volume*.7,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.15),e.start(),e.stop(this.audioContext.currentTime+.15)}}createExplosionSound(){return()=>{if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(150,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+.5),e.type="sawtooth",t.gain.setValueAtTime(this.volume,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),e.start(),e.stop(this.audioContext.currentTime+.5)}}createSpawnSound(){return()=>{if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(200,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(600,this.audioContext.currentTime+.4),t.gain.setValueAtTime(this.volume*.4,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.4),e.start(),e.stop(this.audioContext.currentTime+.4)}}playSound(e){this.sounds[e]&&this.audioContext&&this.sounds[e]()}setVolume(e){this.volume=Math.max(0,Math.min(1,e))}setEnabled(e){this.enabled=e}}class de{constructor(){o(this,"particleSystem");o(this,"soundSystem");o(this,"animationQueue");o(this,"isProcessing");this.particleSystem=new ce,this.soundSystem=new he,this.animationQueue=[],this.isProcessing=!1,this.initializeEffects()}initializeEffects(){this.particleSystem.initialize(),this.soundSystem.initialize(),this.startAnimationLoop()}startAnimationLoop(){const e=()=>{this.processAnimationQueue(),this.particleSystem.update(),requestAnimationFrame(e)};e()}processAnimationQueue(){for(;this.animationQueue.length>0;){const e=this.animationQueue.shift();this.executeAnimation(e).catch(t=>{console.error(`[EffectsManager] Error executing animation type '${e.type}':`,t)})}}async executeAnimation(e){switch(e.type){case"attack":await this.playAttackEffect(e);break;case"heal":await this.playHealEffect(e);break;case"defend":await this.playDefendEffect(e);break;case"power":await this.playPowerEffect(e);break;case"explosion":await this.playExplosionEffect(e);break;case"spawn":await this.playSpawnEffect(e);break;case"shockwave":await this.playShockwaveEffect(e);break}}triggerAttackEffect(e,t,s=!1,i=!1){console.log(`[EffectsManager] Triggering attack effect: ${e.displayName} -> ${t.displayName} (powered: ${s}, counter: ${i})`),this.animationQueue.push({type:"attack",attacker:e,target:t,isPowerAttack:s,isCounterAttack:i,timestamp:Date.now()}),this.soundSystem.playSound("attack")}triggerHealEffect(e){this.animationQueue.push({type:"heal",player:e,timestamp:Date.now()}),this.soundSystem.playSound("heal")}triggerDefendEffect(e,t=5e3){console.log(`[EffectsManager] Triggering defend effect for ${e.displayName} (element: ${e.element?"exists":"null"})`),this.animationQueue.push({type:"defend",player:e,duration:t,timestamp:Date.now()}),this.soundSystem.playSound("defend")}triggerPowerEffect(e){this.animationQueue.push({type:"power",player:e,timestamp:Date.now()}),this.soundSystem.playSound("power")}triggerExplosionEffect(e){this.animationQueue.push({type:"explosion",position:e,timestamp:Date.now()}),this.soundSystem.playSound("explosion")}triggerSpawnEffect(e){this.animationQueue.push({type:"spawn",player:e,timestamp:Date.now()}),this.soundSystem.playSound("spawn")}triggerShockwaveEffect(e,t){this.animationQueue.push({type:"shockwave",position:e,timestamp:Date.now()}),t&&(this.shockwaveHitCallback=t),this.soundSystem.playSound("explosion")}async playAttackEffect(e){const{attacker:t,target:s,isPowerAttack:i=!1,isCounterAttack:a=!1}=e;if(console.log(`[EffectsManager] Playing attack effect: ${t.displayName} -> ${s.displayName} (powered: ${i}, counter: ${a})`),!t.element||!s.element){console.warn("[EffectsManager] Missing elements for attack effect");return}const n=this.createAttackBeam(t.element,s.element,i,a);await this.animateBeam(n,i,a),this.particleSystem.createImpactParticles(s.element),this.createScreenShake(),n.remove(),console.log("[EffectsManager] Beam removed"),this.debugActiveBeams()}async playHealEffect(e){const{player:t}=e;t.element&&(this.particleSystem.createHealingParticles(t.element),await this.createHealingGlow(t.element))}async playDefendEffect(e){const{player:t,duration:s=5e3}=e;if(!t.element){console.warn(`[EffectsManager] Cannot play defend effect: player.element is null for ${t.displayName}`);return}console.log(`[EffectsManager] Playing defend effect for ${t.displayName} with duration ${s}ms`),await this.createShieldEffect(t.element,s),this.particleSystem.createDefenseParticles(t.element)}async playPowerEffect(e){const{player:t}=e;t.element&&(await this.createPowerChargeEffect(t.element),this.particleSystem.createPowerParticles(t.element))}async playExplosionEffect(e){const{position:t}=e;this.particleSystem.createExplosionParticles(t),this.createScreenFlash(),this.createScreenShake()}async playSpawnEffect(e){const{player:t}=e;t.element&&(this.particleSystem.createSpawnParticles(t.element),await this.createSpawnGlow(t.element))}async playShockwaveEffect(e){const{position:t}=e;t&&(this.particleSystem.createExplosionParticles(t),this.createScreenFlash(),this.createScreenShake(),await this.createShockwaveRing(t))}async createShockwaveRing(e){const t=document.getElementById("battlefield");if(!t)return;const s=t.getBoundingClientRect(),i=Math.max(s.width,s.height)*.8,a=3e3,n=performance.now(),c=50;let r=n;const l=document.createElement("div");l.className="shockwave",l.style.position="absolute",l.style.left=e.x+"px",l.style.top=e.y+"px",l.style.width="0px",l.style.height="0px",l.style.borderRadius="50%",l.style.border="3px solid rgba(255, 68, 68, 0.8)",l.style.boxShadow="0 0 20px rgba(255, 68, 68, 0.6), inset 0 0 20px rgba(255, 68, 68, 0.4)",l.style.transform="translate(-50%, -50%)",l.style.pointerEvents="none",l.style.zIndex="1000",l.style.transition="none",l.style.willChange="width, height, box-shadow",t.appendChild(l);const d=this.shockwaveHitCallback,u=f=>{const v=f-n,y=Math.min(v/a,1),g=y*i,x=g*2;l.style.width=x+"px",l.style.height=x+"px",l.style.boxShadow=`0 0 ${g*.3}px rgba(255, 68, 68, 0.8), inset 0 0 ${g*.2}px rgba(255, 68, 68, 0.6)`,d&&f-r>=c&&(r=f,d(g,{x:e.x,y:e.y})),y<1?requestAnimationFrame(u):(l.style.transition="opacity 0.5s ease-out",l.style.opacity="0",setTimeout(()=>{l.remove()},500))};requestAnimationFrame(u)}createShockwaveHitEffect(e){const t=document.createElement("div");t.className="shockwave-hit-effect",t.style.position="absolute",t.style.top="-10px",t.style.left="-10px",t.style.right="-10px",t.style.bottom="-10px",t.style.background="radial-gradient(circle, rgba(255, 68, 68, 0.6) 0%, transparent 70%)",t.style.borderRadius="50%",t.style.animation="shockwaveHitPulse 0.8s ease-out",t.style.pointerEvents="none",t.style.zIndex="100",e.appendChild(t),setTimeout(()=>{t.remove()},800)}createAttackBeam(e,t,s=!1,i=!1){console.log(`[EffectsManager] Creating attack beam from ${e.title} to ${t.title} (powered: ${s}, counter: ${i})`);const a=document.createElement("div");a.className="attack-beam",a.style.position="absolute",a.style.height=s?"3px":"2px",s?(a.style.background="linear-gradient(90deg, #4a90e2, #1e88e5)",a.style.borderRadius="1.5px",a.style.boxShadow="0 0 15px #4a90e2"):i?(a.style.background="linear-gradient(90deg, #ffd700, #ffaa00)",a.style.borderRadius="1.5px",a.style.boxShadow="0 0 15px #ffd700"):(a.style.background="linear-gradient(90deg, #ff6b6b, #ff4757)",a.style.borderRadius="1px",a.style.boxShadow="0 0 10px #ff6b6b"),a.style.zIndex="1000";const n=e.getBoundingClientRect(),c=t.getBoundingClientRect(),r=document.getElementById("battlefield");if(!r)throw new Error("Battlefield element not found");const l=r.getBoundingClientRect(),d=n.left-l.left+n.width/2,u=n.top-l.top+n.height/2,f=c.left-l.left+c.width/2,v=c.top-l.top+c.height/2,y=Math.sqrt(Math.pow(f-d,2)+Math.pow(v-u,2)),g=Math.atan2(v-u,f-d);return a.style.left=d+"px",a.style.top=u+"px",a.style.width=y+"px",a.style.transform=`rotate(${g}rad)`,a.style.transformOrigin="0 50%",a.dataset.fullWidth=y+"px",r.appendChild(a),console.log(`[EffectsManager] Beam created: ${d},${u} -> ${f},${v} (distance: ${y}px)`),this.debugActiveBeams(),a}async animateBeam(e,t=!1,s=!1){console.log(`[EffectsManager] Animating beam (powered: ${t}, counter: ${s})`);const i=e.style.transform;return e.style.transform=`${i} scaleX(0)`,e.style.transition="transform 0.2s ease-out",setTimeout(()=>{e.style.transform=`${i} scaleX(1)`},10),new Promise(a=>{setTimeout(()=>{t&&this.createBlasterParticles(e,t,s),e.style.transition="opacity 0.15s ease-out",e.style.opacity="0",setTimeout(a,150)},200)})}async createHealingGlow(e){const t=document.createElement("div");return t.className="healing-glow",t.style.position="absolute",t.style.top="-10px",t.style.left="-10px",t.style.right="-10px",t.style.bottom="-10px",t.style.background="radial-gradient(circle, rgba(78, 205, 196, 0.6) 0%, transparent 70%)",t.style.borderRadius="50%",t.style.animation="healingGlow 1s ease-out",t.style.pointerEvents="none",e.appendChild(t),new Promise(s=>{setTimeout(()=>{t.remove(),s()},1e3)})}async createShieldEffect(e,t=5e3){const s=document.createElement("div");return s.className="shield-effect",s.style.position="absolute",s.style.top="-15px",s.style.left="-15px",s.style.right="-15px",s.style.bottom="-15px",s.style.border="2px solid #45b7d1",s.style.borderRadius="50%",s.style.animation=`shieldPulse ${t}ms ease-out`,s.style.pointerEvents="none",e.appendChild(s),new Promise(i=>{setTimeout(()=>{s.remove(),i()},t)})}async createPowerChargeEffect(e){const t=document.createElement("div");return t.className="power-charge",t.style.position="absolute",t.style.top="-20px",t.style.left="-20px",t.style.right="-20px",t.style.bottom="-20px",t.style.background="radial-gradient(circle, rgba(255, 107, 107, 0.4) 0%, transparent 70%)",t.style.borderRadius="50%",t.style.animation="powerCharge 0.5s ease-out",t.style.pointerEvents="none",e.appendChild(t),new Promise(s=>{setTimeout(()=>{t.remove(),s()},500)})}async createSpawnGlow(e){const t=document.createElement("div");return t.className="spawn-glow",t.style.position="absolute",t.style.top="-25px",t.style.left="-25px",t.style.right="-25px",t.style.bottom="-25px",t.style.background="radial-gradient(circle, rgba(150, 206, 180, 0.8) 0%, transparent 70%)",t.style.borderRadius="50%",t.style.animation="spawnGlow 2s ease-out",t.style.pointerEvents="none",e.appendChild(t),new Promise(s=>{setTimeout(()=>{t.remove(),s()},2e3)})}createScreenShake(){const e=document.querySelector(".game-container");e&&(e.classList.add("screen-shake"),setTimeout(()=>{e.classList.remove("screen-shake")},500))}createScreenFlash(){const e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="rgba(255, 255, 255, 0.3)",e.style.pointerEvents="none",e.style.zIndex="9999",e.style.opacity="0",e.style.transition="opacity 0.1s ease-out",document.body.appendChild(e),setTimeout(()=>{e.style.opacity="1",setTimeout(()=>{e.style.opacity="0",setTimeout(()=>{e.remove()},100)},100)},10)}createBlasterParticles(e,t=!1,s=!1){const i=document.getElementById("battlefield");if(!i)return;const a=i.getBoundingClientRect(),n=parseFloat(e.style.left),c=parseFloat(e.style.top),r=parseFloat(e.style.width),l=e.style.transform.match(/rotate\(([^)]+)/),d=l?parseFloat(l[1]):0,u=12;for(let f=0;f<u;f++){const v=f/u,y=a.left+n+Math.cos(d)*(r*v),g=a.top+c+Math.sin(d)*(r*v),x=d+Math.PI/2,S=(Math.random()-.5)*8,C=y+Math.cos(x)*S,A=g+Math.sin(x)*S,p=document.createElement("div");p.style.position="fixed",p.style.left=C+"px",p.style.top=A+"px",p.style.width="4px",p.style.height="4px",t?p.style.background=`hsl(${Math.random()*60+210}, 90%, ${50+Math.random()*30}%)`:s?p.style.background=`hsl(${Math.random()*60+50}, 100%, ${50+Math.random()*30}%)`:p.style.background=`hsl(${Math.random()*60+330}, 100%, ${60+Math.random()*20}%)`,p.style.borderRadius="50%",p.style.boxShadow=`0 0 8px ${p.style.background}`,p.style.pointerEvents="none",p.style.zIndex="1001";const B=d+(Math.random()-.5)*.5,$=2+Math.random()*3;p.style.transition="all 0.3s ease-out",document.body.appendChild(p),setTimeout(()=>{p.style.transform=`translate(${Math.cos(B)*$*30}px, ${Math.sin(B)*$*30}px) scale(0)`,p.style.opacity="0",setTimeout(()=>{p.remove()},300)},10)}}debugActiveBeams(){const e=document.getElementById("battlefield");if(!e)return;const t=e.querySelectorAll(".attack-beam");console.log(`[EffectsManager] Active beams on battlefield: ${t.length}`),t.forEach((s,i)=>{console.log(`[EffectsManager] Beam ${i+1}: ${s.style.left}, ${s.style.top} -> ${s.style.width}`)})}}class me{constructor(){o(this,"gameEngine");o(this,"testPlayerCounter");o(this,"isDebugMode");this.gameEngine=null,this.testPlayerCounter=1,this.isDebugMode=!1}setGameEngine(e){this.gameEngine=e}enableDebugMode(){this.isDebugMode=!0,console.log("[DebugSystem] Debug mode enabled")}disableDebugMode(){this.isDebugMode=!1,console.log("[DebugSystem] Debug mode disabled")}spawnTestPlayer(e,t=!1){if(!this.gameEngine)return console.error("[DebugSystem] GameEngine not set"),"";const s=`test_player_${this.testPlayerCounter++}`,i=e||`TestPlayer${this.testPlayerCounter-1}`,a={username:s,displayName:i,message:"",color:this.generateRandomColor(),badges:[],isMod:!1,isSubscriber:!1,isVip:!1,timestamp:new Date};if(this.gameEngine.commandHandler.executeCommand("join",s,a),t){const n=this.gameEngine.players.get(s);n&&(n.personality=.75,n.playerClass="Berserker")}return console.log(`[DebugSystem] Spawned test player: ${i} (${s})`),s}spawnMultipleTestPlayers(e,t=0){const s=[];for(let i=0;i<e;i++){const a=i<t,n=this.spawnTestPlayer(void 0,a);s.push(n)}return console.log(`[DebugSystem] Spawned ${e} test players (${t} aggressive)`),s}executeTestCommand(e,t,s){if(!this.gameEngine){console.error("[DebugSystem] GameEngine not set");return}const i=this.gameEngine.players.get(t);if(!i){console.error(`[DebugSystem] Player ${t} not found`);return}const a={username:t,displayName:i.displayName,message:`!${e}`,color:i.color,badges:[],isMod:!1,isSubscriber:!1,isVip:!1,timestamp:new Date};this.gameEngine.commandHandler.executeCommand(e,t,a,void 0,s||null),console.log(`[DebugSystem] Executed command: ${e} for ${i.displayName}`)}killPlayer(e){if(!this.gameEngine){console.error("[DebugSystem] GameEngine not set");return}let t=null;if(e)t=this.gameEngine.players.get(e)||null;else{const a=Array.from(this.gameEngine.players.values()).filter(n=>!n.isDead&&n.health>0);if(a.length===0){console.error("[DebugSystem] No alive players found to kill");return}t=a[Math.floor(Math.random()*a.length)]}if(!t){console.error("[DebugSystem] Player not found");return}const s=t;t.takeDamage(t.health)&&(this.gameEngine.combatSystem.handleKill(s,t,()=>this.gameEngine?.combatSystem.getAllPawns()||[]),this.gameEngine.eventSystem.emit("elimination",{victim:t,killer:s})),console.log(`[DebugSystem] Killed player: ${t.displayName}`)}damagePlayer(e,t){if(!this.gameEngine){console.error("[DebugSystem] GameEngine not set");return}const s=this.gameEngine.players.get(e);if(!s){console.error(`[DebugSystem] Player ${e} not found`);return}s.takeDamage(t),console.log(`[DebugSystem] Damaged player ${s.displayName} by ${t} HP`)}healPlayer(e,t){if(!this.gameEngine){console.error("[DebugSystem] GameEngine not set");return}const s=this.gameEngine.players.get(e);if(!s){console.error(`[DebugSystem] Player ${e} not found`);return}s.gainHealth(t),console.log(`[DebugSystem] Healed player ${s.displayName} by ${t} HP`)}forceNextWave(){if(!this.gameEngine){console.error("[DebugSystem] GameEngine not set");return}this.gameEngine.waveSystem.forceNextWave(),console.log("[DebugSystem] Forced next wave")}getAllPlayers(){return this.gameEngine?Array.from(this.gameEngine.players.values()):[]}getPlayer(e){return this.gameEngine&&this.gameEngine.players.get(e)||null}clearAllPlayers(){if(!this.gameEngine){console.error("[DebugSystem] GameEngine not set");return}const e=this.gameEngine.players.size;this.gameEngine.players.clear(),this.gameEngine.renderSystem.clearBattlefield(),console.log(`[DebugSystem] Cleared ${e} players`)}startGame(){if(!this.gameEngine){console.error("[DebugSystem] GameEngine not set");return}this.gameEngine.startGame(),console.log("[DebugSystem] Game started")}stopGame(){if(!this.gameEngine){console.error("[DebugSystem] GameEngine not set");return}this.gameEngine.stopGame(),console.log("[DebugSystem] Game stopped")}getGameStats(){return this.gameEngine?this.gameEngine.getGameStats():null}generateRandomColor(){const e=["#ff6b6b","#4ecdc4","#45b7d1","#96ceb4","#feca57","#ff9ff3","#54a0ff","#5f27cd","#00d2d3","#ff9f43","#a55eea","#26de81","#fd79a8","#fdcb6e","#e17055"];return e[Math.floor(Math.random()*e.length)]}}class ue{constructor(){o(this,"notifications");this.notifications=[]}showNotification(e,t="info"){const s=document.createElement("div");s.className=`notification ${t}`,s.textContent=e;const i=20+this.notifications.length*70;s.style.cssText=`
      position: fixed;
      top: ${i}px;
      right: 20px;
      background: ${t==="success"?"#4ecdc4":t==="error"?"#ff6b6b":"#45b7d1"};
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      z-index: 10000;
      font-family: 'Orbitron', monospace;
      font-weight: bold;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
      animation: slideIn 0.3s ease;
      max-width: 300px;
      word-wrap: break-word;
    `,this.notifications.push(s),document.body.appendChild(s),setTimeout(()=>{s.style.animation="slideOut 0.3s ease",setTimeout(()=>{const a=this.notifications.indexOf(s);a>-1&&this.notifications.splice(a,1),s.parentNode&&s.remove(),this.repositionNotifications()},300)},3e3)}repositionNotifications(){this.notifications.forEach((e,t)=>{const s=20+t*70;e.style.top=`${s}px`})}showError(e){this.showNotification(e,"error"),console.error("Game Error:",e)}}class ge{constructor(){o(this,"codeVersion");o(this,"defaultSettings");this.codeVersion="1.0.0-"+Date.now(),this.defaultSettings={channelName:"xAkiitoh",gameMode:"endless",autoStart:!0,volume:.3}}getCodeVersion(){return this.codeVersion}loadSettings(){const e={...this.defaultSettings};try{const t=localStorage.getItem("streamAFKGameSettings");t&&Object.assign(e,JSON.parse(t))}catch(t){console.warn("Failed to load settings:",t)}return e}saveSettings(e){try{localStorage.setItem("streamAFKGameSettings",JSON.stringify(e))}catch(t){console.warn("Failed to save settings:",t)}}checkCodeVersion(){try{return localStorage.getItem("streamAFKGameVersion")!==this.codeVersion?(console.log("Code version changed, clearing localStorage..."),this.clearLocalStorage(),localStorage.setItem("streamAFKGameVersion",this.codeVersion),!0):!1}catch(e){return console.warn("Failed to check code version:",e),!1}}clearLocalStorage(){try{const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s&&s.startsWith("streamAFKGame")&&e.push(s)}e.forEach(t=>{localStorage.removeItem(t)}),console.log("LocalStorage cleared successfully")}catch(e){console.warn("Failed to clear localStorage:",e)}}}class fe{constructor(e){o(this,"channelName");o(this,"socket");o(this,"connected");o(this,"reconnectAttempts");o(this,"maxReconnectAttempts");o(this,"reconnectDelay");o(this,"eventHandlers");o(this,"messageQueue");o(this,"rateLimitCount");o(this,"rateLimitWindow");o(this,"maxMessagesPerWindow");this.channelName=e,this.socket=null,this.connected=!1,this.reconnectAttempts=0,this.maxReconnectAttempts=5,this.reconnectDelay=5e3,this.eventHandlers={},this.messageQueue=[],this.rateLimitCount=0,this.rateLimitWindow=3e4,this.maxMessagesPerWindow=20,this.initializeConnection()}initializeConnection(){try{this.connectToTwitch()}catch(e){console.error("Failed to initialize Twitch connection:",e),this.handleConnectionError()}}connectToTwitch(){this.socket=new WebSocket("wss://irc-ws.chat.twitch.tv:443"),this.socket.onopen=()=>{console.log("Connected to Twitch IRC"),this.authenticate()},this.socket.onmessage=e=>{this.handleMessage(e.data)},this.socket.onclose=()=>{console.log("Disconnected from Twitch IRC"),this.connected=!1,this.updateConnectionStatus(!1),this.handleReconnect()},this.socket.onerror=e=>{console.error("WebSocket error:",e),this.handleConnectionError()}}authenticate(){this.socket.send("PASS SCHMOOPIIE"),this.socket.send("NICK justinfan12345"),this.socket.send(`JOIN #${this.channelName.toLowerCase()}`)}handleMessage(e){e.split(`\r
`).forEach(s=>{if(s.trim()!==""){if(s.startsWith("PING")){this.socket.send("PONG :tmi.twitch.tv");return}s.includes("PRIVMSG")?this.parsePrivmsg(s):s.includes("JOIN")&&(this.connected=!0,this.reconnectAttempts=0,this.updateConnectionStatus(!0),this.emit("connected"))}})}parsePrivmsg(e){const t=e.match(/:(.+?)!.+?PRIVMSG #(.+?) :(.+)/);if(!t)return;const[,s,,i]=t,a={username:s,displayName:s,color:this.generateUserColor(s),badges:[],isMod:!1,isSubscriber:!1,isVip:!1};if(e.startsWith("@")){const c=e.match(/^@(.+?) :/);if(c){const r=this.parseTags(c[1]);a.displayName=r["display-name"]||s,a.color=r.color||this.generateUserColor(s),a.badges=r.badges?r.badges.split(",").map(l=>l.split("/")[0]):[],a.isMod=r.mod==="1",a.isSubscriber=r.subscriber==="1",a.isVip=r.vip==="1"}}const n={username:a.username,displayName:a.displayName,message:i,color:a.color,badges:a.badges,isMod:a.isMod,isSubscriber:a.isSubscriber,isVip:a.isVip,timestamp:new Date};this.isRateLimited()||(this.rateLimitCount++,setTimeout(()=>this.rateLimitCount--,this.rateLimitWindow),this.emit("message",n))}parseTags(e){const t={};return e.split(";").forEach(s=>{const[i,a]=s.split("=");t[i]=a}),t}generateUserColor(e){const t=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#98D8C8","#F7DC6F","#BB8FCE","#85C1E9"];let s=0;for(let i=0;i<e.length;i++)s=e.charCodeAt(i)+((s<<5)-s);return t[Math.abs(s)%t.length]}isRateLimited(){return this.rateLimitCount>=this.maxMessagesPerWindow}handleConnectionError(){this.connected=!1,this.updateConnectionStatus(!1),this.handleReconnect()}handleReconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached"),this.emit("connectionFailed");return}this.reconnectAttempts++,console.log(`Reconnecting in ${this.reconnectDelay/1e3} seconds... (Attempt ${this.reconnectAttempts})`),setTimeout(()=>{this.connectToTwitch()},this.reconnectDelay)}updateConnectionStatus(e){const t=document.getElementById("connectionStatus"),s=t.querySelector(".status-dot"),i=t.querySelector("span:last-child");e?(s.classList.add("connected"),i.textContent=`Verbunden mit ${this.channelName}`):(s.classList.remove("connected"),i.textContent=this.reconnectAttempts>0?`Verbindung getrennt (${this.reconnectAttempts}/${this.maxReconnectAttempts})`:"Verbinde...")}on(e,t){this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t)}emit(e,t){this.eventHandlers[e]&&this.eventHandlers[e].forEach(s=>{try{s(t)}catch(i){console.error(`Error in event handler for ${e}:`,i)}})}parseCommand(e){const t=e.message.trim();switch(t.split(" ")[0].toLowerCase()){case"!defend":return{type:"defend",user:e.username};case"!power":return{type:"power",user:e.username};case"!heal":return{type:"heal",user:e.username};case"!stats":return{type:"stats",user:e.username};case"!help":return{type:"help",user:e.username};case"!banana":return{type:"banana",user:e.username};default:return t.length>0?{type:"activity",user:e.username,message:e.message}:null}}disconnect(){this.socket&&(this.socket.close(),this.socket=null),this.connected=!1,this.updateConnectionStatus(!1)}reconnect(){this.disconnect(),this.reconnectAttempts=0,setTimeout(()=>{this.initializeConnection()},1e3)}isConnected(){return this.connected}changeChannel(e){this.channelName=e,this.reconnect()}}class pe{constructor(e){o(this,"twitchClient");o(this,"channelName");o(this,"onConnectedCallback");o(this,"onMessageCallback");o(this,"onConnectionFailedCallback");this.twitchClient=null,this.channelName=e.channelName}initialize(e,t,s){this.onConnectedCallback=e,this.onMessageCallback=t,this.onConnectionFailedCallback=s,this.twitchClient=new fe(this.channelName),this.twitchClient.on("connected",()=>{console.log("Connected to Twitch chat"),this.onConnectedCallback&&this.onConnectedCallback()}),this.twitchClient.on("message",i=>{this.onMessageCallback&&this.onMessageCallback(i)}),this.twitchClient.on("connectionFailed",()=>{console.error("Failed to connect to Twitch"),this.onConnectionFailedCallback&&this.onConnectionFailedCallback()})}handleMessage(e,t){try{console.log("Received messageData:",e);const s=this.twitchClient?.parseCommand(e);console.log("Parsed command:",s),s&&t&&t.processCommand(s,e)}catch(s){console.error("Error processing Twitch message:",s)}}changeChannel(e){this.channelName=e,this.twitchClient&&this.twitchClient.changeChannel(e)}disconnect(){this.twitchClient&&this.twitchClient.disconnect()}isConnected(){return this.twitchClient?.isConnected()||!1}}class ye{constructor(){o(this,"debugSystem");o(this,"gameEngine");this.debugSystem=null,this.gameEngine=null}setDebugSystem(e){this.debugSystem=e}setGameEngine(e){this.gameEngine=e}setupUI(e,t){const s=document.getElementById("channelName");s&&(s.value=e);const i=document.getElementById("gameMode");i&&(i.value=t),this.addTooltips(),this.setupConfigPanel(),this.setupHelpSystem(),this.setupDebugPanel()}addTooltips(){document.querySelectorAll(".command").forEach(t=>{const s=t.querySelector("code");if(s){const i=this.createTooltip(this.getCommandDescription(s.textContent||""));t.appendChild(i)}})}createTooltip(e){const t=document.createElement("div");return t.className="tooltip",t.textContent=e,t.style.cssText=`
      position: absolute;
      background: rgba(0, 0, 0, 0.9);
      color: white;
      padding: 5px 10px;
      border-radius: 4px;
      font-size: 0.8em;
      white-space: nowrap;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.2s;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
    `,t}getCommandDescription(e){return{"Einfach chatten!":"Jede Chat-Nachricht bringt dich automatisch ins Spiel","Mehr chatten = st√§rker!":"Je aktiver du bist, desto st√§rker wirst du","!defend":"Aktiviere Verteidigung f√ºr 5 Sekunden","!power":"Lade deine Spezialattacke auf (max. 3x)","!heal":"Heile dich selbst (begrenzt verf√ºgbar)"}[e]||"Automatisches Kampfsystem"}setupConfigPanel(){const e=document.getElementById("configPanel");if(!e)return;const t=document.createElement("div");t.className="config-header",t.innerHTML=`
      <h3>Konfiguration</h3>
      <button class="minimize-btn">+</button>
    `,t.style.cssText=`
      display: flex;
      justify-content: space-between;
      align-items: center;
    `;const s=t.querySelector(".minimize-btn");if(!s)return;s.style.cssText=`
      background: none;
      border: 1px solid rgba(255, 255, 255, 0.3);
      color: white;
      width: 25px;
      height: 25px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    `;const i=e.querySelector("h3");i&&i.remove(),e.insertBefore(t,e.firstChild);let a=!0;e.querySelectorAll(".config-section").forEach(c=>{c.style.display="none"}),s.addEventListener("click",()=>{a=!a,e.querySelectorAll(".config-section").forEach(r=>{r.style.display=a?"none":"block"}),s.textContent=a?"+":"‚àí"})}setupHelpSystem(){const e=document.createElement("button");e.textContent="?",e.className="help-btn",e.style.cssText=`
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: linear-gradient(45deg, #4ecdc4, #45b7d1);
      border: none;
      color: white;
      font-size: 1.2em;
      font-weight: bold;
      cursor: pointer;
      z-index: 1000;
      transition: all 0.3s ease;
    `,e.addEventListener("click",()=>this.showHelp()),document.body.appendChild(e)}showHelp(){const e=document.createElement("div");e.className="help-modal",e.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    `;const t=document.createElement("div");t.className="help-content",t.style.cssText=`
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      padding: 30px;
      max-width: 600px;
      max-height: 80vh;
      overflow-y: auto;
      color: white;
      font-family: 'Orbitron', monospace;
    `,t.innerHTML=`
      <h2 style="color: #4ecdc4; margin-bottom: 20px;">üéÆ Stream AFK Game - Hilfe</h2>
      
      <h3 style="color: #ff6b6b; margin-bottom: 10px;">Wie es funktioniert:</h3>
      <ul style="margin-bottom: 20px;">
        <li><strong>Einfach chatten!</strong> - Jede Nachricht bringt dich automatisch ins Spiel</li>
        <li><strong>Keine Befehle n√∂tig</strong> - Das System macht alles automatisch</li>
        <li><strong>Mehr Aktivit√§t = St√§rker</strong> - Je mehr du chattest, desto st√§rker wirst du</li>
        <li><strong>Automatische K√§mpfe</strong> - Spieler greifen sich automatisch an</li>
        <li><strong>Zuf√§llige Events</strong> - √úberraschende Boni und Events</li>
      </ul>
      
      <h3 style="color: #ff6b6b; margin-bottom: 10px;">Optionale Befehle:</h3>
      <ul style="margin-bottom: 20px;">
        <li><code>!defend</code> - Aktiviere Verteidigung (10 Sek.)</li>
        <li><code>!power</code> - Lade Spezialattacke auf</li>
        <li><code>!heal</code> - Heile dich (begrenzt verf√ºgbar)</li>
        <li><code>!stats</code> - Zeige deine Statistiken</li>
      </ul>
      
      <h3 style="color: #ff6b6b; margin-bottom: 10px;">Features:</h3>
      <ul style="margin-bottom: 20px;">
        <li>‚ú® Automatisches Kampfsystem</li>
        <li>üéØ Zuf√§llige Angriffe auf andere Spieler</li>
        <li>üéÅ Aktivit√§ts-Boni f√ºr Chat-Teilnahme</li>
        <li>üåü Zuf√§llige Events und √úberraschungen</li>
        <li>üèÜ Echtzeit-Leaderboard</li>
        <li>‚ö° Spektakul√§re Effekte</li>
      </ul>
      
      <h3 style="color: #ff6b6b; margin-bottom: 10px;">Tastenk√ºrzel:</h3>
      <ul style="margin-bottom: 20px;">
        <li><code>Strg + G</code> - Spiel starten/stoppen</li>
        <li><code>Strg + R</code> - Twitch-Verbindung neu starten</li>
        <li><code>Strg + C</code> - Spiel zur√ºcksetzen</li>
      </ul>
      
      <button id="closeHelp" style="
        background: linear-gradient(45deg, #4ecdc4, #45b7d1);
        border: none;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-family: 'Orbitron', monospace;
        font-weight: bold;
        margin-top: 20px;
      ">Schlie√üen</button>
    `,e.appendChild(t),document.body.appendChild(e),t.querySelector("#closeHelp")?.addEventListener("click",()=>{e.remove()}),e.addEventListener("click",i=>{i.target===e&&e.remove()})}setupDebugPanel(){let e=document.getElementById("debugPanel");e||(e=document.createElement("div"),e.id="debugPanel",e.style.cssText=`
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 15px;
        border-radius: 8px;
        z-index: 10000;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        max-width: 400px;
        max-height: 80vh;
        overflow-y: auto;
        display: none;
        border: 2px solid #ff4444;
      `,document.body.appendChild(e)),e.innerHTML=`
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
        <h3 style="margin: 0; color: #ff4444;">üîß Debug Panel</h3>
        <button id="debugPanelClose" style="background: #ff4444; border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer;">√ó</button>
      </div>
      <div style="display: flex; flex-direction: column; gap: 10px;">
        <button id="debugSpawn1" class="debug-btn">Spawn 1 Player</button>
        <button id="debugSpawn3" class="debug-btn">Spawn 3 Players</button>
        <button id="debugSpawn5" class="debug-btn">Spawn 5 Players (2 Aggressive)</button>
        <button id="debugNextWave" class="debug-btn">Force Next Wave</button>
        <button id="debugAttack" class="debug-btn">Test Attack</button>
        <button id="debugKill" class="debug-btn">Kill Random Player</button>
        <button id="debugClear" class="debug-btn">Clear All Players</button>
        <hr style="border-color: #444; margin: 10px 0;">
        <div style="font-size: 10px; color: #aaa;">
          <strong>Shortcuts:</strong><br>
          Ctrl+D: Toggle Panel<br>
          1: Spawn 1 Player<br>
          2: Spawn 3 Players<br>
          3: Spawn 5 Players<br>
          4: Next Wave<br>
          5: Test Attack<br>
          6: Kill Player<br>
        </div>
      </div>
    `;const t=document.createElement("style");t.textContent=`
      .debug-btn {
        background: #333;
        border: 1px solid #555;
        color: white;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        font-size: 12px;
      }
      .debug-btn:hover {
        background: #444;
        border-color: #ff4444;
      }
    `,document.head.appendChild(t),document.getElementById("debugPanelClose")?.addEventListener("click",()=>{this.toggleDebugPanel()}),document.getElementById("debugSpawn1")?.addEventListener("click",()=>{this.debugSystem?.spawnTestPlayer()}),document.getElementById("debugSpawn3")?.addEventListener("click",()=>{this.debugSystem?.spawnMultipleTestPlayers(3)}),document.getElementById("debugSpawn5")?.addEventListener("click",()=>{this.debugSystem?.spawnMultipleTestPlayers(5,2)}),document.getElementById("debugNextWave")?.addEventListener("click",()=>{this.debugSystem?.forceNextWave()}),document.getElementById("debugAttack")?.addEventListener("click",()=>{const s=this.debugSystem?.getAllPlayers();if(s&&s.length>0){const i=s[0];this.debugSystem?.executeTestCommand("attack",i.id,s.length>1?s[1].id:void 0)}}),document.getElementById("debugKill")?.addEventListener("click",()=>{this.debugSystem?.killPlayer()}),document.getElementById("debugClear")?.addEventListener("click",()=>{this.debugSystem?.clearAllPlayers()})}toggleDebugPanel(){const e=document.getElementById("debugPanel");if(e){const t=e.style.display!=="none";e.style.display=t?"none":"block"}}handleDebugShortcuts(e){if(this.debugSystem?.isDebugMode){if(e.ctrlKey&&e.key==="d"){e.preventDefault(),this.toggleDebugPanel();return}if(!(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement))switch(e.key){case"1":e.preventDefault(),this.debugSystem?.spawnTestPlayer();break;case"2":e.preventDefault(),this.debugSystem?.spawnMultipleTestPlayers(3);break;case"3":e.preventDefault(),this.debugSystem?.spawnMultipleTestPlayers(5,2);break;case"4":e.preventDefault(),this.debugSystem?.forceNextWave();break;case"5":{e.preventDefault();const t=this.debugSystem?.getAllPlayers();if(t&&t.length>0){const s=t[0];this.debugSystem?.executeTestCommand("attack",s.id,t.length>1?t[1].id:void 0)}break}case"6":e.preventDefault(),this.debugSystem?.killPlayer();break}}}}class ve{constructor(){o(this,"gameEngine");o(this,"effectsManager");o(this,"debugSystem");o(this,"notificationManager");o(this,"settingsManager");o(this,"twitchIntegration");o(this,"uiManager");o(this,"isInitialized");o(this,"settings");this.notificationManager=new ue,this.settingsManager=new ge,this.uiManager=new ye,this.gameEngine=null,this.effectsManager=null,this.debugSystem=new me,this.twitchIntegration=null,this.isInitialized=!1,this.settings=this.settingsManager.loadSettings(),this.initializeApp()}async initializeApp(){console.log("Initializing Stream AFK Game...");try{this.gameEngine=new re,this.effectsManager=new de,this.debugSystem.setGameEngine(this.gameEngine),this.debugSystem.enableDebugMode(),this.uiManager.setDebugSystem(this.debugSystem),this.uiManager.setGameEngine(this.gameEngine),window.effectsManager=this.effectsManager,window.debugSystem=this.debugSystem,this.settingsManager.checkCodeVersion()&&this.notificationManager.showNotification("Code aktualisiert - Einstellungen zur√ºckgesetzt!","info"),this.setupEventListeners(),this.initializeTwitchIntegration(),this.uiManager.setupUI(this.settings.channelName,this.settings.gameMode),this.isInitialized=!0,console.log("Stream AFK Game initialized successfully!"),console.log("Current settings:",this.settings)}catch(e){console.error("Failed to initialize game:",e),this.notificationManager.showError("Fehler beim Initialisieren des Spiels: "+e.message)}}initializeTwitchIntegration(){this.twitchIntegration=new pe(this.settings),this.twitchIntegration.initialize(()=>{console.log("Connected to Twitch chat"),this.notificationManager.showNotification("Verbunden mit Twitch Chat!","success"),this.settings.autoStart&&this.isInitialized&&(console.log("Auto-starting game after Twitch connection..."),setTimeout(()=>{this.startGame()},1e3))},e=>{this.gameEngine&&this.twitchIntegration?.handleMessage(e,this.gameEngine)},()=>{console.error("Failed to connect to Twitch"),this.notificationManager.showError("Verbindung zu Twitch fehlgeschlagen. Versuche es sp√§ter erneut.")})}setupEventListeners(){const e=document.getElementById("startGame"),t=document.getElementById("stopGame");e?.addEventListener("click",()=>this.startGame()),t?.addEventListener("click",()=>this.stopGame()),document.getElementById("channelName")?.addEventListener("change",a=>{const n=a.target;this.settings.channelName=n.value,this.settingsManager.saveSettings(this.settings),this.reconnectTwitch()}),document.getElementById("gameMode")?.addEventListener("change",a=>{const n=a.target;this.settings.gameMode=n.value,this.gameEngine&&(this.gameEngine.gameMode=n.value),this.settingsManager.saveSettings(this.settings)}),document.addEventListener("keydown",a=>{if(this.debugSystem?.isDebugMode&&this.uiManager.handleDebugShortcuts(a),a.ctrlKey)switch(a.key){case"g":a.preventDefault(),this.gameEngine?.isRunning?this.stopGame():this.startGame();break;case"r":a.preventDefault(),this.reconnectTwitch();break;case"c":a.preventDefault(),this.clearGame();break}}),window.addEventListener("beforeunload",()=>{this.cleanup()}),window.addEventListener("resize",()=>{this.handleResize()})}startGame(){if(!this.isInitialized){this.notificationManager.showError("Spiel noch nicht initialisiert");return}if(!this.twitchIntegration?.isConnected()){this.notificationManager.showError("Nicht mit Twitch verbunden");return}this.gameEngine?.startGame(),this.notificationManager.showNotification("Spiel gestartet!","success");const e=document.getElementById("startGame"),t=document.getElementById("stopGame");e&&(e.disabled=!0),t&&(t.disabled=!1)}stopGame(){if(!this.isInitialized)return;this.gameEngine?.stopGame(),this.notificationManager.showNotification("Spiel gestoppt!","info");const e=document.getElementById("startGame"),t=document.getElementById("stopGame");e&&(e.disabled=!1),t&&(t.disabled=!0)}clearGame(){if(!this.isInitialized||!this.gameEngine)return;this.gameEngine.players.clear(),this.gameEngine.renderSystem.clearBattlefield(),this.gameEngine.currentWave=1,this.gameEngine.waveSystem.updateWaveDisplay(),this.gameEngine.updateActiveViewers(),this.gameEngine.updateLeaderboard();const e=document.getElementById("actionFeed");e&&(e.innerHTML=""),this.notificationManager.showNotification("Spiel zur√ºckgesetzt!","info")}reconnectTwitch(){this.twitchIntegration&&(this.notificationManager.showNotification("Verbindung wird neu aufgebaut...","info"),this.twitchIntegration.changeChannel(this.settings.channelName))}handleResize(){this.gameEngine?.players&&this.gameEngine.players.forEach(e=>{e.element&&(e.position=e.generateRandomPosition(),e.element.style.left=e.position.x+"px",e.element.style.top=e.position.y+"px")})}cleanup(){this.twitchIntegration?.disconnect(),this.gameEngine?.stopGame(),this.settingsManager.saveSettings(this.settings)}getGameStats(){return this.gameEngine?this.gameEngine.getGameStats():null}getActivePlayers(){return this.gameEngine?Array.from(this.gameEngine.players.values()):[]}isGameRunning(){return this.gameEngine?this.gameEngine.isRunning:!1}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded, initializing game...");const h=document.createElement("style");h.textContent=`
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOut {
      from { transform: translateX(0); opacity: 1; }
      to { transform: translateX(100%); opacity: 0; }
    }
    
    @keyframes shockwaveHitPulse {
      0% {
        transform: scale(0.8);
        opacity: 1;
      }
      50% {
        transform: scale(1.2);
        opacity: 0.8;
      }
      100% {
        transform: scale(1.5);
        opacity: 0;
      }
    }
    
    .command:hover .tooltip {
      opacity: 1 !important;
    }
  `,document.head.appendChild(h),window.streamAFKGame=new ve});
//# sourceMappingURL=main-Bf-poA-T.js.map

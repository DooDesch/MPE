{"version":3,"file":"main-Bf-poA-T.js","sources":["../../src/game/events/EventSystem.ts","../../src/game/systems/RenderSystem.ts","../../src/game/entities/Pawn.ts","../../src/game/systems/CombatSystem.ts","../../src/game/systems/WaveSystem.ts","../../src/game/ui/UISystem.ts","../../src/game/components/Component.ts","../../src/game/components/ComponentContainer.ts","../../src/game/entities/Character.ts","../../src/game/components/AutoCombat.ts","../../src/game/entities/Player.ts","../../src/game/systems/commands/join.ts","../../src/game/systems/commands/defend.ts","../../src/game/systems/commands/power.ts","../../src/game/systems/commands/heal.ts","../../src/game/systems/commands/stats.ts","../../src/game/entities/EmojiPawn.ts","../../src/game/entities/EmojiPawns/MonkeyEmojiPawn.ts","../../src/game/entities/EmojiPawns/BananaEmojiPawn.ts","../../src/game/systems/commands/banana.ts","../../src/game/systems/commands/activity.ts","../../src/game/systems/commands/index.ts","../../src/game/systems/CommandHandler.ts","../../src/game/entities/AIEnemy.ts","../../src/game/GameEngine.ts","../../src/effects/Particle.ts","../../src/effects/ParticleSystem.ts","../../src/effects/SoundSystem.ts","../../src/effects/EffectsManager.ts","../../src/debug/DebugSystem.ts","../../src/utils/NotificationManager.ts","../../src/utils/SettingsManager.ts","../../src/twitchClient.ts","../../src/integration/TwitchIntegration.ts","../../src/ui/UIManager.ts","../../src/main.ts"],"sourcesContent":["import type { Character } from '../entities/Character.js';\n\ntype PlayerLike = Character;\n\ntype EventHandler = (data?: unknown) => void;\n\nclass EventSystem {\n  events: unknown[];\n  eventHandlers: Map<string, EventHandler[]>;\n\n  constructor() {\n    this.events = [];\n    this.eventHandlers = new Map();\n  }\n\n  on(eventType: string, handler: EventHandler): void {\n    if (!this.eventHandlers.has(eventType)) {\n      this.eventHandlers.set(eventType, []);\n    }\n    this.eventHandlers.get(eventType).push(handler);\n  }\n\n  off(eventType: string, handler: EventHandler): void {\n    if (this.eventHandlers.has(eventType)) {\n      const handlers = this.eventHandlers.get(eventType);\n      const index = handlers.indexOf(handler);\n      if (index > -1) {\n        handlers.splice(index, 1);\n      }\n    }\n  }\n\n  emit(eventType: string, data?: unknown): void {\n    if (this.eventHandlers.has(eventType)) {\n      this.eventHandlers.get(eventType).forEach(handler => {\n        try {\n          handler(data);\n        } catch (error) {\n          console.error(`Error in event handler for ${eventType}:`, error);\n        }\n      });\n    }\n  }\n\n  triggerRandomEvent(players: Map<string, PlayerLike>): void {\n    const events = ['healing_wave', 'power_surge', 'defense_boost', 'chaos_mode', 'bonus_round'];\n\n    const event = events[Math.floor(Math.random() * events.length)];\n    this.executeRandomEvent(event, players);\n  }\n\n  executeRandomEvent(eventType: string, players: Map<string, PlayerLike>): void {\n    const playerArray = Array.from(players.values());\n\n    switch (eventType) {\n      case 'healing_wave':\n        this.healingWaveEvent(playerArray);\n        break;\n\n      case 'power_surge':\n        this.powerSurgeEvent(playerArray);\n        break;\n\n      case 'defense_boost':\n        this.defenseBoostEvent(playerArray);\n        break;\n\n      case 'chaos_mode':\n        this.chaosModeEvent(playerArray);\n        break;\n\n      case 'bonus_round':\n        this.bonusRoundEvent(playerArray);\n        break;\n    }\n  }\n\n  healingWaveEvent(players: PlayerLike[]): void {\n    players.forEach(player => {\n      if (player.isDead) return;\n\n      player.health = Math.min(player.health + 20, player.maxHealth);\n      player.addEffect('heal');\n\n      if (window.effectsManager) {\n        window.effectsManager.triggerHealEffect(player);\n      }\n    });\n\n    this.emit('actionFeed', {\n      message: 'üåä Heilwelle! Alle Spieler regenerieren 20 HP!',\n      type: 'event'\n    });\n  }\n\n  powerSurgeEvent(players: PlayerLike[]): void {\n    players.forEach(player => {\n      if (player.isDead) return;\n\n      player.addPowerCharge(1);\n      player.addEffect('power');\n\n      if (window.effectsManager) {\n        window.effectsManager.triggerPowerEffect(player);\n      }\n    });\n\n    this.emit('actionFeed', {\n      message: '‚ö° Kraftsto√ü! Alle Spieler erhalten +1 Power!',\n      type: 'event'\n    });\n  }\n\n  defenseBoostEvent(players: PlayerLike[]): void {\n    players.forEach(player => {\n      if (player.isDead) return;\n\n      player.startDefense(10000); // 10 seconds\n      player.addEffect('defending');\n\n      if (window.effectsManager) {\n        window.effectsManager.triggerDefendEffect(player, 10000); // Pass duration\n      }\n    });\n\n    this.emit('actionFeed', {\n      message: 'üõ°Ô∏è Verteidigungsboost! Alle Spieler sind 10 Sekunden gesch√ºtzt!',\n      type: 'event'\n    });\n  }\n\n  chaosModeEvent(_players: PlayerLike[]): void {\n    this.emit('chaosMode', { duration: 15000 });\n\n    this.emit('actionFeed', {\n      message: 'üí• Chaos-Modus! 15 Sekunden intensiver Kampf!',\n      type: 'event'\n    });\n\n    // Trigger explosion effects\n    if (window.effectsManager) {\n      const battlefield = document.querySelector('.battlefield');\n      const rect = battlefield.getBoundingClientRect();\n      for (let i = 0; i < 3; i++) {\n        setTimeout(() => {\n          window.effectsManager.triggerExplosionEffect({\n            x: Math.random() * rect.width,\n            y: Math.random() * rect.height\n          });\n        }, i * 1000);\n      }\n    }\n  }\n\n  bonusRoundEvent(players: PlayerLike[]): void {\n    players.forEach(player => {\n      player.addScore(25);\n    });\n\n    this.emit('actionFeed', {\n      message: 'üéÅ Bonus-Runde! Alle Spieler erhalten +25 Punkte!',\n      type: 'event'\n    });\n  }\n\n  createBananaEvent(player: PlayerLike | { displayName: string }): void {\n    const funMessages = [\n      'üçå Banana Power! Alle Spieler tanzen kurz!',\n      'üçå Eine riesige Banane schwebt √ºber dem Schlachtfeld!',\n      'üçå Bananen-Regen! Alle Spieler sind verwirrt!',\n      'üçå Monkey Mode aktiviert! Oook ook ook!',\n      'üçå Die Banane des Schicksals erscheint!',\n      'üçå Bananen-Blitz! Alle Spieler leuchten gelb!',\n      'üçå Potassium-Boost! Alle f√ºhlen sich ges√ºnder!',\n      'üçå Banana Split! Das Schlachtfeld wird rutschig!',\n      'üçå Affenalarm! Alle Spieler klettern kurz herum!'\n    ];\n\n    const randomMessage = funMessages[Math.floor(Math.random() * funMessages.length)];\n\n    this.emit('actionFeed', {\n      message: `${randomMessage} (von ${player.displayName})`,\n      type: 'banana-fun'\n    });\n\n    this.emit('bananaEvent', { player });\n  }\n\n  getEventHistory(): unknown[] {\n    return [...this.events];\n  }\n\n  clearEventHistory(): void {\n    this.events = [];\n  }\n}\n\nexport { EventSystem };\n","import type { Character } from '../entities/Character.js';\nimport type { AIEnemy } from '../entities/AIEnemy.js';\nimport type { EmojiPawn } from '../entities/EmojiPawn.js';\n\nclass RenderSystem {\n  battlefield: HTMLElement | null;\n  playerElements: Map<string, HTMLElement>;\n\n  constructor() {\n    this.battlefield = document.getElementById('battlefield');\n    this.playerElements = new Map();\n  }\n\n  spawnPlayer(player: Character): void {\n    if (this.playerElements.has(player.id)) {\n      this.removePlayer(player.id);\n    }\n\n    const avatar = this.createPlayerAvatar(player);\n    this.battlefield.appendChild(avatar);\n    player.element = avatar;\n    this.playerElements.set(player.id, avatar);\n\n    // Add spawn effect\n    player.addEffect('spawn');\n\n    // Trigger spawn effect\n    if (window.effectsManager) {\n      window.effectsManager.triggerSpawnEffect(player);\n    }\n\n    // Show class announcement if first spawn\n    if (!player.hasBeenAnnounced) {\n      this.showClassAnnouncement(player);\n      player.hasBeenAnnounced = true;\n    }\n  }\n\n  spawnAIEnemy(enemy: AIEnemy): void {\n    if (this.playerElements.has(enemy.id)) {\n      this.removePlayer(enemy.id);\n    }\n\n    const avatar = this.createAIAvatar(enemy);\n    this.battlefield.appendChild(avatar);\n    enemy.element = avatar;\n    this.playerElements.set(enemy.id, avatar);\n\n    // Add spawn effect\n    enemy.addEffect('spawn');\n\n    // Trigger spawn effect\n    if (window.effectsManager) {\n      window.effectsManager.triggerSpawnEffect(enemy);\n    }\n  }\n\n  spawnEmojiPawn(emojiPawn: EmojiPawn): void {\n    if (this.playerElements.has(emojiPawn.id)) {\n      this.removePlayer(emojiPawn.id);\n    }\n\n    const avatar = this.createEmojiAvatar(emojiPawn);\n    this.battlefield.appendChild(avatar);\n    emojiPawn.element = avatar;\n    this.playerElements.set(emojiPawn.id, avatar);\n\n    // Trigger spawn effect\n    if (window.effectsManager) {\n      window.effectsManager.triggerSpawnEffect(emojiPawn);\n    }\n  }\n\n  createEmojiAvatar(emojiPawn: EmojiPawn): HTMLElement {\n    const avatar = document.createElement('div');\n    avatar.className = 'emoji-pawn';\n    avatar.style.position = 'absolute';\n    avatar.style.left = emojiPawn.position.x + 'px';\n    avatar.style.top = emojiPawn.position.y + 'px';\n    avatar.style.width = emojiPawn.size + 'px';\n    avatar.style.height = emojiPawn.size + 'px';\n    avatar.style.zIndex = '75'; // Between AI enemies and players\n    avatar.style.fontSize = emojiPawn.size * 0.8 + 'px';\n    avatar.style.display = 'flex';\n    avatar.style.alignItems = 'center';\n    avatar.style.justifyContent = 'center';\n    avatar.style.borderRadius = '50%';\n    avatar.style.background = `radial-gradient(circle, ${emojiPawn.color}80, ${emojiPawn.color}40)`;\n    avatar.style.border = `2px solid ${emojiPawn.color}`;\n    avatar.style.boxShadow = `0 0 10px ${emojiPawn.color}60`;\n    avatar.textContent = emojiPawn.emoji;\n    avatar.title = emojiPawn.displayName;\n    avatar.setAttribute('data-emoji-id', emojiPawn.id);\n\n    // Add health bar (centered like normal player health bars)\n    const healthBar = document.createElement('div');\n    healthBar.className = 'health-bar emoji-health-bar';\n    healthBar.style.cssText = `\n      position: absolute;\n      bottom: -8px;\n      left: 50%;\n      transform: translateX(-50%);\n      width: ${emojiPawn.size}px;\n      height: 4px;\n      background: rgba(0, 0, 0, 0.5);\n      border-radius: 2px;\n      overflow: hidden;\n    `;\n\n    const healthFill = document.createElement('div');\n    healthFill.className = 'health-fill';\n    healthFill.style.cssText = `\n      width: 100%;\n      height: 100%;\n      background: linear-gradient(90deg, #26de81, #20bf6b);\n      transition: width 0.3s ease;\n    `;\n    healthBar.appendChild(healthFill);\n    avatar.appendChild(healthBar);\n\n    this.updateEmojiHealth(emojiPawn, avatar);\n\n    return avatar;\n  }\n\n  updateEmojiHealth(emojiPawn: EmojiPawn, element?: HTMLElement): void {\n    const emojiElement = element || emojiPawn.element;\n    if (!emojiElement) return;\n\n    const healthBar = emojiElement.querySelector<HTMLElement>('.health-fill');\n    if (healthBar) {\n      const healthPercent = Math.max(0, (emojiPawn.health / emojiPawn.maxHealth) * 100);\n      healthBar.style.width = healthPercent + '%';\n\n      // Update color based on health\n      if (healthPercent > 60) {\n        healthBar.style.background = 'linear-gradient(90deg, #26de81, #20bf6b)';\n      } else if (healthPercent > 30) {\n        healthBar.style.background = 'linear-gradient(90deg, #feca57, #ff9ff3)';\n      } else {\n        healthBar.style.background = 'linear-gradient(90deg, #ff6b6b, #ee5a6f)';\n      }\n    }\n  }\n\n  createPlayerAvatar(player: Character): HTMLElement {\n    const avatar = document.createElement('div');\n    avatar.className = 'fighter-avatar';\n    avatar.style.position = 'absolute';\n    avatar.style.left = player.position.x + 'px';\n    avatar.style.top = player.position.y + 'px';\n    avatar.style.zIndex = '100'; // Players always on top\n    avatar.style.background = `linear-gradient(45deg, ${player.color}, ${this.lightenColor(player.color)})`;\n\n    // Display text\n    const displayText =\n      player.displayName.length > 1\n        ? player.displayName.charAt(0).toUpperCase() +\n          player.displayName.charAt(player.displayName.length - 1).toLowerCase()\n        : player.displayName.substring(0, 2).toUpperCase();\n    avatar.textContent = displayText;\n\n    // Styling\n    avatar.style.fontWeight = '900';\n    avatar.style.fontSize = '14px';\n    avatar.style.textShadow = `\n            0 0 3px rgba(0,0,0,0.8), \n            0 0 6px ${player.color}, \n            0 0 9px ${player.color}\n        `;\n\n    // Unique border\n    const borderStyle = this.generatePlayerBorder(player.displayName);\n    avatar.style.border = `3px ${borderStyle.type} ${borderStyle.color}`;\n    avatar.style.boxShadow = `0 0 15px ${borderStyle.color}`;\n\n    // Add components\n    this.addHealthBar(avatar);\n    this.addStatusBar(avatar, player);\n    this.addNameLabel(avatar, player);\n\n    this.updatePlayerTitle(player);\n\n    return avatar;\n  }\n\n  createAIAvatar(enemy: AIEnemy): HTMLElement {\n    const avatar = document.createElement('div');\n    avatar.className = 'fighter-avatar ai-enemy';\n    avatar.style.position = 'absolute';\n    avatar.style.left = enemy.position.x + 'px';\n    avatar.style.top = enemy.position.y + 'px';\n    avatar.style.zIndex = '50'; // AI enemies below players\n    avatar.style.background = `linear-gradient(45deg, ${enemy.color}, ${this.lightenColor(enemy.color)})`;\n\n    // Display text\n    avatar.textContent = enemy.displayName.substring(0, 2).toUpperCase();\n    avatar.title = enemy.displayName + ' (KI)';\n\n    // Enemy-specific styling\n    const borderStyle = enemy.getBorderStyle();\n    avatar.style.border = borderStyle.border;\n    avatar.style.boxShadow = borderStyle.boxShadow;\n\n    // Add health bar with enemy-specific color\n    this.addHealthBar(avatar, enemy.getHealthBarColor());\n\n    return avatar;\n  }\n\n  addHealthBar(avatar: HTMLElement, color: string | null = null): void {\n    const healthBar = document.createElement('div');\n    healthBar.className = 'health-bar';\n    const healthFill = document.createElement('div');\n    healthFill.className = 'health-fill';\n    healthFill.style.width = '100%';\n\n    if (color) {\n      healthFill.style.background = color;\n    }\n\n    healthBar.appendChild(healthFill);\n    avatar.appendChild(healthBar);\n  }\n\n  addStatusBar(avatar: HTMLElement, player: Character): void {\n    const statusBar = document.createElement('div');\n    statusBar.className = 'status-bar player-status-bar';\n    statusBar.style.cssText = `\n            position: absolute;\n            top: -35px;\n            left: 50%;\n            transform: translateX(-50%);\n            font-size: 10px !important;\n            color: white !important;\n            text-align: center !important;\n            text-shadow: 1px 1px 2px rgba(0,0,0,0.8) !important;\n            pointer-events: none;\n            background: rgba(0,0,0,0.9) !important;\n            border-radius: 8px !important;\n            padding: 3px 8px !important;\n            white-space: nowrap !important;\n            min-width: fit-content !important;\n            border: 1px solid rgba(255,255,255,0.3) !important;\n            font-family: 'Orbitron', monospace !important;\n            font-weight: bold !important;\n            display: block !important;\n            visibility: visible !important;\n            opacity: 1 !important;\n        `;\n\n    const remainingHeals = Math.max(0, 5 - (player.healsUsed || 0));\n    const powerCharge = player.powerCharge || 0;\n    statusBar.textContent = `‚ö°${powerCharge} | üíö${remainingHeals}`;\n    avatar.appendChild(statusBar);\n  }\n\n  addNameLabel(avatar: HTMLElement, player: Character): void {\n    const nameLabel = document.createElement('div');\n    nameLabel.className = 'player-name-label';\n    nameLabel.textContent = player.displayName;\n    nameLabel.style.cssText = `\n            position: absolute;\n            top: -55px;\n            left: 50%;\n            transform: translateX(-50%);\n            font-size: 9px;\n            color: ${player.color};\n            text-align: center;\n            text-shadow: 1px 1px 2px rgba(0,0,0,0.9);\n            pointer-events: none;\n            background: rgba(0,0,0,0.7);\n            border-radius: 4px;\n            padding: 1px 4px;\n            white-space: nowrap;\n            max-width: 80px;\n            overflow: hidden;\n            text-overflow: ellipsis;\n            font-weight: bold;\n            border: 1px solid ${player.color};\n        `;\n    avatar.appendChild(nameLabel);\n  }\n\n  updatePlayerHealth(player: Character | EmojiPawn): void {\n    if ('powerCharge' in player) {\n      // Character health update\n      const element = player.element;\n      if (!element) return;\n\n      const healthBar = element.querySelector<HTMLElement>('.health-fill');\n      if (healthBar) {\n        const healthPercent = Math.max(0, (player.health / player.maxHealth) * 100);\n        healthBar.style.width = healthPercent + '%';\n      }\n    } else {\n      // EmojiPawn health update\n      this.updateEmojiHealth(player as EmojiPawn);\n    }\n  }\n\n  updatePlayerTitle(player: Character): void {\n    if (!player.element) return;\n\n    const remainingHeals = Math.max(0, 5 - (player.healsUsed || 0));\n    const powerCharge = player.powerCharge || 0;\n    const title = `${player.displayName} | HP: ${player.health}/${player.maxHealth} | ‚ö°${powerCharge}/5 | üíö${remainingHeals}/5 | Punkte: ${player.score}`;\n    player.element.title = title;\n\n    // Update status bar\n    const statusBar = player.element.querySelector<HTMLElement>('.status-bar');\n    if (statusBar) {\n      statusBar.textContent = `‚ö°${powerCharge} | üíö${remainingHeals}`;\n    } else {\n      console.warn(`[RenderSystem] Status bar not found for ${player.displayName}`);\n    }\n\n    // Update name label color based on health\n    const nameLabel = player.element.querySelector<HTMLElement>('.player-name-label');\n    if (nameLabel) {\n      const healthPercentage = player.health / player.maxHealth;\n      if (healthPercentage < 0.3) {\n        nameLabel.style.color = '#ff4444';\n        nameLabel.style.borderColor = '#ff4444';\n        nameLabel.style.animation = 'pulse 1s infinite';\n      } else if (healthPercentage < 0.6) {\n        nameLabel.style.color = '#ffaa00';\n        nameLabel.style.borderColor = '#ffaa00';\n        nameLabel.style.animation = 'none';\n      } else {\n        nameLabel.style.color = player.color;\n        nameLabel.style.borderColor = player.color;\n        nameLabel.style.animation = 'none';\n      }\n    }\n\n    // Add activity visual effect (glow for high activity)\n    const playerAvatar = player.element;\n    if (player.activityCount > 10) {\n      playerAvatar.style.filter = `drop-shadow(0 0 10px rgba(255, 215, 0, 0.6))`;\n    } else if (player.activityCount > 5) {\n      playerAvatar.style.filter = 'drop-shadow(0 0 5px rgba(255, 215, 0, 0.4))';\n    } else if (player.activityCount > 0) {\n      playerAvatar.style.filter = 'none';\n    }\n  }\n\n  removePlayer(playerId: string): void {\n    const element = this.playerElements.get(playerId);\n    if (element) {\n      element.remove();\n      this.playerElements.delete(playerId);\n    }\n  }\n\n  updatePlayerPosition(player: Character): void {\n    if (player.element) {\n      player.element.style.left = player.position.x + 'px';\n      player.element.style.top = player.position.y + 'px';\n    }\n  }\n\n  updatePlayerEffects(player: Character): void {\n    // Update defense status\n    player.updateDefenseStatus();\n\n    // Random movement animation\n    if (player.element && Math.random() < 0.1) {\n      const newPos = {\n        x: player.position.x + (Math.random() - 0.5) * 20,\n        y: player.position.y + (Math.random() - 0.5) * 20\n      };\n\n      // Keep in bounds\n      const battlefieldRect = this.battlefield.getBoundingClientRect();\n      newPos.x = Math.max(20, Math.min(newPos.x, battlefieldRect.width - 60));\n      newPos.y = Math.max(20, Math.min(newPos.y, battlefieldRect.height - 60));\n\n      player.updatePosition(newPos);\n    }\n  }\n\n  clearBattlefield(): void {\n    if (!this.battlefield) return;\n    const avatars = this.battlefield.querySelectorAll('.fighter-avatar');\n    avatars.forEach(avatar => avatar.remove());\n    this.playerElements.clear();\n  }\n\n  generatePlayerBorder(playerName: string): { type: string; color: string } {\n    const hash = this.hashCode(playerName);\n    const borderTypes = ['solid', 'dashed', 'dotted', 'double'];\n    const borderColors = [\n      '#ff6b6b',\n      '#4ecdc4',\n      '#45b7d1',\n      '#96ceb4',\n      '#feca57',\n      '#ff9ff3',\n      '#54a0ff',\n      '#5f27cd',\n      '#00d2d3',\n      '#ff9f43',\n      '#a55eea',\n      '#26de81',\n      '#fd79a8',\n      '#fdcb6e',\n      '#e17055'\n    ];\n\n    const typeIndex = Math.abs(hash) % borderTypes.length;\n    const colorIndex = Math.abs(hash * 7) % borderColors.length;\n\n    return {\n      type: borderTypes[typeIndex],\n      color: borderColors[colorIndex]\n    };\n  }\n\n  hashCode(str: string): number {\n    let hash = 0;\n    for (let i = 0; i < str.length; i++) {\n      const char = str.charCodeAt(i);\n      hash = (hash << 5) - hash + char;\n      hash = hash & hash;\n    }\n    return hash;\n  }\n\n  lightenColor(color: string): string {\n    const num = parseInt(color.replace('#', ''), 16);\n    const amt = 44;\n    const R = (num >> 16) + amt;\n    const G = ((num >> 8) & 0x00ff) + amt;\n    const B = (num & 0x0000ff) + amt;\n    return (\n      '#' +\n      (\n        0x1000000 +\n        (R < 255 ? (R < 1 ? 0 : R) : 255) * 0x10000 +\n        (G < 255 ? (G < 1 ? 0 : G) : 255) * 0x100 +\n        (B < 255 ? (B < 1 ? 0 : B) : 255)\n      )\n        .toString(16)\n        .slice(1)\n    );\n  }\n\n  showClassAnnouncement(player: Character): void {\n    if (!player.element || !this.battlefield) return;\n    const announcement = document.createElement('div');\n    announcement.className = 'class-announcement';\n\n    const playerRect = player.element.getBoundingClientRect();\n    const battlefieldRect = this.battlefield.getBoundingClientRect();\n\n    // Position above player, but keep within battlefield bounds\n    const posX = playerRect.left - battlefieldRect.left + playerRect.width / 2;\n    let posY = playerRect.top - battlefieldRect.top - 80;\n\n    // Ensure announcement stays within vertical bounds\n    // If too close to top edge, position below player instead\n    if (posY < 20) {\n      posY = playerRect.top - battlefieldRect.top + playerRect.height + 50;\n    }\n\n    // Ensure announcement doesn't go below battlefield\n    if (posY > battlefieldRect.height - 60) {\n      posY = battlefieldRect.height - 60;\n    }\n\n    // Clamp horizontal position to prevent overflow\n    const clampedPosX = Math.max(50, Math.min(posX, battlefieldRect.width - 50));\n\n    announcement.style.cssText = `\n            position: absolute;\n            left: ${clampedPosX}px;\n            top: ${posY}px;\n            transform: translateX(-50%);\n            font-family: 'Orbitron', monospace;\n            font-weight: 900;\n            font-size: 18px;\n            color: ${player.color};\n            text-shadow: \n                0 0 10px ${player.color},\n                0 0 20px ${player.color},\n                0 0 30px ${player.color},\n                2px 2px 4px rgba(0,0,0,0.9);\n            text-align: center;\n            z-index: 10000;\n            pointer-events: none;\n            white-space: nowrap;\n            opacity: 0;\n            animation: classAnnouncement 3s ease-out forwards;\n        `;\n\n    announcement.textContent = player.playerClass;\n\n    this.battlefield.appendChild(announcement);\n\n    // Remove after animation completes\n    setTimeout(() => {\n      if (announcement.parentNode) {\n        announcement.parentNode.removeChild(announcement);\n      }\n    }, 3000);\n  }\n}\n\nexport { RenderSystem };\n","import type { EventSystem } from '../events/EventSystem.js';\n\nexport type { Position };\n\ninterface Position {\n  x: number;\n  y: number;\n}\n\n/**\n * Tag types for pawns to determine attack priorities\n * Using enum for type safety and consistency\n */\nexport enum PawnTag {\n  Player = 'Player',\n  Enemy = 'Enemy',\n  Emoji = 'Emoji',\n  Neutral = 'Neutral'\n}\n\n/**\n * Base class for all game entities (Pawns)\n * Can be extended to create Characters, Animals, or other entity types\n */\nclass Pawn {\n  id: string;\n  displayName: string;\n  color: string;\n  health: number;\n  maxHealth: number;\n  position: Position;\n  element: HTMLElement | null;\n  isDead: boolean;\n  eventSystem: EventSystem | null;\n  tags: Set<PawnTag>; // Tags to determine attack priorities and behavior\n\n  constructor(id: string, displayName: string, color: string, maxHealth: number) {\n    this.id = id;\n    this.displayName = displayName;\n    this.color = color;\n    this.health = maxHealth;\n    this.maxHealth = maxHealth;\n    this.position = this.generateRandomPosition();\n    this.element = null;\n    this.isDead = false;\n    this.eventSystem = null;\n    this.tags = new Set<PawnTag>();\n  }\n\n  /**\n   * Add a tag to this pawn\n   */\n  addTag(tag: PawnTag): void {\n    this.tags.add(tag);\n  }\n\n  /**\n   * Remove a tag from this pawn\n   */\n  removeTag(tag: PawnTag): void {\n    this.tags.delete(tag);\n  }\n\n  /**\n   * Check if this pawn has a specific tag\n   */\n  hasTag(tag: PawnTag): boolean {\n    return this.tags.has(tag);\n  }\n\n  /**\n   * Check if this pawn has any of the specified tags\n   */\n  hasAnyTag(...tags: PawnTag[]): boolean {\n    return tags.some(tag => this.tags.has(tag));\n  }\n\n  setEventSystem(eventSystem: EventSystem): void {\n    this.eventSystem = eventSystem;\n  }\n\n  generateRandomColor(): string {\n    const colors = [\n      '#ff6b6b',\n      '#4ecdc4',\n      '#45b7d1',\n      '#96ceb4',\n      '#feca57',\n      '#ff9ff3',\n      '#54a0ff',\n      '#5f27cd',\n      '#00d2d3',\n      '#ff9f43',\n      '#a55eea',\n      '#26de81',\n      '#fd79a8',\n      '#fdcb6e',\n      '#e17055',\n      '#74b9ff',\n      '#0984e3',\n      '#6c5ce7',\n      '#a29bfe',\n      '#fd79a8'\n    ];\n    return colors[Math.floor(Math.random() * colors.length)];\n  }\n\n  generateRandomPosition(): Position {\n    const battlefield = document.getElementById('battlefield');\n    if (!battlefield) return { x: 400, y: 300 };\n\n    const battlefieldRect = battlefield.getBoundingClientRect();\n    const margin = 50;\n\n    return {\n      x: Math.random() * (battlefieldRect.width - 2 * margin) + margin,\n      y: Math.random() * (battlefieldRect.height - 2 * margin) + margin\n    };\n  }\n\n  updatePosition(newPosition: Position): void {\n    this.position = newPosition;\n    if (this.element) {\n      this.element.style.left = newPosition.x + 'px';\n      this.element.style.top = newPosition.y + 'px';\n    }\n  }\n\n  /**\n   * Take damage from an attack\n   * @param damage - Base damage amount\n   * @param attacker - Optional attacker pawn (for callbacks and reactions)\n   * @returns True if this pawn was killed by the damage\n   */\n  takeDamage(damage: number, attacker?: Pawn): boolean {\n    const actualDamage = this.calculateReceivedDamage(damage, attacker);\n    this.health = Math.max(0, this.health - actualDamage);\n\n    // Emit health update event\n    if (this.eventSystem) {\n      this.eventSystem.emit('healthUpdate', {\n        pawn: this,\n        health: this.health,\n        maxHealth: this.maxHealth\n      });\n    }\n\n    // Check if this pawn was killed\n    const wasKilled = this.health <= 0;\n    if (wasKilled && !this.isDead) {\n      this.onDeath(attacker);\n    }\n\n    return wasKilled;\n  }\n\n  /**\n   * Try to damage this pawn - main entry point for damage\n   * The pawn handles all damage calculation, reduction, and death logic itself\n   * @param damage - Base damage amount\n   * @param attacker - Attacker that deals the damage\n   * @returns true if the pawn was killed, false otherwise\n   */\n  tryDamage(damage: number, attacker?: Pawn): boolean {\n    // Calculate actual received damage (can be reduced by defense, etc.)\n    const actualDamage = this.calculateReceivedDamage(damage, attacker);\n\n    // Apply damage\n    const wasKilled = this.takeDamage(actualDamage, attacker);\n\n    return wasKilled;\n  }\n\n  /**\n   * Calculate how much damage this pawn actually receives\n   * Can be overridden by subclasses for special damage reduction logic\n   * @param incomingDamage - Base incoming damage\n   * @param attacker - Optional attacker\n   * @returns Actual damage to be applied\n   */\n  protected calculateReceivedDamage(incomingDamage: number, _attacker?: Pawn): number {\n    // Base implementation: no reduction\n    return incomingDamage;\n  }\n\n  /**\n   * Called when this pawn dies\n   * Can be overridden by subclasses for special death behavior\n   * @param attacker - Optional attacker that caused the death\n   */\n  protected onDeath(_attacker?: Pawn): void {\n    this.kill();\n  }\n\n  /**\n   * Gain health\n   * @param amount - Amount of health to gain\n   * @returns The amount of health gained\n   */\n  gainHealth(amount: number): number {\n    const oldHealth = this.health;\n    this.health = Math.min(this.health + amount, this.maxHealth);\n\n    // Emit health update event if health changed\n    if (this.health !== oldHealth && this.eventSystem) {\n      this.eventSystem.emit('healthUpdate', {\n        pawn: this,\n        player: this, // Also include 'player' for backwards compatibility\n        health: this.health,\n        maxHealth: this.maxHealth\n      });\n    }\n\n    return this.health - oldHealth;\n  }\n\n  kill(): void {\n    this.isDead = true;\n    if (this.element) {\n      this.element.style.opacity = '0.3';\n      this.element.style.filter = 'grayscale(100%)';\n      this.element.classList.add('dead');\n    }\n  }\n\n  respawn(): void {\n    this.health = this.maxHealth;\n    this.position = this.generateRandomPosition();\n    this.isDead = false;\n\n    // Emit health update event\n    if (this.eventSystem) {\n      this.eventSystem.emit('healthUpdate', {\n        pawn: this,\n        health: this.health,\n        maxHealth: this.maxHealth\n      });\n    }\n\n    if (this.element) {\n      this.element.style.opacity = '1';\n      this.element.style.filter = 'none';\n      this.element.classList.remove('dead');\n      this.updatePosition(this.position);\n    }\n  }\n\n  /**\n   * Get basic stats that all pawns have\n   */\n  getBasicStats(): {\n    id: string;\n    displayName: string;\n    health: number;\n    maxHealth: number;\n    isDead: boolean;\n  } {\n    return {\n      id: this.id,\n      displayName: this.displayName,\n      health: this.health,\n      maxHealth: this.maxHealth,\n      isDead: this.isDead\n    };\n  }\n}\n\nexport { Pawn };\n","import type { GameSettings } from '../GameEngine.js';\nimport type { GameEngine } from '../GameEngine.js';\nimport { Character } from '../entities/Character.js';\nimport { PawnTag } from '../entities/Pawn.js';\nimport type { AIEnemy } from '../entities/AIEnemy.js';\nimport type { MessageData } from '../../twitchClient.js';\n\nimport type { EmojiPawn } from '../entities/EmojiPawn.js';\n\ntype Entity = Character | EmojiPawn;\n\ninterface AttackResult {\n  damage: number;\n  wasKilled: boolean;\n  attacker: string;\n  target: string;\n  messageData?: MessageData | null;\n  isAutoAttack?: boolean;\n}\n\nclass CombatSystem {\n  settings: GameSettings;\n  autoAttackTimer: ReturnType<typeof setInterval> | null;\n  gameEngine: GameEngine | null;\n\n  constructor(settings: GameSettings) {\n    this.settings = settings;\n    this.autoAttackTimer = null;\n    this.gameEngine = null;\n  }\n\n  setGameEngine(gameEngine: GameEngine): void {\n    this.gameEngine = gameEngine;\n  }\n\n  getAllPawns(): Entity[] {\n    if (!this.gameEngine) return [];\n\n    // Combine all pawns (players, enemies, emoji pawns) into one array\n    const allPawns: Entity[] = [\n      ...Array.from(this.gameEngine.players.values()),\n      ...Array.from(this.gameEngine.aiEnemies.values()),\n      ...Array.from(this.gameEngine.emojiPawns.values())\n    ];\n\n    return allPawns;\n  }\n\n  executeAttack(\n    attacker: Entity,\n    target: Entity,\n    messageData: MessageData | null = null\n  ): AttackResult {\n    // Let the attacker calculate their own damage\n    let damage = this.settings.baseDamage;\n    let isPowerAttack = false;\n\n    if (\n      'calculateAttackDamage' in attacker &&\n      typeof attacker.calculateAttackDamage === 'function'\n    ) {\n      const attackerCharacter = attacker as Character;\n      const powerChargeBefore = attackerCharacter.powerCharge;\n      damage = attackerCharacter.calculateAttackDamage(this.settings.baseDamage, true); // Use power if available\n\n      // Check if power attack was used (power charges were consumed)\n      isPowerAttack = attackerCharacter.powerCharge < powerChargeBefore;\n    }\n\n    // Handle EmojiPawn onHit behavior BEFORE damage is applied\n    if ('handleHit' in target && typeof target.handleHit === 'function') {\n      const emojiPawn = target as EmojiPawn;\n      emojiPawn.handleHit(attacker as Character);\n\n      // Update UI if attacker is a Character (power charge might have changed)\n      if (this.gameEngine && 'powerCharge' in attacker) {\n        this.gameEngine.renderSystem.updatePlayerTitle(attacker as Character);\n      }\n    }\n\n    // Let the target take damage (they handle defense reduction themselves)\n    const wasKilled = target.takeDamage(damage, attacker);\n\n    // Add score to attacker (if Character)\n    if ('addScore' in attacker && typeof attacker.addScore === 'function') {\n      (attacker as Character).addScore(Math.floor(damage));\n    }\n\n    // Add visual effects (only for Characters)\n    if ('addEffect' in attacker && typeof attacker.addEffect === 'function') {\n      (attacker as Character).addEffect('attacking');\n    }\n    if ('addEffect' in target && typeof target.addEffect === 'function') {\n      (target as Character).addEffect('damaged');\n    }\n\n    // Trigger visual effects with power info\n    // Only trigger effects if both attacker and target have DOM elements\n    if (window.effectsManager) {\n      // Check if attacker and target are Characters (not EmojiPawns) and have elements\n      const attackerCharacter = attacker as Character;\n      const targetCharacter = target as Character;\n\n      if (attackerCharacter?.element && targetCharacter?.element) {\n        window.effectsManager.triggerAttackEffect(\n          attackerCharacter,\n          targetCharacter,\n          isPowerAttack\n        );\n      }\n    }\n\n    const result = {\n      damage: Math.floor(damage),\n      wasKilled,\n      attacker: attacker.displayName,\n      target: target.displayName,\n      messageData\n    };\n\n    // Handle kill (target.onDeath was already called, so we just handle cleanup/events)\n    if (wasKilled) {\n      this.handleKill(attacker, target, () => this.getAllPawns());\n\n      // Trigger elimination event for game engine\n      if (this.gameEngine?.eventSystem && 'addKill' in attacker) {\n        this.gameEngine.eventSystem.emit('elimination', {\n          victim: target as Character,\n          killer: attacker as Character\n        });\n      }\n    }\n\n    // Counter-attack if defender was defending (only for Characters)\n    if (\n      'isDefenseActive' in target &&\n      target.isDefenseActive() &&\n      'isAI' in attacker &&\n      attacker.isAI\n    ) {\n      this.executeCounterAttack(target as Character, attacker as Character);\n    }\n\n    // Update UI for attacker after power charges were consumed (ensure it happens after all calculations)\n    if (this.gameEngine && 'powerCharge' in attacker && 'calculateAttackDamage' in attacker) {\n      const attackerCharacter = attacker as Character;\n\n      this.gameEngine.renderSystem.updatePlayerTitle(attackerCharacter);\n\n      // Debug log to verify power charge consumption\n      if (isPowerAttack) {\n        console.log(\n          `[CombatSystem] Power attack used, Power Charges remaining: ${attackerCharacter.powerCharge}`\n        );\n      }\n    }\n\n    return result;\n  }\n\n  executeAutoAttack(attacker: Entity, target: Entity): AttackResult {\n    // Let the attacker calculate their own auto-attack damage\n    let damage = this.settings.baseDamage;\n    let isPowerAttack = false;\n\n    if (\n      'calculateAutoAttackDamage' in attacker &&\n      typeof attacker.calculateAutoAttackDamage === 'function'\n    ) {\n      const attackerCharacter = attacker as Character;\n      isPowerAttack = attackerCharacter.powerCharge > 0;\n      damage = attackerCharacter.calculateAutoAttackDamage(this.settings.baseDamage);\n    }\n\n    // Handle EmojiPawn onHit behavior BEFORE damage is applied\n    if ('handleHit' in target && typeof target.handleHit === 'function') {\n      const emojiPawn = target as EmojiPawn;\n      emojiPawn.handleHit(attacker as Character);\n\n      // Update UI if attacker is a Character (power charge might have changed)\n      if (this.gameEngine && 'powerCharge' in attacker) {\n        this.gameEngine.renderSystem.updatePlayerTitle(attacker as Character);\n      }\n    }\n\n    // Let the target take damage (they handle defense reduction themselves)\n    const wasKilled = target.takeDamage(damage, attacker);\n\n    // Add score to attacker (less for auto-attacks)\n    if ('addScore' in attacker && typeof attacker.addScore === 'function') {\n      (attacker as Character).addScore(Math.floor(damage * 0.5));\n    }\n\n    // Add visual effects (only for Characters)\n    if ('addEffect' in attacker && typeof attacker.addEffect === 'function') {\n      (attacker as Character).addEffect('attacking');\n    }\n    if ('addEffect' in target && typeof target.addEffect === 'function') {\n      (target as Character).addEffect('damaged');\n    }\n\n    // Trigger visual effects with power info\n    // Only trigger effects if both attacker and target have DOM elements\n    if (window.effectsManager) {\n      // Check if attacker and target are Characters (not EmojiPawns) and have elements\n      const attackerCharacter = attacker as Character;\n      const targetCharacter = target as Character;\n\n      if (attackerCharacter?.element && targetCharacter?.element) {\n        window.effectsManager.triggerAttackEffect(\n          attackerCharacter,\n          targetCharacter,\n          isPowerAttack\n        );\n      }\n    }\n\n    const result = {\n      damage: Math.floor(damage),\n      wasKilled,\n      attacker: attacker.displayName,\n      target: target.displayName,\n      isAutoAttack: true\n    };\n\n    // Handle kill (target.onDeath was already called)\n    if (wasKilled) {\n      this.handleKill(attacker, target, () => this.getAllPawns());\n\n      // Only emit elimination for Characters (not EmojiPawns)\n      if (!('emoji' in target && 'handleHit' in target)) {\n        if (this.gameEngine?.eventSystem && 'addKill' in attacker) {\n          this.gameEngine.eventSystem.emit('elimination', {\n            victim: target as Character,\n            killer: attacker as Character\n          });\n        }\n      } else {\n        // EmojiPawns handle their own removal via onDeath() method\n        // No need to remove them here - the pawn itself decides when to remove\n      }\n    }\n\n    // Counter-attack if defender was defending\n    if (\n      'isDefenseActive' in target &&\n      target.isDefenseActive() &&\n      'isAI' in attacker &&\n      attacker.isAI\n    ) {\n      this.executeCounterAttack(target as Character, attacker as Character);\n    }\n\n    return result;\n  }\n\n  // Damage calculation methods removed - now handled by Character.calculateAttackDamage() and Character.calculateAutoAttackDamage()\n\n  handleKill(attacker: Entity, target: Entity, getAllPawns?: () => Entity[]): void {\n    // target.kill() was already called in onDeath()\n    // We just handle special effects here (like aggressive player shockwave)\n\n    // Only addKill for Characters (not EmojiPawns)\n    if ('addKill' in attacker && typeof attacker.addKill === 'function') {\n      (attacker as Character).addKill();\n    }\n\n    // Handle aggressive player death shockwave (only for Characters)\n    if (!('emoji' in target && 'handleHit' in target) && !('isAI' in target && target.isAI)) {\n      const targetCharacter = target as Character;\n      const isAggressivePlayer = targetCharacter.isAggressiveClass();\n\n      if (isAggressivePlayer && window.effectsManager && target.element && getAllPawns) {\n        const rect = target.element.getBoundingClientRect();\n        const battlefield = document.getElementById('battlefield');\n        const battlefieldRect = battlefield?.getBoundingClientRect();\n        if (!battlefieldRect) return;\n\n        const explosionPosition = {\n          x: rect.left - battlefieldRect.left + rect.width / 2,\n          y: rect.top - battlefieldRect.top + rect.height / 2\n        };\n\n        // If aggressive player dies, trigger shockwave instead of normal explosion\n        if (isAggressivePlayer) {\n          // Track which pawns have been hit to avoid multiple hits\n          const hitPawns = new Set<string>();\n\n          window.effectsManager.triggerShockwaveEffect(explosionPosition, (radius, hitPosition) => {\n            // Check all pawns for hits at current radius\n            const allPawns = getAllPawns();\n            const shockwaveDamage = this.settings.baseDamage * 0.5; // 50% of base damage\n\n            allPawns.forEach(pawn => {\n              // Skip if already hit, dead, or is the dead player\n              if (\n                hitPawns.has(pawn.id) ||\n                pawn.isDead ||\n                pawn.id === target.id ||\n                pawn.health <= 0\n              ) {\n                return;\n              }\n\n              // Calculate distance from explosion center\n              const distance = Math.sqrt(\n                Math.pow(pawn.position.x - hitPosition.x, 2) +\n                  Math.pow(pawn.position.y - hitPosition.y, 2)\n              );\n\n              // Hit if pawn is within current radius (with small margin for edge detection)\n              if (distance <= radius + 5) {\n                // Only hit once when wave reaches this pawn\n                if (!hitPawns.has(pawn.id)) {\n                  hitPawns.add(pawn.id);\n\n                  // Calculate damage based on distance - more damage closer to center\n                  // Minimum damage is 20% of shockwave damage at the edge\n                  const distanceRatio = Math.min(1, distance / radius);\n                  const damage = Math.floor(shockwaveDamage * (1 - distanceRatio * 0.8));\n\n                  if (damage > 0) {\n                    // Handle EmojiPawn onHit behavior BEFORE damage\n                    if ('handleHit' in pawn && typeof pawn.handleHit === 'function') {\n                      const emojiPawn = pawn as EmojiPawn;\n                      emojiPawn.handleHit(targetCharacter);\n                    }\n\n                    // Let pawn take damage (they handle defense themselves)\n                    const wasKilled = pawn.takeDamage(damage, targetCharacter);\n\n                    // Visual feedback - shockwave hit effect\n                    if (window.effectsManager && pawn.element) {\n                      window.effectsManager.createShockwaveHitEffect(pawn.element);\n                    }\n\n                    // Only addEffect for Characters\n                    if ('addEffect' in pawn && typeof pawn.addEffect === 'function') {\n                      (pawn as Character).addEffect('damaged', 500);\n                    }\n\n                    if (wasKilled) {\n                      this.handleKill(targetCharacter, pawn, getAllPawns);\n                    }\n                  }\n                }\n              }\n            });\n          });\n        } else {\n          // Normal explosion for non-aggressive players\n          window.effectsManager.triggerExplosionEffect(explosionPosition);\n        }\n      }\n    }\n\n    // Screen shake effect\n    this.addScreenShake();\n  }\n\n  executeCounterAttack(defender: Character, attacker: Character): void {\n    // Counter-attack from defender to attacker\n    // Let defender calculate their damage\n    let counterDamage = this.settings.baseDamage * 0.5; // Base 50% of base damage\n    if (\n      'calculateAttackDamage' in defender &&\n      typeof defender.calculateAttackDamage === 'function'\n    ) {\n      counterDamage = defender.calculateAttackDamage(counterDamage, false); // Don't use power for counter\n    }\n\n    // Let attacker take damage (they handle defense themselves)\n    const wasKilled = attacker.takeDamage(counterDamage, defender);\n\n    // Give score to defender\n    defender.addScore(Math.floor(counterDamage));\n\n    // Trigger counter-attack effect with delay\n    setTimeout(() => {\n      if (window.effectsManager) {\n        window.effectsManager.triggerAttackEffect(defender, attacker, false, true);\n      }\n    }, 300);\n\n    // Handle kill (attacker.onDeath was already called)\n    if (wasKilled) {\n      setTimeout(() => {\n        this.handleKill(defender, attacker, () => this.getAllPawns());\n      }, 300);\n    }\n  }\n\n  processAutoAttacks(): AttackResult[] {\n    if (!this.gameEngine) return [];\n\n    const now = Date.now();\n    // Get all pawns from gameEngine and filter alive ones\n    const allPawns = this.getAllPawns().filter(pawn => !pawn.isDead && pawn.health > 0);\n\n    if (allPawns.length < 2) return [];\n\n    const attackResults: AttackResult[] = [];\n\n    allPawns.forEach(pawn => {\n      // Tag-based check: Only entities that can auto-attack (Characters)\n      if (!this.canAutoAttack(pawn, now)) return;\n\n      // Tag-based target selection\n      const target = this.selectTargetByTags(pawn, allPawns);\n\n      if (target) {\n        // Add delay for better experience\n        const attackDelay = Math.random() * 500;\n        setTimeout(() => {\n          const result = this.executeAutoAttack(pawn, target!);\n          attackResults.push(result);\n        }, attackDelay);\n      }\n\n      // Tag-based attack time update\n      this.updateNextAttackTime(pawn, now);\n    });\n\n    return attackResults;\n  }\n\n  /**\n   * Tag-based check if entity can perform auto-attack\n   */\n  private canAutoAttack(entity: Entity, now: number): boolean {\n    // Only Characters (Player/Enemy) can auto-attack, not EmojiPawns\n    if (!entity.hasAnyTag(PawnTag.Player, PawnTag.Enemy)) return false;\n\n    // Check if it's time to attack\n    if ('nextAutoAttack' in entity) {\n      const charEntity = entity as Character;\n      return now >= charEntity.nextAutoAttack;\n    }\n\n    return false;\n  }\n\n  /**\n   * Tag-based target selection system\n   * Defines attack priorities based on attacker and target tags\n   */\n  private selectTargetByTags(attacker: Entity, allEntities: Entity[]): Entity | null {\n    // Define valid targets based on attacker tags\n    const validTargetTags = this.getValidTargetTags(attacker);\n    if (validTargetTags.length === 0) return null;\n\n    // Filter valid targets (alive, not self, has valid tag)\n    const possibleTargets = allEntities.filter(\n      target =>\n        target.id !== attacker.id &&\n        !target.isDead &&\n        target.health > 0 &&\n        target.hasAnyTag(...validTargetTags)\n    );\n\n    if (possibleTargets.length === 0) return null;\n\n    // Get priority order for this attacker\n    const priorityOrder = this.getTargetPriorityOrder(attacker);\n\n    // Select target based on priority order\n    for (const tag of priorityOrder) {\n      const targetsWithTag = possibleTargets.filter(t => t.hasTag(tag));\n      if (targetsWithTag.length > 0) {\n        // Apply aggressiveness check for Characters\n        if (this.shouldAttack(attacker)) {\n          return targetsWithTag[Math.floor(Math.random() * targetsWithTag.length)];\n        }\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Get valid target tags based on attacker tags\n   * Tag-based rules:\n   * - Players can attack: Emoji, Enemy, Player (PvP)\n   * - Enemies can attack: Player only\n   * - EmojiPawns cannot attack (return empty)\n   */\n  private getValidTargetTags(attacker: Entity): PawnTag[] {\n    if (attacker.hasTag(PawnTag.Player)) {\n      return [PawnTag.Emoji, PawnTag.Enemy, PawnTag.Player];\n    }\n    if (attacker.hasTag(PawnTag.Enemy)) {\n      return [PawnTag.Player];\n    }\n    // EmojiPawns and Neutral pawns don't attack\n    return [];\n  }\n\n  /**\n   * Get priority order for target selection based on attacker tags\n   */\n  private getTargetPriorityOrder(attacker: Entity): PawnTag[] {\n    if (attacker.hasTag(PawnTag.Player)) {\n      // Players prioritize: Emoji > Enemy > Player\n      return [PawnTag.Emoji, PawnTag.Enemy, PawnTag.Player];\n    }\n    if (attacker.hasTag(PawnTag.Enemy)) {\n      // Enemies only target Players\n      return [PawnTag.Player];\n    }\n    return [];\n  }\n\n  /**\n   * Tag-based check if entity should attack (aggressiveness)\n   */\n  private shouldAttack(attacker: Entity): boolean {\n    // Only Characters have aggressiveness\n    if (!attacker.hasAnyTag(PawnTag.Player, PawnTag.Enemy)) return false;\n\n    const charEntity = attacker as Character;\n\n    // Use personality for aggressiveness if available\n    if ('personality' in charEntity) {\n      const aggressiveness = attacker.hasTag(PawnTag.Enemy)\n        ? 0.4 // AI enemies are less aggressive\n        : 0.6 + charEntity.personality * 0.2; // Players vary by personality\n      return Math.random() <= aggressiveness;\n    }\n\n    return false;\n  }\n\n  /**\n   * Tag-based update of next attack time\n   */\n  private updateNextAttackTime(entity: Entity, now: number): void {\n    if (!entity.hasAnyTag(PawnTag.Player, PawnTag.Enemy)) return;\n    if (!('nextAutoAttack' in entity)) return;\n\n    const charEntity = entity as Character;\n\n    // Enemy-specific update\n    if (\n      entity.hasTag(PawnTag.Enemy) &&\n      'updateNextAttackTime' in entity &&\n      typeof (entity as AIEnemy).updateNextAttackTime === 'function'\n    ) {\n      (entity as AIEnemy).updateNextAttackTime();\n      return;\n    }\n\n    // Player/Character update\n    if (\n      'autoAttackInterval' in charEntity &&\n      'activityCount' in charEntity &&\n      'personality' in charEntity\n    ) {\n      const baseInterval = charEntity.autoAttackInterval || 2000;\n      const activityBonus = Math.max(0.3, 1 - charEntity.activityCount * 0.01);\n      const personalityBonus = charEntity.personality > 0.7 ? 0.5 : 0.7;\n\n      charEntity.nextAutoAttack = now + baseInterval * activityBonus * personalityBonus;\n    }\n  }\n\n  addScreenShake(): void {\n    const gameContainer = document.querySelector('.game-container');\n    if (gameContainer) {\n      gameContainer.classList.add('screen-shake');\n      setTimeout(() => {\n        gameContainer.classList.remove('screen-shake');\n      }, 500);\n    }\n  }\n\n  startAutoAttackSystem(callback?: (results: AttackResult[]) => void): void {\n    this.stopAutoAttackSystem();\n\n    this.autoAttackTimer = setInterval(() => {\n      const results = this.processAutoAttacks();\n      if (callback && results.length > 0) {\n        callback(results);\n      }\n    }, 1000);\n  }\n\n  stopAutoAttackSystem(): void {\n    if (this.autoAttackTimer) {\n      clearInterval(this.autoAttackTimer);\n      this.autoAttackTimer = null;\n    }\n  }\n}\n\nexport { CombatSystem };\n","import type { GameSettings } from '../GameEngine.js';\nimport type { EventSystem } from '../events/EventSystem.js';\nimport type { GameEngine } from '../GameEngine.js';\n\ninterface WaveInfo {\n  waveNumber: number;\n  difficultyIncrease: {\n    baseDamage: number;\n    baseHealth: number;\n  };\n}\n\nclass WaveSystem {\n  settings: GameSettings;\n  currentWave: number;\n  nextWaveTime: number | null;\n  waveTimer: ReturnType<typeof setInterval> | null;\n  waveTimerDisplay: ReturnType<typeof setInterval> | null;\n  isActive: boolean;\n  eventSystem: EventSystem | null;\n  gameEngine: GameEngine | null;\n\n  constructor(settings: GameSettings) {\n    this.settings = settings;\n    this.currentWave = 1;\n    this.nextWaveTime = null;\n    this.waveTimer = null;\n    this.waveTimerDisplay = null;\n    this.isActive = false;\n    this.eventSystem = null;\n    this.gameEngine = null;\n  }\n\n  setEventSystem(eventSystem: EventSystem): void {\n    this.eventSystem = eventSystem;\n  }\n\n  setGameEngine(gameEngine: GameEngine): void {\n    this.gameEngine = gameEngine;\n  }\n\n  start(): void {\n    this.isActive = true;\n    this.currentWave = 0; // Start at 0 so the first nextWave() call makes it 1\n\n    // Initially wait for at least one player before starting timer\n    this.nextWaveTime = null;\n    this.updateWaveDisplay();\n    this.updateWaveTimer();\n\n    // Start checking for players and wave timer\n    this.waveTimer = setInterval(() => {\n      this.checkWaveStartCondition();\n      this.checkAndProcessWave();\n    }, 100); // Check every 100ms\n\n    // Start wave timer display update\n    this.waveTimerDisplay = setInterval(() => {\n      this.updateWaveTimer();\n    }, 1000);\n  }\n\n  checkWaveStartCondition(): void {\n    // Only check if we're still in wave 0 and haven't set a timer yet\n    if (this.currentWave !== 0 || this.nextWaveTime !== null) return;\n\n    // Check if at least one player exists\n    if (this.gameEngine?.players?.size > 0) {\n      // At least one player exists, start 5 second countdown to wave 1\n      console.log('[WaveSystem] Player detected, starting 5 second countdown to wave 1');\n      this.nextWaveTime = Date.now() + 5000; // 5 second timer\n      this.updateWaveTimer();\n    }\n  }\n\n  stop(): void {\n    this.isActive = false;\n\n    if (this.waveTimer) {\n      clearInterval(this.waveTimer);\n      this.waveTimer = null;\n    }\n\n    if (this.waveTimerDisplay) {\n      clearInterval(this.waveTimerDisplay);\n      this.waveTimerDisplay = null;\n    }\n  }\n\n  checkAndProcessWave(): void {\n    if (!this.isActive || !this.nextWaveTime) return;\n\n    // Check if it's time for the next wave\n    if (Date.now() >= this.nextWaveTime) {\n      this.nextWave();\n    } else {\n      // Recalculate wave timer if conditions changed (e.g., player joined, enemies killed)\n      this.recalculateWaveTimerIfNeeded();\n    }\n  }\n\n  recalculateWaveTimerIfNeeded(): void {\n    if (!this.nextWaveTime || this.currentWave === 0) return;\n\n    // Count alive players (not dead, health > 0)\n    const alivePlayers = Array.from(this.gameEngine?.players?.values() || []).filter(\n      player => !player.isDead && player.health > 0\n    );\n\n    // Count alive enemies\n    const aliveEnemies = Array.from(this.gameEngine?.aiEnemies?.values() || []).filter(\n      enemy => !enemy.isDead && enemy.health > 0\n    );\n\n    // Check if we should be using 5s instead of 60s interval\n    const shouldUse5sInterval = alivePlayers.length === 1 && aliveEnemies.length === 0;\n\n    const currentlyUsing5sInterval = this.nextWaveTime - Date.now() <= 5500;\n\n    // If we should use 5s but currently have 60s remaining, adjust\n    if (shouldUse5sInterval && !currentlyUsing5sInterval) {\n      const now = Date.now();\n      const timeRemaining = this.nextWaveTime - now;\n\n      // Only adjust if significantly off (more than 10 seconds remaining)\n      if (timeRemaining > 10000) {\n        const elapsed = this.settings.waveInterval - timeRemaining;\n        this.nextWaveTime = now + Math.max(5000 - elapsed, 1000); // At least 1 second remaining\n        console.log(\n          `[WaveSystem] Adjusted wave timer from ${Math.ceil(timeRemaining / 1000)}s to ${Math.ceil((this.nextWaveTime - now) / 1000)}s`\n        );\n        this.updateWaveTimer();\n      }\n    }\n  }\n\n  processWave(): void {\n    if (!this.isActive) return;\n\n    this.nextWave();\n  }\n\n  nextWave(): WaveInfo {\n    this.currentWave++;\n\n    // Emit wave start event BEFORE calculating interval so enemies are spawned first\n    const waveInfo = {\n      waveNumber: this.currentWave,\n      difficultyIncrease: {\n        baseDamage: 2,\n        baseHealth: 10\n      }\n    };\n\n    // Emit wave start event\n    if (this.eventSystem) {\n      this.eventSystem.emit('waveStart', waveInfo);\n    }\n\n    // Determine wave interval AFTER wave starts (so enemies are spawned and we can check them)\n    let waveInterval = this.settings.waveInterval;\n\n    // Only use 5s interval if only 1 player exists AND no enemies alive\n    if (this.gameEngine && this.gameEngine.players && this.gameEngine.players.size === 1) {\n      // Check if any enemies are alive\n      const hasAliveEnemies =\n        this.gameEngine.aiEnemies &&\n        Array.from(this.gameEngine.aiEnemies.values()).some(\n          enemy => !enemy.isDead && enemy.health > 0\n        );\n\n      // Only use 5s interval if no enemies alive\n      if (!hasAliveEnemies) {\n        waveInterval = 5000; // 5 seconds for single player when no enemies\n      }\n    }\n\n    this.nextWaveTime = Date.now() + waveInterval;\n    this.updateWaveDisplay();\n    this.updateWaveTimer();\n\n    // Increase difficulty\n    this.settings.baseDamage += 2;\n    this.settings.baseHealth += 10;\n\n    return waveInfo;\n  }\n\n  updateWaveDisplay(): void {\n    const waveElement = document.getElementById('waveNumber');\n    if (waveElement) {\n      waveElement.textContent = this.currentWave.toString();\n    }\n  }\n\n  updateWaveTimer(): void {\n    const timerElement = document.getElementById('waveTimer');\n    if (!timerElement) return;\n\n    if (!this.isActive) {\n      timerElement.textContent = '--';\n      return;\n    }\n\n    // Show waiting message if in wave 0 and no timer set yet\n    if (this.currentWave === 0 && !this.nextWaveTime) {\n      timerElement.textContent = 'Warte auf Spieler...';\n      timerElement.style.color = '#ffc107';\n      timerElement.style.textShadow = '0 0 10px rgba(255, 193, 7, 0.5)';\n      return;\n    }\n\n    if (!this.nextWaveTime) {\n      timerElement.textContent = '--';\n      return;\n    }\n\n    const now = Date.now();\n    const timeRemaining = Math.max(0, this.nextWaveTime - now);\n    const secondsRemaining = Math.ceil(timeRemaining / 1000);\n\n    this.updateTimerDisplay(timerElement, secondsRemaining);\n  }\n\n  updateTimerDisplay(timerElement: HTMLElement, secondsRemaining: number): void {\n    if (secondsRemaining <= 0) {\n      timerElement.textContent = '0s';\n    } else if (secondsRemaining <= 10) {\n      // Red warning for last 10 seconds\n      timerElement.style.color = '#ff4444';\n      timerElement.style.textShadow = '0 0 10px rgba(255, 68, 68, 0.8)';\n      timerElement.textContent = `${secondsRemaining}s`;\n    } else if (secondsRemaining <= 30) {\n      // Orange warning for last 30 seconds\n      timerElement.style.color = '#ff8800';\n      timerElement.style.textShadow = '0 0 10px rgba(255, 136, 0, 0.8)';\n      timerElement.textContent = `${secondsRemaining}s`;\n    } else {\n      // Normal yellow color\n      timerElement.style.color = '#ffc107';\n      timerElement.style.textShadow = '0 0 10px rgba(255, 193, 7, 0.5)';\n      timerElement.textContent = `${secondsRemaining}s`;\n    }\n  }\n\n  getCurrentWave(): number {\n    return this.currentWave;\n  }\n\n  getTimeToNextWave(): number {\n    if (!this.nextWaveTime) return 0;\n    return Math.max(0, this.nextWaveTime - Date.now());\n  }\n\n  setNextWaveTime(newTime: number): void {\n    this.nextWaveTime = newTime;\n    this.updateWaveTimer();\n  }\n\n  isWaveActive(): boolean {\n    return this.isActive;\n  }\n\n  forceNextWave(): WaveInfo | null {\n    if (!this.isActive) return null;\n\n    // Force immediate wave and recalculate interval based on player count\n    return this.nextWave();\n  }\n\n  getWaveInfo(): {\n    currentWave: number;\n    nextWaveTime: number | null;\n    timeToNextWave: number;\n    isActive: boolean;\n  } {\n    return {\n      currentWave: this.currentWave,\n      nextWaveTime: this.nextWaveTime,\n      timeToNextWave: this.getTimeToNextWave(),\n      isActive: this.isActive\n    };\n  }\n}\n\nexport { WaveSystem };\n","import type { Character } from '../entities/Character.js';\n\nclass UISystem {\n  actionFeed: HTMLElement | null;\n  leaderboard: HTMLElement | null;\n  activeViewers: HTMLElement | null;\n  gameOverBanner: HTMLElement | null;\n\n  constructor() {\n    this.actionFeed = document.getElementById('actionFeed');\n    this.leaderboard = document.getElementById('leaderboard');\n    this.activeViewers = document.getElementById('activeViewers');\n    this.gameOverBanner = null;\n  }\n\n  updateActiveViewers(playerCount: number, aiCount: number): void {\n    if (this.activeViewers) {\n      this.activeViewers.textContent = `${playerCount} (${aiCount} KI)`;\n    }\n  }\n\n  updateLeaderboard(players: Map<string, Character>): void {\n    if (!this.leaderboard) return;\n\n    const sortedPlayers = Array.from(players.values())\n      .sort((a, b) => b.score - a.score)\n      .slice(0, 5);\n\n    this.leaderboard.innerHTML = '';\n\n    sortedPlayers.forEach((player, index) => {\n      const item = document.createElement('div');\n      item.className = 'leaderboard-item';\n\n      const rank = document.createElement('span');\n      rank.className = 'player-rank';\n      rank.textContent = `#${index + 1}`;\n\n      const name = document.createElement('span');\n      name.className = 'player-name';\n      name.textContent = player.displayName;\n      name.style.color = player.color;\n\n      const score = document.createElement('span');\n      score.className = 'player-score';\n      score.textContent = player.score.toString();\n\n      item.appendChild(rank);\n      item.appendChild(name);\n      item.appendChild(score);\n\n      this.leaderboard.appendChild(item);\n    });\n  }\n\n  addActionToFeed(message: string, type: string): void {\n    if (!this.actionFeed) return;\n\n    const actionItem = document.createElement('div');\n    actionItem.className = `action-item ${type}`;\n    actionItem.textContent = message;\n    actionItem.style.opacity = '0';\n\n    this.actionFeed.insertBefore(actionItem, this.actionFeed.firstChild);\n\n    // Animate in\n    setTimeout(() => {\n      actionItem.style.opacity = '1';\n    }, 10);\n\n    // Remove old messages\n    const items = this.actionFeed.querySelectorAll('.action-item');\n    if (items.length > 50) {\n      items[items.length - 1].remove();\n    }\n  }\n\n  showGameOverBanner(topPlayers: Character[]): void {\n    this.removeGameOverBanner();\n\n    let topPlayersHTML = '';\n    if (topPlayers.length > 0) {\n      topPlayersHTML = `\n                <div class=\"game-over-leaderboard\">\n                    <h3 class=\"leaderboard-title\">üèÜ TOP SPIELER</h3>\n                    <div class=\"top-players\">\n                        ${topPlayers\n                          .map(\n                            (player, index) => `\n                            <div class=\"top-player rank-${index + 1}\">\n                                <span class=\"player-rank\">${index === 0 ? 'ü•á' : index === 1 ? 'ü•à' : 'ü•â'}</span>\n                                <span class=\"player-name\" style=\"color: ${player.color};\">${player.displayName}</span>\n                                <span class=\"player-score\">${player.score} Punkte</span>\n                            </div>\n                        `\n                          )\n                          .join('')}\n                    </div>\n                </div>\n            `;\n    }\n\n    const banner = document.createElement('div');\n    banner.id = 'gameOverBanner';\n    banner.className = 'game-over-banner';\n    banner.innerHTML = `\n            <div class=\"game-over-content\">\n                <h1 class=\"game-over-title\">GAME OVER</h1>\n                <p class=\"game-over-subtitle\">Alle Spieler wurden besiegt!</p>\n                ${topPlayersHTML}\n                <div class=\"game-over-timer\">\n                    <span class=\"timer-text\">Neues Spiel in:</span>\n                    <span class=\"timer-count\" id=\"gameOverTimer\">10</span>\n                </div>\n            </div>\n        `;\n\n    document.body.appendChild(banner);\n    this.gameOverBanner = banner;\n\n    // Start countdown\n    this.startGameOverCountdown();\n  }\n\n  startGameOverCountdown(): void {\n    let countdown = 10;\n    const timerElement = document.getElementById('gameOverTimer');\n\n    const countdownInterval = setInterval(() => {\n      countdown--;\n      if (timerElement) {\n        timerElement.textContent = countdown.toString();\n      }\n      if (countdown <= 0) {\n        clearInterval(countdownInterval);\n      }\n    }, 1000);\n  }\n\n  removeGameOverBanner(): void {\n    if (this.gameOverBanner) {\n      this.gameOverBanner.remove();\n      this.gameOverBanner = null;\n    }\n\n    // Also remove by ID in case there are multiple\n    const banner = document.getElementById('gameOverBanner');\n    if (banner) {\n      banner.remove();\n    }\n  }\n\n  addScreenShake(): void {\n    const gameContainer = document.querySelector('.game-container');\n    if (gameContainer) {\n      gameContainer.classList.add('screen-shake');\n      setTimeout(() => {\n        gameContainer.classList.remove('screen-shake');\n      }, 500);\n    }\n  }\n\n  addBananaShake(): void {\n    const gameContainer = document.querySelector('.game-container');\n    if (gameContainer) {\n      gameContainer.classList.add('banana-shake');\n      setTimeout(() => {\n        gameContainer.classList.remove('banana-shake');\n      }, 1500);\n    }\n  }\n\n  createBananaRain(): void {\n    const battlefield = document.getElementById('battlefield');\n    if (!battlefield) return;\n\n    const battlefieldRect = battlefield.getBoundingClientRect();\n    const bananaCount = 15 + Math.floor(Math.random() * 6);\n\n    for (let i = 0; i < bananaCount; i++) {\n      setTimeout(() => {\n        const banana = document.createElement('div');\n        banana.className = 'falling-banana';\n        banana.textContent = 'üçå';\n        banana.style.cssText = `\n                    position: absolute;\n                    font-size: ${20 + Math.random() * 15}px;\n                    left: ${Math.random() * battlefieldRect.width}px;\n                    top: -50px;\n                    pointer-events: none;\n                    z-index: 1000;\n                    animation: bananaFall ${2 + Math.random() * 2}s linear forwards;\n                    transform: rotate(${Math.random() * 360}deg);\n                `;\n\n        battlefield.appendChild(banana);\n\n        setTimeout(() => {\n          if (banana.parentNode) {\n            banana.parentNode.removeChild(banana);\n          }\n        }, 4000);\n      }, i * 100);\n    }\n  }\n\n  showNotification(\n    message: string,\n    type: 'info' | 'error' | 'warning' = 'info',\n    duration = 3000\n  ): void {\n    const notification = document.createElement('div');\n    notification.className = `notification ${type}`;\n    notification.textContent = message;\n    notification.style.cssText = `\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: rgba(0, 0, 0, 0.9);\n            color: white;\n            padding: 12px 20px;\n            border-radius: 8px;\n            z-index: 10000;\n            font-family: 'Orbitron', monospace;\n            font-weight: bold;\n            border-left: 4px solid ${type === 'error' ? '#ff4444' : type === 'warning' ? '#ffaa00' : '#00ff00'};\n            animation: slideInRight 0.3s ease-out;\n        `;\n\n    document.body.appendChild(notification);\n\n    setTimeout(() => {\n      notification.style.animation = 'slideOutRight 0.3s ease-in';\n      setTimeout(() => {\n        if (notification.parentNode) {\n          notification.parentNode.removeChild(notification);\n        }\n      }, 300);\n    }, duration);\n  }\n\n  updateConnectionStatus(isConnected: boolean): void {\n    const statusElement = document.getElementById('connectionStatus');\n    if (statusElement) {\n      const dot = statusElement.querySelector<HTMLElement>('.status-dot');\n      const text = statusElement.querySelector<HTMLElement>('span:last-child');\n\n      if (dot && text) {\n        if (isConnected) {\n          dot.style.backgroundColor = '#00ff00';\n          text.textContent = 'Verbunden';\n          statusElement.style.color = '#00ff00';\n        } else {\n          dot.style.backgroundColor = '#ff4444';\n          text.textContent = 'Getrennt';\n          statusElement.style.color = '#ff4444';\n        }\n      }\n    }\n  }\n\n  showPlayerStats(player: Character): void {\n    const stats = player.getStats();\n    const remainingHeals = stats.remainingHeals;\n    const statsMessage = `üìä ${stats.displayName}: HP ${stats.health}/${stats.maxHealth}, Power ${stats.powerCharge}/5, Heilungen ${remainingHeals}/5, Punkte ${stats.score}, Siege ${stats.kills}`;\n\n    this.addActionToFeed(statsMessage, 'stats');\n  }\n\n  clearActionFeed(): void {\n    if (this.actionFeed) {\n      this.actionFeed.innerHTML = '';\n    }\n  }\n\n  highlightPlayer(playerId: string): void {\n    const playerElement = document.querySelector(`[data-player-id=\"${playerId}\"]`);\n    if (playerElement) {\n      playerElement.classList.add('highlighted');\n      setTimeout(() => {\n        playerElement.classList.remove('highlighted');\n      }, 2000);\n    }\n  }\n}\n\nexport { UISystem };\n","/**\n * Base interface for all components\n */\nexport interface IComponent {\n  /**\n   * Unique identifier for this component type\n   */\n  readonly componentType: string;\n\n  /**\n   * Called when component is attached to an entity\n   */\n  onAttach?(): void;\n\n  /**\n   * Called when component is detached from an entity\n   */\n  onDetach?(): void;\n\n  /**\n   * Called each game update cycle\n   */\n  update?(deltaTime: number): void;\n}\n\n/**\n * Base class for components\n */\nexport abstract class Component implements IComponent {\n  abstract readonly componentType: string;\n\n  /**\n   * Reference to the entity this component is attached to\n   * Set by ComponentContainer when component is attached\n   */\n  protected entity: unknown | null = null;\n\n  /**\n   * Set the entity this component is attached to\n   * @internal - Called by ComponentContainer\n   */\n  _setEntity(entity: unknown): void {\n    this.entity = entity;\n  }\n\n  /**\n   * Get the entity this component is attached to\n   * Throws if entity is not set (component not attached)\n   */\n  protected getEntity<T>(): T {\n    if (!this.entity) {\n      throw new Error(`Component ${this.componentType} is not attached to an entity`);\n    }\n    return this.entity as T;\n  }\n\n  onAttach?(): void;\n  onDetach?(): void;\n  update?(deltaTime: number): void;\n}\n","import { Component } from './Component.js';\nimport type { IComponent } from './Component.js';\n\n/**\n * Mixin interface for entities that can have components\n */\nexport interface IComponentContainer {\n  /**\n   * Add a component to this entity\n   */\n  addComponent(component: IComponent): void;\n\n  /**\n   * Remove a component from this entity\n   */\n  removeComponent(componentType: string): boolean;\n\n  /**\n   * Get a component by type\n   */\n  getComponent<T extends IComponent>(componentType: string): T | undefined;\n\n  /**\n   * Check if entity has a specific component\n   */\n  hasComponent(componentType: string): boolean;\n\n  /**\n   * Update all components (called during game loop)\n   */\n  updateComponents(deltaTime: number): void;\n}\n\n/**\n * Base class mixin for entities that support components\n */\nexport class ComponentContainer implements IComponentContainer {\n  private components: Map<string, IComponent> = new Map();\n  private entity: unknown = null; // Reference to the actual entity (Character, etc.)\n\n  /**\n   * Set the actual entity this container belongs to\n   * This is needed because ComponentContainer is used as a delegate, not the entity itself\n   */\n  setEntity(entity: unknown): void {\n    this.entity = entity;\n  }\n\n  addComponent(component: IComponent): void {\n    // Don't allow duplicate components\n    if (this.components.has(component.componentType)) {\n      throw new Error(`Component ${component.componentType} already exists on entity`);\n    }\n\n    // Set entity reference if component is a Component instance\n    // Use the actual entity, not the ComponentContainer itself\n    if (component instanceof Component) {\n      const entityToSet = this.entity || this;\n      component._setEntity(entityToSet);\n    }\n\n    this.components.set(component.componentType, component);\n\n    // Call onAttach hook\n    if (component.onAttach) {\n      component.onAttach();\n    }\n  }\n\n  removeComponent(componentType: string): boolean {\n    const component = this.components.get(componentType);\n    if (!component) return false;\n\n    // Call onDetach hook\n    if (component.onDetach) {\n      component.onDetach();\n    }\n\n    // Clear entity reference if component is a Component instance\n    if (component instanceof Component) {\n      component._setEntity(null);\n    }\n\n    return this.components.delete(componentType);\n  }\n\n  getComponent<T extends IComponent>(componentType: string): T | undefined {\n    return this.components.get(componentType) as T | undefined;\n  }\n\n  hasComponent(componentType: string): boolean {\n    return this.components.has(componentType);\n  }\n\n  updateComponents(deltaTime: number): void {\n    for (const component of this.components.values()) {\n      if (component.update) {\n        component.update(deltaTime);\n      }\n    }\n  }\n\n  /**\n   * Get all components\n   * @internal - for debugging/testing\n   */\n  getAllComponents(): IComponent[] {\n    return Array.from(this.components.values());\n  }\n}\n","import { Pawn, type Position } from './Pawn.js';\nimport type { GameSettings } from '../GameEngine.js';\nimport { ComponentContainer, type IComponentContainer } from '../components/ComponentContainer.js';\nimport { PlayerLike } from '@/src/effects/types.js';\n\n// Re-export Position for convenience\nexport type { Position };\n\n/**\n * Interface for damage calculation context\n */\nexport interface DamageContext {\n  baseDamage: number;\n  attacker: Character;\n  isPowerAttack?: boolean;\n  isAutoAttack?: boolean;\n}\n\n/**\n * Character class - extends Pawn with character-specific features\n * Used for Player and AIEnemy (and potentially NPCs)\n * Implements component system for modular behavior\n */\nclass Character extends Pawn implements IComponentContainer {\n  private componentContainer: ComponentContainer;\n  score: number;\n  kills: number;\n  deaths: number;\n  powerCharge: number;\n  healsUsed: number;\n  isDefending: boolean;\n  defenseEndTime: number;\n  lastCommand: number;\n  commandCooldowns: Map<string, number>; // Command-specific cooldowns\n  lastActivity: number;\n  activityCount: number;\n  nextAutoAttack: number;\n  autoAttackInterval: number;\n  personality: number;\n  isAI: boolean;\n  playerClass: string;\n  hasBeenAnnounced: boolean;\n  effects: Set<string>;\n  defenseReduction: number;\n\n  constructor(\n    id: string,\n    displayName: string,\n    color: string,\n    maxHealth: number,\n    settings: GameSettings\n  ) {\n    super(id, displayName, color, maxHealth);\n\n    // Initialize componentContainer and set entity reference\n    this.componentContainer = new ComponentContainer();\n    if (\n      'setEntity' in this.componentContainer &&\n      typeof this.componentContainer.setEntity === 'function'\n    ) {\n      (\n        this.componentContainer as ComponentContainer & { setEntity: (entity: unknown) => void }\n      ).setEntity(this);\n    }\n\n    this.score = 0;\n    this.kills = 0;\n    this.deaths = 0;\n    this.powerCharge = 0;\n    this.healsUsed = 0;\n    this.isDefending = false;\n    this.defenseEndTime = 0;\n    this.lastCommand = Date.now();\n    this.commandCooldowns = new Map<string, number>();\n    this.lastActivity = Date.now();\n    this.activityCount = 0;\n    this.nextAutoAttack = Date.now() + Math.random() * 2000;\n    this.autoAttackInterval = 1000 + Math.random() * 2000;\n    this.personality = Math.random();\n    this.isAI = false;\n    this.playerClass = this.determinePlayerClass();\n    this.hasBeenAnnounced = false;\n    this.effects = new Set();\n    this.defenseReduction = settings.defenseReduction; // Store from settings\n    // Note: Tags are set by subclasses (Player adds 'Player', AIEnemy adds 'Enemy')\n  }\n\n  determinePlayerClass(): string {\n    // Aggressive (70%+): Warrior classes\n    if (this.personality >= 0.7) {\n      const warriorClasses = ['Krieger', 'K√§mpfer', 'Berserker'];\n      return warriorClasses[Math.floor(Math.random() * warriorClasses.length)];\n    }\n    // Defensive (< 30%): Tank classes\n    else if (this.personality < 0.3) {\n      const tankClasses = ['W√§chter', 'Tank', 'Paladin'];\n      return tankClasses[Math.floor(Math.random() * tankClasses.length)];\n    }\n    // Balanced (30-70%): Rogue/Hunter classes\n    else {\n      const rogueClasses = ['Scout', 'Ninja', 'Sch√ºtze'];\n      return rogueClasses[Math.floor(Math.random() * rogueClasses.length)];\n    }\n  }\n\n  isAggressiveClass(): boolean {\n    // Check if player class is one of the aggressive warrior classes\n    const aggressiveClasses = ['Krieger', 'K√§mpfer', 'Berserker'];\n    return aggressiveClasses.includes(this.playerClass);\n  }\n\n  /**\n   * Calculate how much damage this character actually receives\n   * Applies defense reduction if defending\n   */\n  protected calculateReceivedDamage(incomingDamage: number, _attacker?: Pawn): number {\n    let actualDamage = incomingDamage;\n\n    // Apply defense reduction if defending\n    if (this.isDefenseActive()) {\n      actualDamage *= this.defenseReduction;\n    }\n\n    return actualDamage;\n  }\n\n  /**\n   * Called when this character dies\n   * Handles death logic specific to characters (gives points to attacker, etc.)\n   */\n  protected onDeath(attacker?: Pawn): void {\n    this.kill();\n\n    // If attacker is a Character, give them kill points\n    if (attacker && 'addKill' in attacker && typeof attacker.addKill === 'function') {\n      const attackerCharacter = attacker as Character;\n      attackerCharacter.addKill(); // This already adds score and increments kills\n    }\n  }\n\n  /**\n   * Calculate damage this character deals when attacking\n   * Takes into account power charge, activity, and other bonuses\n   * @param baseDamage - Base damage from game settings\n   * @param usePower - Whether to consume power charge for bonus damage\n   * @returns Final damage to deal\n   */\n  calculateAttackDamage(baseDamage: number, usePower = false): number {\n    let damage = baseDamage;\n\n    // Activity bonus\n    const activityMultiplier = 1 + this.activityCount * 0.05;\n    damage = Math.floor(damage * activityMultiplier);\n\n    // Power bonus (only if usePower is true)\n    if (usePower && this.powerCharge > 0) {\n      const powerUsed = this.usePower();\n      if (powerUsed !== false && powerUsed > 0) {\n        damage *= 1 + powerUsed * 0.5;\n      }\n    }\n\n    return Math.floor(damage);\n  }\n\n  /**\n   * Calculate damage for auto-attacks\n   * Less powerful than manual attacks, consumes power less frequently\n   */\n  calculateAutoAttackDamage(baseDamage: number): number {\n    let damage = Math.floor(baseDamage * (0.5 + Math.random() * 0.8));\n\n    // Activity bonus\n    const activityMultiplier = 1 + this.activityCount * 0.05;\n    damage = Math.floor(damage * activityMultiplier);\n\n    // Power bonus (less consumption for auto-attacks)\n    if (this.powerCharge > 0) {\n      damage *= 1 + this.powerCharge * 0.3;\n      // Auto-attacks consume power less frequently\n      if (Math.random() < 0.5) {\n        this.powerCharge = Math.max(0, this.powerCharge - 1);\n      }\n    }\n\n    return Math.floor(damage);\n  }\n\n  /**\n   * Attack a target - main attack method\n   * Character calculates damage and triggers tryDamage on target\n   * @param target - Target to attack\n   * @param baseDamage - Base damage from game settings\n   * @param usePower - Whether to use power charge (default: false for auto-attacks)\n   * @returns Result of the attack including isPowerAttack flag\n   */\n  attack(\n    target: Pawn,\n    baseDamage: number,\n    usePower = false\n  ): { damage: number; wasKilled: boolean; isPowerAttack: boolean } {\n    // Check if power will be used (for effects) - must check BEFORE calculateAttackDamage consumes it\n    const powerChargeBefore = this.powerCharge;\n    const hasPowerToUse = usePower && powerChargeBefore > 0;\n\n    // Calculate damage this character deals (will consume power if usePower is true)\n    const damage = this.calculateAttackDamage(baseDamage, usePower);\n\n    // Check if power was actually consumed (powerCharge should be 0 if power was used)\n    // We check immediately after calculateAttackDamage, before handleHit might restore power\n    const powerChargeAfter = this.powerCharge;\n    const isPowerAttack = hasPowerToUse && powerChargeAfter < powerChargeBefore;\n\n    // Handle EmojiPawn onHit behavior BEFORE damage (if applicable)\n    // This is important for rewards like power charges\n    // Note: This might restore power charges, but isPowerAttack was already determined\n    if ('handleHit' in target && typeof target.handleHit === 'function') {\n      const emojiPawn = target as Pawn & { handleHit: (attacker: Character) => void };\n      emojiPawn.handleHit(this);\n    }\n\n    // Target handles all damage logic itself (reduction, death, etc.)\n    // onDeath will be called automatically if the target dies\n    const wasKilled = target.tryDamage(damage, this);\n\n    // Handle rewards for damage dealt (kill rewards are handled in onDeath)\n    if (!wasKilled && 'addScore' in this && typeof this.addScore === 'function') {\n      // Small score bonus for damage dealt\n      this.addScore(Math.floor(damage * (isPowerAttack ? 0.5 : 0.3)));\n    }\n\n    // Add visual effects\n    this.addEffect('attacking');\n    if ('addEffect' in target && typeof target.addEffect === 'function') {\n      const targetWithEffect = target as Pawn & { addEffect: (effectType: string) => void };\n      targetWithEffect.addEffect('damaged');\n    }\n\n    // Trigger attack effect (if both have elements)\n    if (this.element && target.element && window.effectsManager) {\n      window.effectsManager.triggerAttackEffect(this, target as PlayerLike, isPowerAttack);\n    }\n\n    // Counter-attack if target was defending (only for Characters)\n    if (!wasKilled && target instanceof Character) {\n      const defender = target as Character;\n      if (defender.isDefenseActive()) {\n        this.executeCounterAttack(defender, this, baseDamage);\n      }\n    }\n\n    return { damage, wasKilled, isPowerAttack };\n  }\n\n  /**\n   * Execute counter-attack from defender to attacker\n   * @param defender - Character that was defending\n   * @param attacker - Character that attacked\n   * @param baseDamage - Base damage from game settings\n   */\n  private executeCounterAttack(defender: Character, attacker: Character, baseDamage: number): void {\n    // Counter-attack damage is 50% of base damage\n    const counterDamage = Math.floor(baseDamage * 0.5);\n\n    // Defender attacks attacker back (counter-attacks don't use power)\n    // Use setTimeout to delay counter-attack slightly\n    setTimeout(() => {\n      const result = defender.attack(attacker, counterDamage, false);\n\n      // Notify game engine if needed (for UI updates, etc.)\n      if (defender.eventSystem) {\n        defender.eventSystem.emit('actionFeed', {\n          message: `üí• ${defender.displayName} startet einen Gegenangriff auf ${attacker.displayName}!`,\n          type: 'counter-attack'\n        });\n      }\n\n      // Handle kill if attacker was killed by counter-attack\n      if (result.wasKilled && defender.eventSystem) {\n        defender.eventSystem.emit('elimination', {\n          victim: attacker,\n          killer: defender\n        });\n      }\n\n      // Update UI for both characters\n      if (defender.element && window.effectsManager) {\n        window.effectsManager.triggerAttackEffect(defender, attacker, false, true);\n      }\n    }, 300); // Small delay for visual effect\n  }\n\n  heal(amount: number): boolean {\n    if (this.healsUsed >= 5) return false;\n\n    this.healsUsed++;\n\n    return this.gainHealth(amount) > 0;\n  }\n\n  usePower(): number | false {\n    if (this.powerCharge <= 0) return false;\n\n    const power = this.powerCharge;\n    this.powerCharge--;\n\n    return power;\n  }\n\n  addPowerCharge(amount = 1): void {\n    this.powerCharge = Math.min(this.powerCharge + amount, 5);\n  }\n\n  startDefense(duration = 5000): void {\n    this.isDefending = true;\n    this.defenseEndTime = Date.now() + duration;\n\n    if (this.element) {\n      this.element.classList.add('defending');\n    }\n  }\n\n  isDefenseActive(): boolean {\n    return this.isDefending && Date.now() < this.defenseEndTime;\n  }\n\n  updateDefenseStatus(): void {\n    if (this.isDefending && Date.now() > this.defenseEndTime) {\n      this.isDefending = false;\n      if (this.element) {\n        this.element.classList.remove('defending');\n      }\n    }\n  }\n\n  kill(): void {\n    super.kill();\n    this.deaths++;\n  }\n\n  respawn(): void {\n    super.respawn();\n    this.isDefending = false;\n    this.defenseEndTime = 0;\n    this.powerCharge = 0;\n    this.healsUsed = 0;\n    this.nextAutoAttack = Date.now() + Math.random() * 3000;\n  }\n\n  addScore(points: number): void {\n    this.score += points;\n\n    // Emit score update event for real-time leaderboard\n    if (this.eventSystem) {\n      this.eventSystem.emit('scoreUpdate', {\n        character: this,\n        score: this.score,\n        points: points\n      });\n    }\n  }\n\n  addKill(): void {\n    this.kills++;\n    this.score += 50;\n\n    // Emit score update event for real-time leaderboard\n    if (this.eventSystem) {\n      this.eventSystem.emit('scoreUpdate', {\n        character: this,\n        score: this.score,\n        points: 50\n      });\n    }\n  }\n\n  addEffect(effectType: string, duration = 10000): void {\n    if (!this.element) return;\n\n    this.effects.add(effectType);\n    this.element.classList.add(effectType);\n\n    setTimeout(() => {\n      this.effects.delete(effectType);\n      if (this.element) {\n        this.element.classList.remove(effectType);\n      }\n    }, duration);\n  }\n\n  getStats(): {\n    id: string;\n    displayName: string;\n    health: number;\n    maxHealth: number;\n    score: number;\n    kills: number;\n    deaths: number;\n    powerCharge: number;\n    healsUsed: number;\n    remainingHeals: number;\n    isDefending: boolean;\n    isDead: boolean;\n  } {\n    return {\n      id: this.id,\n      displayName: this.displayName,\n      health: this.health,\n      maxHealth: this.maxHealth,\n      score: this.score,\n      kills: this.kills,\n      deaths: this.deaths,\n      powerCharge: this.powerCharge,\n      healsUsed: this.healsUsed,\n      remainingHeals: 5 - this.healsUsed,\n      isDefending: this.isDefenseActive(),\n      isDead: this.isDead\n    };\n  }\n\n  updateActivity(): void {\n    this.lastActivity = Date.now();\n    this.activityCount++;\n  }\n\n  isInactive(timeout = 300000): boolean {\n    // 5 minutes\n    return Date.now() - this.lastActivity > timeout;\n  }\n\n  // IComponentContainer implementation\n  addComponent(component: import('../components/Component.js').IComponent): void {\n    // componentContainer.setEntity(this) is already called in constructor\n    this.componentContainer.addComponent(component);\n  }\n\n  removeComponent(componentType: string): boolean {\n    return this.componentContainer.removeComponent(componentType);\n  }\n\n  getComponent<T extends import('../components/Component.js').IComponent>(\n    componentType: string\n  ): T | undefined {\n    return this.componentContainer.getComponent<T>(componentType);\n  }\n\n  hasComponent(componentType: string): boolean {\n    return this.componentContainer.hasComponent(componentType);\n  }\n\n  updateComponents(deltaTime: number): void {\n    this.componentContainer.updateComponents(deltaTime);\n  }\n}\n\nexport { Character };\n","import { Component } from './Component.js';\nimport { PawnTag } from '../entities/Pawn.js';\nimport type { Character } from '../entities/Character.js';\nimport type { Pawn } from '../entities/Pawn.js';\nimport type { GameEngine } from '../GameEngine.js';\n\n/**\n * Configuration for AutoCombat component\n */\nexport interface AutoCombatConfig {\n  /**\n   * Tags that this entity considers as enemies (can attack)\n   */\n  enemyTags: PawnTag[];\n\n  /**\n   * Priority order for target selection (first tag has highest priority)\n   */\n  targetPriority: PawnTag[];\n\n  /**\n   * Auto-attack interval in milliseconds\n   */\n  attackInterval: number;\n\n  /**\n   * Base aggressiveness (0.0 - 1.0). Higher = more likely to attack\n   */\n  aggressiveness: number;\n\n  /**\n   * Whether this entity can auto-attack at all\n   */\n  canAutoAttack: boolean;\n}\n\n/**\n * AutoCombat Component - handles automatic combat behavior\n * Determines when, who, and how to attack automatically\n */\nexport class AutoCombat extends Component {\n  readonly componentType = 'AutoCombat';\n\n  private config: AutoCombatConfig;\n  private character: Character | null = null;\n  private nextAttackTime: number = 0;\n  private gameEngine: GameEngine | null = null;\n\n  constructor(config: AutoCombatConfig) {\n    super();\n    this.config = config;\n  }\n\n  onAttach(): void {\n    // Entity should be set by now (called after _setEntity in ComponentContainer)\n    // Try to get character immediately\n    try {\n      this.character = this.getEntity<Character>();\n      // Initialize attack timing based on config - add delay to prevent immediate attacks\n      this.nextAttackTime = Date.now() + Math.random() * this.config.attackInterval + 1000; // Add 1s minimum delay\n    } catch {\n      // If immediate access fails, try again later\n      setTimeout(() => {\n        try {\n          this.character = this.getEntity<Character>();\n          this.nextAttackTime = Date.now() + Math.random() * this.config.attackInterval + 1000;\n        } catch {\n          // Silently fail - will retry in update()\n        }\n      }, 10);\n    }\n  }\n\n  /**\n   * Set the game engine reference (needed for finding targets)\n   */\n  setGameEngine(gameEngine: GameEngine): void {\n    this.gameEngine = gameEngine;\n  }\n\n  /**\n   * Update component (called each game frame)\n   */\n  update(_deltaTime: number): void {\n    // Ensure character is set (in case onAttach didn't complete yet)\n    if (!this.character) {\n      try {\n        this.character = this.getEntity<Character>();\n        if (this.nextAttackTime === 0) {\n          // Initialize attack timing if not set\n          this.nextAttackTime = Date.now() + Math.random() * this.config.attackInterval;\n        }\n      } catch {\n        // Entity not set yet, skip this update\n        return;\n      }\n    }\n\n    if (!this.config.canAutoAttack) {\n      return;\n    }\n\n    if (!this.gameEngine || !this.character) {\n      return;\n    }\n\n    const now = Date.now();\n\n    // Check if it's time to attack\n    if (now < this.nextAttackTime) {\n      return;\n    }\n\n    if (this.character.isDead || this.character.health <= 0) {\n      return;\n    }\n\n    // Find target\n    const target = this.findTarget();\n    if (!target) {\n      // No target found, wait a bit before checking again\n      this.nextAttackTime = now + this.config.attackInterval * 0.5;\n      return;\n    }\n\n    // Check aggressiveness (random chance based on personality)\n    // Make sure character is set before calling shouldAttack\n    if (!this.character) {\n      return;\n    }\n\n    if (!this.shouldAttack()) {\n      this.nextAttackTime = now + this.config.attackInterval * 0.3;\n      return;\n    }\n\n    // Execute auto-attack\n    // Ensure character is set before executing attack\n    if (!this.character) {\n      // Try to get character one more time\n      try {\n        this.character = this.getEntity<Character>();\n      } catch {\n        return;\n      }\n    }\n\n    if (!this.character || !target || !this.gameEngine) {\n      return;\n    }\n\n    // Character attacks target directly - target handles everything itself\n    const baseDamage = this.gameEngine.settings.baseDamage;\n    const usePower = this.character.powerCharge > 0;\n    this.character.attack(target, baseDamage, usePower);\n\n    // Update UI for attacker (power might have changed, score updated, etc.)\n    this.gameEngine.renderSystem.updatePlayerTitle(this.character);\n\n    // Update target health if needed\n    if ('health' in target && 'maxHealth' in target) {\n      const targetWithHealth = target as Pawn & { health: number; maxHealth: number };\n      this.gameEngine.renderSystem.updatePlayerHealth(targetWithHealth as Character);\n    }\n\n    // Update next attack time\n    this.updateNextAttackTime(now);\n  }\n\n  /**\n   * Find a target based on enemy tags and priority\n   */\n  findTarget(): Pawn | null {\n    if (!this.gameEngine || !this.character) {\n      if (!this.character) {\n        // Try to get character from entity if not set\n        try {\n          this.character = this.getEntity<Character>();\n        } catch {\n          // Entity not set yet, can't find targets\n          return null;\n        }\n      }\n      if (!this.character || !this.gameEngine) return null;\n    }\n\n    // Get all pawns from game engine\n    const allPawns = this.getAllPawns();\n\n    // Filter valid targets based on enemy tags\n    const validTargets = allPawns.filter(target => {\n      if (!this.character) return false;\n      const isSelf = target.id === this.character.id;\n      const isAlive = !target.isDead && target.health > 0;\n      const isEnemy = this.isEnemy(target);\n      return !isSelf && isAlive && isEnemy;\n    });\n\n    if (validTargets.length === 0) return null;\n\n    // Select target based on priority order\n    for (const priorityTag of this.config.targetPriority) {\n      const targetsWithTag = validTargets.filter(target => target.hasTag(priorityTag));\n      if (targetsWithTag.length > 0) {\n        // Return random target from highest priority group\n        return targetsWithTag[Math.floor(Math.random() * targetsWithTag.length)];\n      }\n    }\n\n    // Fallback: return random valid target\n    return validTargets[Math.floor(Math.random() * validTargets.length)];\n  }\n\n  /**\n   * Check if a pawn is considered an enemy\n   */\n  isEnemy(pawn: Pawn): boolean {\n    return this.config.enemyTags.some(tag => pawn.hasTag(tag));\n  }\n\n  /**\n   * Check if this character should attack (based on aggressiveness)\n   */\n  shouldAttack(): boolean {\n    if (!this.character) {\n      return false;\n    }\n\n    // Ensure personality exists (default to 0.5 if undefined)\n    const personality = this.character.personality ?? 0.5;\n    const aggressiveness = this.config.aggressiveness ?? 0.5;\n\n    // Use character's personality (0.0 - 1.0) mixed with config aggressiveness\n    const combinedAggressiveness = personality * 0.5 + aggressiveness * 0.5;\n    return Math.random() < combinedAggressiveness;\n  }\n\n  /**\n   * Update next attack time based on interval\n   */\n  private updateNextAttackTime(now: number): void {\n    // Add some randomness to make attacks feel more natural\n    const randomVariation = this.config.attackInterval * 0.2;\n    const nextInterval = this.config.attackInterval + (Math.random() * 2 - 1) * randomVariation;\n    this.nextAttackTime = now + nextInterval;\n  }\n\n  /**\n   * Get all pawns from game engine\n   */\n  private getAllPawns(): Pawn[] {\n    if (!this.gameEngine) return [];\n\n    const pawns: Pawn[] = [];\n\n    // Add players\n    this.gameEngine.players.forEach(player => pawns.push(player));\n\n    // Add AI enemies\n    this.gameEngine.aiEnemies.forEach(enemy => pawns.push(enemy));\n\n    // Add emoji pawns\n    this.gameEngine.emojiPawns.forEach(emoji => pawns.push(emoji));\n\n    return pawns;\n  }\n\n  /**\n   * Get current configuration\n   */\n  getConfig(): Readonly<AutoCombatConfig> {\n    return this.config;\n  }\n\n  /**\n   * Update configuration (allows runtime changes)\n   */\n  updateConfig(newConfig: Partial<AutoCombatConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n  }\n}\n","import { Character } from './Character.js';\nimport { Pawn, PawnTag } from './Pawn.js';\nimport type { MessageData } from '../../twitchClient.js';\nimport type { GameSettings } from '../GameEngine.js';\nimport { AutoCombat } from '../components/AutoCombat.js';\n\n/**\n * Player class - extends Character for human players\n */\nclass Player extends Character {\n  constructor(id: string, messageData: MessageData | null | undefined, settings: GameSettings) {\n    // Defensive programming: ensure messageData has required properties\n    const partialData: Partial<MessageData> = messageData || {};\n\n    const displayName = partialData.displayName || partialData.username || id || 'Unknown Player';\n\n    // Use Pawn's static method for color generation\n    const tempPawn = new Pawn(id, '', '', 0);\n    const color = partialData.color || tempPawn.generateRandomColor();\n\n    super(id, displayName, color, settings.baseHealth, settings);\n\n    // Player-specific initialization\n    this.isAI = false;\n\n    // Players have the Player tag for attack priority system\n    this.addTag(PawnTag.Player);\n\n    // Add AutoCombat component with player-specific configuration\n    // Players can attack: Emoji (highest priority), Enemy, Player (PvP)\n    const autoCombat = new AutoCombat({\n      enemyTags: [PawnTag.Emoji, PawnTag.Enemy, PawnTag.Player],\n      targetPriority: [PawnTag.Emoji, PawnTag.Enemy, PawnTag.Player],\n      attackInterval: this.autoAttackInterval,\n      aggressiveness: this.personality,\n      canAutoAttack: true\n    });\n    this.addComponent(autoCombat);\n  }\n}\n\n// Re-export Position type for backwards compatibility\nexport type { Position } from './Pawn.js';\nexport { Player };\n","import { Player } from '../../entities/Player.js';\nimport type { MessageData } from '../../../twitchClient.js';\nimport type { Command, CommandContext } from './types.js';\nimport type { AutoCombat } from '../../components/AutoCombat.js';\n\n/**\n * Join command - Spieler tritt dem Spiel bei\n */\nclass JoinCommand implements Command {\n  execute(playerId: string, messageData: MessageData, context: CommandContext): void {\n    const { gameEngine } = context;\n\n    if (gameEngine.players.has(playerId)) {\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `${messageData.displayName} ist bereits im Spiel!`,\n        type: 'error'\n      });\n      return;\n    }\n\n    if (gameEngine.players.size >= gameEngine.settings.maxPlayers) {\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `Spiel ist voll! Maximal ${gameEngine.settings.maxPlayers} Spieler.`,\n        type: 'error'\n      });\n      return;\n    }\n\n    const player = new Player(playerId, messageData, gameEngine.settings);\n    player.setEventSystem(gameEngine.eventSystem);\n    console.log('Created player:', player.displayName, 'from messageData:', messageData);\n    gameEngine.players.set(playerId, player);\n    gameEngine.renderSystem.spawnPlayer(player);\n\n    // Connect AutoCombat component to GameEngine\n    const autoCombat = player.getComponent<AutoCombat>('AutoCombat');\n    if (autoCombat) {\n      autoCombat.setGameEngine(gameEngine);\n    }\n\n    gameEngine.eventSystem.emit('actionFeed', {\n      message: `‚öîÔ∏è ${player.displayName} ist dem Kampf beigetreten! (${player.playerClass})`,\n      type: 'join'\n    });\n\n    gameEngine.updateActiveViewers();\n  }\n}\n\nexport { JoinCommand };\n","import type { MessageData } from '../../../twitchClient.js';\nimport type { Command, CommandContext } from './types.js';\n\n/**\n * Defend command - Spieler aktiviert Verteidigung\n */\nclass DefendCommand implements Command {\n  execute(playerId: string, messageData: MessageData, context: CommandContext): void {\n    const { gameEngine, commandHandler } = context;\n    const player = gameEngine.players.get(playerId);\n\n    if (!player) {\n      // Auto-join if not in game\n      commandHandler.executeCommand('join', playerId, messageData, context);\n      return;\n    }\n\n    if (player.isDead || player.health <= 0) {\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `${messageData.displayName} kann nicht verteidigen - wartet auf Respawn!`,\n        type: 'error'\n      });\n      return;\n    }\n\n    // Check cooldown (8 seconds between defend commands)\n    const now = Date.now();\n    const cooldown = 8000; // 8 seconds\n    const lastDefendCommand = player.commandCooldowns.get('defend') || 0;\n    if (now - lastDefendCommand < cooldown) {\n      const remaining = Math.ceil((cooldown - (now - lastDefendCommand)) / 1000);\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `${messageData.displayName} - Verteidigung noch ${remaining}s im Cooldown!`,\n        type: 'error'\n      });\n      return;\n    }\n\n    player.commandCooldowns.set('defend', now);\n    player.lastCommand = now;\n    player.startDefense(10000);\n    player.addEffect('defending', 10000);\n\n    if (window.effectsManager) {\n      window.effectsManager.triggerDefendEffect(player, 10000);\n    }\n\n    gameEngine.eventSystem.emit('actionFeed', {\n      message: `üõ°Ô∏è ${messageData.displayName} aktiviert Verteidigung!`,\n      type: 'defend'\n    });\n  }\n}\n\nexport { DefendCommand };\n","import type { MessageData } from '../../../twitchClient.js';\nimport type { Command, CommandContext } from './types.js';\n\n/**\n * Power command - Spieler l√§dt Power-Attacke auf\n */\nclass PowerCommand implements Command {\n  execute(playerId: string, messageData: MessageData, context: CommandContext): void {\n    const { gameEngine, commandHandler } = context;\n    const player = gameEngine.players.get(playerId);\n\n    if (!player) {\n      // Auto-join if not in game\n      commandHandler.executeCommand('join', playerId, messageData, context);\n      return;\n    }\n\n    if (player.isDead || player.health <= 0) {\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `${messageData.displayName} kann nicht aufladen - wartet auf Respawn!`,\n        type: 'error'\n      });\n      return;\n    }\n\n    // Check cooldown (5 seconds between power commands)\n    const now = Date.now();\n    const cooldown = 5000; // 5 seconds\n    const lastPowerCommand = player.commandCooldowns.get('power') || 0;\n    if (now - lastPowerCommand < cooldown) {\n      const remaining = Math.ceil((cooldown - (now - lastPowerCommand)) / 1000);\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `${messageData.displayName} - Power-Aufladung noch ${remaining}s im Cooldown!`,\n        type: 'error'\n      });\n      return;\n    }\n\n    player.commandCooldowns.set('power', now);\n    player.lastCommand = now;\n    player.powerCharge = 5; // Full power charge\n    player.addEffect('power');\n\n    gameEngine.renderSystem.updatePlayerTitle(player);\n\n    if (window.effectsManager) {\n      window.effectsManager.triggerPowerEffect(player);\n    }\n\n    gameEngine.eventSystem.emit('actionFeed', {\n      message: `‚ö° ${messageData.displayName} l√§dt Spezialattacke! (${player.powerCharge}/5)`,\n      type: 'power'\n    });\n  }\n}\n\nexport { PowerCommand };\n","import type { MessageData } from '../../../twitchClient.js';\nimport type { Command, CommandContext } from './types.js';\n\n/**\n * Heal command - Spieler heilt sich\n */\nclass HealCommand implements Command {\n  execute(playerId: string, messageData: MessageData, context: CommandContext): void {\n    const { gameEngine, commandHandler } = context;\n    const player = gameEngine.players.get(playerId);\n\n    if (!player) {\n      // Auto-join if not in game\n      commandHandler.executeCommand('join', playerId, messageData, context);\n      return;\n    }\n\n    if (player.isDead || player.health <= 0) {\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `${messageData.displayName} kann nicht heilen - wartet auf Respawn!`,\n        type: 'error'\n      });\n      return;\n    }\n\n    if (player.healsUsed >= 5) {\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `${messageData.displayName} hat alle Heilungen aufgebraucht! (5/5 verwendet)`,\n        type: 'error'\n      });\n      return;\n    }\n\n    // Check cooldown (3 seconds between heal commands)\n    const now = Date.now();\n    const cooldown = 3000; // 3 seconds\n    const lastHealCommand = player.commandCooldowns.get('heal') || 0;\n    if (now - lastHealCommand < cooldown) {\n      const remaining = Math.ceil((cooldown - (now - lastHealCommand)) / 1000);\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `${messageData.displayName} - Heilung noch ${remaining}s im Cooldown!`,\n        type: 'error'\n      });\n      return;\n    }\n\n    player.commandCooldowns.set('heal', now);\n    player.lastCommand = now;\n    const healAmount = gameEngine.settings.healAmount;\n    const success = player.heal(healAmount);\n\n    if (success) {\n      gameEngine.renderSystem.updatePlayerHealth(player);\n      gameEngine.renderSystem.updatePlayerTitle(player);\n      player.addEffect('heal');\n\n      if (window.effectsManager) {\n        window.effectsManager.triggerHealEffect(player);\n      }\n\n      const remainingHeals = 5 - player.healsUsed;\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `üíö ${messageData.displayName} heilt sich um ${healAmount} HP! (${remainingHeals} Heilungen √ºbrig)`,\n        type: 'heal'\n      });\n\n      gameEngine.gameStats.totalHeals++;\n    }\n  }\n}\n\nexport { HealCommand };\n","import type { MessageData } from '../../../twitchClient.js';\nimport type { Command, CommandContext } from './types.js';\n\n/**\n * Stats command - Zeigt Spieler-Statistiken\n */\nclass StatsCommand implements Command {\n  execute(playerId: string, messageData: MessageData, context: CommandContext): void {\n    const { gameEngine } = context;\n    const player = gameEngine.players.get(playerId);\n\n    if (!player) {\n      gameEngine.eventSystem.emit('actionFeed', {\n        message: `${messageData.displayName} ist nicht im Spiel!`,\n        type: 'error'\n      });\n      return;\n    }\n\n    gameEngine.uiSystem.showPlayerStats(player);\n  }\n}\n\nexport { StatsCommand };\n","import { Pawn, PawnTag } from './Pawn.js';\nimport type { Character } from './Character.js';\nimport type { Pawn as PawnType } from './Pawn.js';\n\n/**\n * Interface for emoji pawn behavior configuration\n * Used by EmojiPawn subclasses to define behavior\n */\nexport interface EmojiBehavior {\n  onDeath?: (pawn: EmojiPawn, attacker?: Character) => void;\n  onHit?: (pawn: EmojiPawn, attacker?: Character) => void;\n  movementSpeed?: number;\n  movementPattern?: 'static' | 'random' | 'follow' | 'flee';\n  autoRemoveOnDeath?: boolean;\n}\n\n/**\n * EmojiPawn - A pawn that displays as an emoji and can have special behaviors\n * Extends Pawn to create interactive objects (monkeys, chests, bombs, doctors, etc.)\n */\nclass EmojiPawn extends Pawn {\n  emoji: string;\n  size: number;\n  behavior: EmojiBehavior;\n  movementSpeed: number;\n  movementTarget: Character | null;\n  lastMovementUpdate: number;\n  movementInterval: number;\n\n  constructor(\n    id: string,\n    emoji: string,\n    displayName: string,\n    maxHealth: number,\n    color: string,\n    size: number,\n    behavior: EmojiBehavior,\n    tags: PawnTag[] = [PawnTag.Emoji] // Default to Emoji tag, but can be overridden\n  ) {\n    super(id, displayName, color, maxHealth);\n    this.emoji = emoji;\n    this.size = size;\n    this.behavior = behavior;\n    this.movementSpeed = behavior.movementSpeed || 0;\n    this.movementTarget = null;\n    this.lastMovementUpdate = Date.now();\n    this.movementInterval = 100; // Update movement every 100ms\n\n    // Add tags (default Emoji, but can be configured)\n    tags.forEach(tag => this.addTag(tag));\n  }\n\n  /**\n   * Handle when this emoji pawn is killed\n   * Note: Actual removal is handled by onDeath() method\n   */\n  override kill(): void {\n    super.kill();\n  }\n\n  /**\n   * Handle when this emoji pawn is hit/damaged\n   */\n  handleHit(attacker?: Character): void {\n    if (this.behavior.onHit) {\n      this.behavior.onHit(this, attacker);\n    }\n  }\n\n  /**\n   * Update movement based on behavior pattern\n   */\n  updateMovement(targets: Character[]): void {\n    if (!this.element || this.isDead) return;\n\n    const now = Date.now();\n    if (now - this.lastMovementUpdate < this.movementInterval) return;\n    this.lastMovementUpdate = now;\n\n    if (this.movementSpeed === 0) return;\n\n    switch (this.behavior.movementPattern) {\n      case 'random':\n        this.moveRandom();\n        break;\n      case 'follow':\n        this.moveTowardsClosest(targets);\n        break;\n      case 'flee':\n        this.moveAwayFromClosest(targets);\n        break;\n      case 'static':\n      default:\n        // Don't move\n        break;\n    }\n  }\n\n  private moveRandom(): void {\n    const offset = {\n      x: (Math.random() - 0.5) * this.movementSpeed * 2,\n      y: (Math.random() - 0.5) * this.movementSpeed * 2\n    };\n\n    const newPos = {\n      x: this.position.x + offset.x,\n      y: this.position.y + offset.y\n    };\n\n    // Bounds check\n    const battlefield = document.getElementById('battlefield');\n    if (battlefield) {\n      const rect = battlefield.getBoundingClientRect();\n      newPos.x = Math.max(20, Math.min(newPos.x, rect.width - this.size - 20));\n      newPos.y = Math.max(20, Math.min(newPos.y, rect.height - this.size - 20));\n    }\n\n    this.updatePosition(newPos);\n  }\n\n  private moveTowardsClosest(targets: Character[]): void {\n    if (targets.length === 0) return;\n\n    const closest = targets.reduce(\n      (closest, target) => {\n        if (target.isDead || target.health <= 0) return closest;\n        const dist = this.getDistanceTo(target.position);\n        const closestDist = closest ? this.getDistanceTo(closest.position) : Infinity;\n        return dist < closestDist ? target : closest;\n      },\n      null as Character | null\n    );\n\n    if (!closest) return;\n\n    const dx = closest.position.x - this.position.x;\n    const dy = closest.position.y - this.position.y;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    if (dist > this.size) {\n      const moveX = (dx / dist) * this.movementSpeed;\n      const moveY = (dy / dist) * this.movementSpeed;\n\n      const newPos = {\n        x: this.position.x + moveX,\n        y: this.position.y + moveY\n      };\n\n      // Bounds check\n      const battlefield = document.getElementById('battlefield');\n      if (battlefield) {\n        const rect = battlefield.getBoundingClientRect();\n        newPos.x = Math.max(20, Math.min(newPos.x, rect.width - this.size - 20));\n        newPos.y = Math.max(20, Math.min(newPos.y, rect.height - this.size - 20));\n      }\n\n      this.updatePosition(newPos);\n    }\n  }\n\n  private moveAwayFromClosest(targets: Character[]): void {\n    if (targets.length === 0) return;\n\n    const closest = targets.reduce(\n      (closest, target) => {\n        if (target.isDead || target.health <= 0) return closest;\n        const dist = this.getDistanceTo(target.position);\n        const closestDist = closest ? this.getDistanceTo(closest.position) : Infinity;\n        return dist < closestDist ? target : closest;\n      },\n      null as Character | null\n    );\n\n    if (!closest) return;\n\n    const dx = this.position.x - closest.position.x;\n    const dy = this.position.y - closest.position.y;\n    const dist = Math.sqrt(dx * dx + dy * dy);\n\n    if (dist > 0) {\n      const moveX = (dx / dist) * this.movementSpeed;\n      const moveY = (dy / dist) * this.movementSpeed;\n\n      const newPos = {\n        x: this.position.x + moveX,\n        y: this.position.y + moveY\n      };\n\n      // Bounds check\n      const battlefield = document.getElementById('battlefield');\n      if (battlefield) {\n        const rect = battlefield.getBoundingClientRect();\n        newPos.x = Math.max(20, Math.min(newPos.x, rect.width - this.size - 20));\n        newPos.y = Math.max(20, Math.min(newPos.y, rect.height - this.size - 20));\n      }\n\n      this.updatePosition(newPos);\n    }\n  }\n\n  private getDistanceTo(targetPos: { x: number; y: number }): number {\n    const dx = this.position.x - targetPos.x;\n    const dy = this.position.y - targetPos.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Called when this emoji pawn dies\n   * Triggers onDeath behavior if configured\n   * Handles self-removal based on autoRemoveOnDeath behavior\n   */\n  protected onDeath(attacker?: PawnType): void {\n    super.onDeath(attacker);\n\n    // Trigger onDeath behavior (attacker is available here)\n    if (this.behavior.onDeath) {\n      const characterAttacker =\n        attacker && 'addKill' in attacker ? (attacker as Character) : undefined;\n      this.behavior.onDeath(this, characterAttacker);\n    }\n\n    if (this.behavior.autoRemoveOnDeath !== false) {\n      setTimeout(() => {\n        this.removeSelf();\n      }, 2000);\n    }\n  }\n\n  /**\n   * Remove this pawn from the game\n   * Emits an event that GameEngine listens to for cleanup\n   */\n  private removeSelf(): void {\n    if (this.eventSystem) {\n      // Emit event to request removal from game\n      this.eventSystem.emit('emojiPawnDeath', {\n        pawnId: this.id,\n        pawn: this\n      });\n    }\n  }\n}\n\nexport { EmojiPawn };\n","import { EmojiPawn, type EmojiBehavior } from '../EmojiPawn.js';\nimport type { EventSystem } from '../../events/EventSystem.js';\nimport { PawnTag } from '../Pawn.js';\nimport type { PawnTag as PawnTagType } from '../Pawn.js';\n\n/**\n * MonkeyEmojiPawn - A wild monkey that moves randomly around the battlefield\n */\nclass MonkeyEmojiPawn extends EmojiPawn {\n  static readonly HEALTH_MULTIPLIER = 0.3;\n  static readonly EMOJI = 'üêµ';\n  static readonly DISPLAY_NAME = 'Wilder Affe';\n  static readonly COLOR = '#8B4513';\n  static readonly SIZE = 50;\n\n  constructor(\n    id: string,\n    baseHealth: number,\n    eventSystem?: EventSystem,\n    customTags?: PawnTagType[]\n  ) {\n    const maxHealth = Math.floor(baseHealth * MonkeyEmojiPawn.HEALTH_MULTIPLIER);\n    const behavior: EmojiBehavior = {\n      movementPattern: 'random',\n      movementSpeed: 1,\n      autoRemoveOnDeath: true,\n      onHit: (pawn, attacker) => {\n        // Give power charge on hit\n        if (attacker && !attacker.isDead) {\n          attacker.addPowerCharge(2);\n          if (pawn.eventSystem) {\n            pawn.eventSystem.emit('actionFeed', {\n              message: `üêµ ${attacker.displayName} hat Power Charge vom Affen erhalten!`,\n              type: 'power'\n            });\n          }\n        }\n      }\n    };\n    const tags = customTags || [PawnTag.Emoji];\n\n    super(\n      id,\n      MonkeyEmojiPawn.EMOJI,\n      MonkeyEmojiPawn.DISPLAY_NAME,\n      maxHealth,\n      MonkeyEmojiPawn.COLOR,\n      MonkeyEmojiPawn.SIZE,\n      behavior,\n      tags\n    );\n\n    if (eventSystem) {\n      this.setEventSystem(eventSystem);\n    }\n  }\n}\n\nexport { MonkeyEmojiPawn };\n","import { EmojiPawn, type EmojiBehavior } from '../EmojiPawn.js';\nimport type { EventSystem } from '../../events/EventSystem.js';\nimport { PawnTag } from '../Pawn.js';\nimport type { PawnTag as PawnTagType } from '../Pawn.js';\n\n/**\n * BananaEmojiPawn - A banana that gives power charge when destroyed\n */\nclass BananaEmojiPawn extends EmojiPawn {\n  static readonly HEALTH_MULTIPLIER = 0.15;\n  static readonly EMOJI = 'üçå';\n  static readonly DISPLAY_NAME = 'Bananen-Power';\n  static readonly COLOR = '#FFD700';\n  static readonly SIZE = 35;\n\n  constructor(\n    id: string,\n    baseHealth: number,\n    eventSystem?: EventSystem,\n    customTags?: PawnTagType[]\n  ) {\n    const maxHealth = Math.floor(baseHealth * BananaEmojiPawn.HEALTH_MULTIPLIER);\n    const behavior: EmojiBehavior = {\n      movementPattern: 'static',\n      autoRemoveOnDeath: true,\n      onHit: (pawn, attacker) => {\n        // Give power charge\n        if (attacker && !attacker.isDead) {\n          attacker.addPowerCharge(2);\n          // Banana heal!\n          attacker.gainHealth(10);\n          if (pawn.eventSystem) {\n            pawn.eventSystem.emit('actionFeed', {\n              message: `‚ö° ${attacker.displayName} hat Power Charge erhalten!`,\n              type: 'power'\n            });\n          }\n        }\n      }\n    };\n    const tags = customTags || [PawnTag.Emoji];\n\n    super(\n      id,\n      BananaEmojiPawn.EMOJI,\n      BananaEmojiPawn.DISPLAY_NAME,\n      maxHealth,\n      BananaEmojiPawn.COLOR,\n      BananaEmojiPawn.SIZE,\n      behavior,\n      tags\n    );\n\n    if (eventSystem) {\n      this.setEventSystem(eventSystem);\n    }\n  }\n}\n\nexport { BananaEmojiPawn };\n","import type { MessageData } from '../../../twitchClient.js';\nimport type { Command, CommandContext } from './types.js';\nimport { MonkeyEmojiPawn } from '../../entities/EmojiPawns/MonkeyEmojiPawn.js';\nimport { BananaEmojiPawn } from '../../entities/EmojiPawns/BananaEmojiPawn.js';\n\n/**\n * Banana command - Spawns monkeys and triggers banana event\n */\nclass BananaCommand implements Command {\n  execute(playerId: string, messageData: MessageData, context: CommandContext): void {\n    const { gameEngine } = context;\n    const player = gameEngine.players.get(playerId);\n\n    gameEngine.eventSystem.createBananaEvent(player || { displayName: messageData.displayName });\n\n    // Trigger banana effects\n    gameEngine.uiSystem.addBananaShake();\n    gameEngine.uiSystem.createBananaRain();\n\n    // Spawn monkeys (2-4 random monkeys)\n    const monkeyCount = 2 + Math.floor(Math.random() * 3); // 2-4 monkeys\n    for (let i = 0; i < monkeyCount; i++) {\n      const id = `emoji_monkey_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      const monkey = new MonkeyEmojiPawn(\n        id,\n        gameEngine.settings.baseHealth,\n        gameEngine.eventSystem\n      );\n      gameEngine.addEmojiPawn(monkey);\n    }\n\n    const bananaCount = 1 + Math.floor(Math.random() * 3); // 1-3 bananas\n    for (let i = 0; i < bananaCount; i++) {\n      const id = `emoji_banana_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n      const banana = new BananaEmojiPawn(\n        id,\n        gameEngine.settings.baseHealth,\n        gameEngine.eventSystem\n      );\n      gameEngine.addEmojiPawn(banana);\n    }\n\n    // Gameplay effects for all players\n    gameEngine.players.forEach(p => {\n      if (p.element) {\n        p.addEffect('banana-glow', 5000);\n\n        // Small health boost\n        p.gainHealth(10);\n\n        // Small power boost\n        p.addPowerCharge(1);\n\n        // Update UI to show new power charge\n        gameEngine.renderSystem.updatePlayerTitle(p);\n\n        // Random movement\n        const randomOffset = {\n          x: (Math.random() - 0.5) * 30,\n          y: (Math.random() - 0.5) * 30\n        };\n\n        const originalPos = { ...p.position };\n        p.position.x += randomOffset.x;\n        p.position.y += randomOffset.y;\n\n        // Bounds check\n        const battlefield = document.getElementById('battlefield');\n        const battlefieldRect = battlefield.getBoundingClientRect();\n        p.position.x = Math.max(20, Math.min(p.position.x, battlefieldRect.width - 60));\n        p.position.y = Math.max(20, Math.min(p.position.y, battlefieldRect.height - 60));\n\n        gameEngine.renderSystem.updatePlayerPosition(p);\n\n        // Return to original position\n        setTimeout(() => {\n          p.updatePosition(originalPos);\n        }, 2000);\n      }\n    });\n\n    // Banana explosions\n    if (window.effectsManager) {\n      const battlefield = document.getElementById('battlefield');\n      const battlefieldRect = battlefield.getBoundingClientRect();\n      for (let i = 0; i < 3; i++) {\n        setTimeout(() => {\n          window.effectsManager.triggerExplosionEffect({\n            x: Math.random() * battlefieldRect.width,\n            y: Math.random() * battlefieldRect.height\n          });\n        }, i * 400);\n      }\n    }\n  }\n}\n\nexport { BananaCommand };\n","import type { MessageData } from '../../../twitchClient.js';\nimport type { Command, CommandContext } from './types.js';\n\n/**\n * Activity command - Standard f√ºr Chat-Aktivit√§t, bringt Spieler ins Spiel\n */\nclass ActivityCommand implements Command {\n  execute(playerId: string, messageData: MessageData, context: CommandContext): void {\n    const { gameEngine, commandHandler } = context;\n    let player = gameEngine.players.get(playerId);\n\n    // Auto-join if player doesn't exist\n    if (!player) {\n      commandHandler.executeCommand('join', playerId, messageData, context);\n      player = gameEngine.players.get(playerId);\n    }\n\n    if (!player) return;\n\n    // Reward chat activity\n    player.addScore(gameEngine.settings.chatActivityReward);\n    player.updateActivity();\n\n    // Dead players don't get activity bonuses\n    if (player.isDead || player.health <= 0) {\n      return;\n    }\n\n    // Chance for immediate bonuses\n    const bonusChance = Math.min(0.15, 0.05 + player.activityCount * 0.002);\n\n    if (Math.random() < bonusChance) {\n      const bonusType = Math.random();\n\n      if (bonusType < 0.4 && player.health < player.maxHealth) {\n        player.health = Math.min(player.health + 5, player.maxHealth);\n        player.addEffect('heal');\n        gameEngine.renderSystem.updatePlayerHealth(player);\n\n        gameEngine.eventSystem.emit('actionFeed', {\n          message: `üíö ${messageData.displayName} regeneriert durch Chat-Aktivit√§t! (+5 HP)`,\n          type: 'activity-bonus'\n        });\n      } else if (bonusType < 0.7) {\n        player.addPowerCharge(1);\n        player.addEffect('power');\n        gameEngine.renderSystem.updatePlayerTitle(player);\n\n        gameEngine.eventSystem.emit('actionFeed', {\n          message: `‚ö° ${messageData.displayName} sammelt Energie! (+1 Power)`,\n          type: 'activity-bonus'\n        });\n      } else {\n        player.addScore(10);\n\n        gameEngine.eventSystem.emit('actionFeed', {\n          message: `üåü ${messageData.displayName} erh√§lt Chat-Bonus! (+10 Punkte)`,\n          type: 'activity-bonus'\n        });\n      }\n    }\n\n    // Guaranteed auto-attack for active players\n    if (gameEngine.players.size > 1) {\n      const possibleTargets = Array.from(gameEngine.players.values()).filter(\n        p => p.id !== player.id && !p.isDead && p.health > 0\n      );\n\n      if (possibleTargets.length > 0) {\n        const target = possibleTargets[Math.floor(Math.random() * possibleTargets.length)];\n\n        const personalityDelay = player.personality * 1000;\n        const randomDelay = Math.random() * 2000;\n        const totalDelay = 200 + personalityDelay + randomDelay;\n\n        setTimeout(() => {\n          // Character attacks target directly - target handles everything itself\n          const baseDamage = gameEngine.settings.baseDamage;\n          const result = player.attack(target, baseDamage, false); // Activity auto-attacks don't use power\n\n          if (Math.random() < 0.7) {\n            gameEngine.eventSystem.emit('actionFeed', {\n              message: `‚öîÔ∏è ${player.displayName} greift ${target.displayName} an! (${result.damage} Schaden)`,\n              type: 'auto-attack'\n            });\n          }\n\n          gameEngine.renderSystem.updatePlayerHealth(target);\n          gameEngine.renderSystem.updatePlayerTitle(player);\n\n          if (result.wasKilled) {\n            gameEngine.eventSystem.emit('elimination', {\n              victim: target,\n              killer: player\n            });\n          }\n        }, totalDelay);\n\n        player.nextAutoAttack = Math.max(player.nextAutoAttack, Date.now() + totalDelay + 1000);\n      }\n    }\n  }\n}\n\nexport { ActivityCommand };\n","/**\n * Command Index - Zentrale Registry f√ºr alle Commands\n * Importiert alle Commands als ES Modules\n */\n\nimport { JoinCommand } from './join.js';\nimport { DefendCommand } from './defend.js';\nimport { PowerCommand } from './power.js';\nimport { HealCommand } from './heal.js';\nimport { StatsCommand } from './stats.js';\nimport { BananaCommand } from './banana.js';\nimport { ActivityCommand } from './activity.js';\n\nconst getCommands = () => {\n  return {\n    JoinCommand,\n    DefendCommand,\n    PowerCommand,\n    HealCommand,\n    StatsCommand,\n    BananaCommand,\n    ActivityCommand\n  };\n};\n\n/**\n * Command Registry\n * Mapped Command-Namen zu Command-Klassen\n */\nconst getCommandRegistry = () => {\n  const commands = getCommands();\n  return {\n    join: commands.JoinCommand,\n    defend: commands.DefendCommand,\n    power: commands.PowerCommand,\n    heal: commands.HealCommand,\n    stats: commands.StatsCommand,\n    banana: commands.BananaCommand,\n    activity: commands.ActivityCommand\n  };\n};\n\nimport type { MessageData } from '../../../twitchClient.js';\nimport type { CommandContext } from './types.js';\n\nconst COMMANDS = getCommandRegistry();\n\nimport type { Command } from './types.js';\n\n/**\n * Get command by name\n * @param {string} commandName - Name des Commands\n * @returns {class|null} Command-Klasse oder null\n */\nfunction getCommand(commandName: string): new () => Command | null {\n  return (COMMANDS[commandName] as new () => Command) || null;\n}\n\n/**\n * Check if command exists\n * @param {string} commandName - Name des Commands\n * @returns {boolean} True wenn Command existiert\n */\nfunction hasCommand(commandName: string): boolean {\n  return commandName in COMMANDS;\n}\n\n/**\n * Get all registered command names\n * @returns {string[]} Array aller Command-Namen\n */\nfunction getAllCommandNames(): string[] {\n  return Object.keys(COMMANDS);\n}\n\n/**\n * Execute command\n * @param {string} commandName - Name des Commands\n * @param {string} playerId - Spieler-ID\n * @param {object} messageData - Message-Daten\n * @param {object} context - Kontext (gameEngine, commandHandler)\n * @param {string} targetId - Optional: Ziel-ID\n */\nfunction executeCommand(\n  commandName: string,\n  playerId: string,\n  messageData: MessageData,\n  context: CommandContext,\n  targetId?: string | null\n): void {\n  const CommandClass = getCommand(commandName);\n\n  if (!CommandClass) {\n    console.error(`Command \"${commandName}\" nicht gefunden!`);\n    return;\n  }\n\n  // Create instance and call execute method\n  const command = new CommandClass();\n  command.execute(playerId, messageData, context, targetId);\n}\n\nexport const CommandRegistry = {\n  getCommand,\n  hasCommand,\n  getAllCommandNames,\n  executeCommand\n};\n","import { CommandRegistry } from './commands/index.js';\nimport type { Command } from '../../twitchClient.js';\nimport type { MessageData } from '../../twitchClient.js';\nimport { GameEngine } from '../GameEngine.js';\n\nclass CommandHandler {\n  gameEngine: GameEngine;\n\n  constructor(gameEngine: GameEngine) {\n    this.gameEngine = gameEngine;\n  }\n\n  /**\n   * Helper function to ensure messageData has required properties\n   */\n  normalizeMessageData(\n    messageData: MessageData | null | undefined,\n    playerId?: string\n  ): MessageData {\n    const partialData: Partial<MessageData> = messageData || {};\n\n    return {\n      username: partialData.username || playerId || 'unknown',\n      displayName: partialData.displayName || partialData.username || playerId || 'Unknown Player',\n      message: partialData.message || '',\n      color: partialData.color || this.generateRandomColor(),\n      badges: partialData.badges || [],\n      isMod: partialData.isMod || false,\n      isSubscriber: partialData.isSubscriber || false,\n      isVip: partialData.isVip || false,\n      timestamp: partialData.timestamp || new Date()\n    };\n  }\n\n  generateRandomColor(): string {\n    const colors = [\n      '#ff6b6b',\n      '#4ecdc4',\n      '#45b7d1',\n      '#96ceb4',\n      '#feca57',\n      '#ff9ff3',\n      '#54a0ff',\n      '#5f27cd',\n      '#00d2d3',\n      '#ff9f43',\n      '#a55eea',\n      '#26de81',\n      '#fd79a8',\n      '#fdcb6e',\n      '#e17055'\n    ];\n    return colors[Math.floor(Math.random() * colors.length)];\n  }\n\n  /**\n   * Process incoming command\n   * @param {object} command - Command object\n   * @param {object} messageData - Message data\n   */\n  processCommand(command: Command, messageData: MessageData): void {\n    if (!this.gameEngine.isRunning) {\n      this.gameEngine.eventSystem.emit('actionFeed', {\n        message: 'Spiel ist nicht aktiv! Warte auf den Start.',\n        type: 'error'\n      });\n      return;\n    }\n\n    // Normalize messageData to ensure all required properties exist\n    messageData = this.normalizeMessageData(messageData, command.user);\n\n    // Execute command via index\n    this.executeCommand(command.type, command.user, messageData, undefined, command.target || null);\n  }\n\n  /**\n   * Execute command by name\n   * Public method for commands to call each other\n   * @param {string} commandName - Name des Commands\n   * @param {string} playerId - Spieler-ID\n   * @param {string} targetId - Ziel-ID\n   * @param {object} messageData - Message-Daten\n   * @param {object} context - Command context (optional, will be created if not provided)\n   */\n  executeCommand(\n    commandName: string,\n    playerId: string,\n    messageData: MessageData,\n    context?: { gameEngine: GameEngine; commandHandler: CommandHandler },\n    targetId?: string | null\n  ): void {\n    // Create context for commands if not provided\n    const commandContext =\n      context ||\n      ({\n        gameEngine: this.gameEngine,\n        commandHandler: this\n      } as { gameEngine: GameEngine; commandHandler: CommandHandler });\n\n    // Execute via CommandRegistry\n    CommandRegistry.executeCommand(commandName, playerId, messageData, commandContext, targetId);\n  }\n}\n\nexport { CommandHandler };\n","import { Character } from './Character.js';\nimport { PawnTag } from './Pawn.js';\nimport type { GameSettings } from '../GameEngine.js';\nimport { AutoCombat } from '../components/AutoCombat.js';\n\ntype EnemyType = 'weak' | 'medium' | 'strong' | 'elite';\n\n/**\n * AIEnemy class - extends Character for AI-controlled enemies\n */\nclass AIEnemy extends Character {\n  aiType: EnemyType;\n  enemyType: EnemyType;\n  aiBehavior: number;\n  damageMultiplier: number;\n  waveNumber: number;\n\n  constructor(id: string, waveNumber: number, enemyType: EnemyType, settings: GameSettings) {\n    const enemyData = AIEnemy.ENEMY_TYPES[enemyType];\n    const randomName = enemyData.names[Math.floor(Math.random() * enemyData.names.length)];\n    const randomColor = enemyData.colors[Math.floor(Math.random() * enemyData.colors.length)];\n\n    const displayName = `${randomName} Lv.${waveNumber}`;\n    const waveMultiplier = 1 + (waveNumber - 1) * 0.15;\n    const maxHealth = Math.floor(settings.baseHealth * enemyData.healthMultiplier * waveMultiplier);\n\n    super(id, displayName, randomColor, maxHealth, settings);\n\n    // AI-specific properties\n    this.isAI = true;\n    this.aiType = enemyType;\n    this.enemyType = enemyType;\n    this.autoAttackInterval = enemyData.attackInterval;\n    this.personality = 0.3 + Math.random() * 0.4; // 30%-70% aggressive\n    this.aiBehavior = Math.random();\n    this.damageMultiplier = enemyData.damageMultiplier;\n    this.waveNumber = waveNumber;\n\n    // Reduce activity count for AI\n    this.activityCount = Math.floor(Math.random() * 5);\n\n    // Remove Player tag and add Enemy tag\n    this.removeTag(PawnTag.Player);\n    this.addTag(PawnTag.Enemy);\n\n    // Add AutoCombat component with AI-specific configuration\n    // AI Enemies only attack Players (not other enemies, not emojis)\n    const autoCombat = new AutoCombat({\n      enemyTags: [PawnTag.Player],\n      targetPriority: [PawnTag.Player],\n      attackInterval: this.autoAttackInterval,\n      aggressiveness: this.personality,\n      canAutoAttack: true\n    });\n    this.addComponent(autoCombat);\n  }\n\n  static ENEMY_TYPES = {\n    weak: {\n      healthMultiplier: 0.5,\n      damageMultiplier: 0.4,\n      attackInterval: 3000,\n      spawnWeight: 40,\n      names: ['Goblin', 'Kobold', 'Bandit', 'Rogue', 'Thief', 'Imp', 'Minion'],\n      colors: ['#8B4513', '#A0522D', '#CD853F', '#DEB887', '#F4A460', '#D2691E', '#B8860B']\n    },\n    medium: {\n      healthMultiplier: 0.9,\n      damageMultiplier: 0.7,\n      attackInterval: 2500,\n      spawnWeight: 30,\n      names: ['Orc', 'Troll', 'Warrior', 'Guardian', 'Berserker', 'Brute', 'Savage'],\n      colors: ['#228B22', '#32CD32', '#7CFC00', '#9ACD32', '#ADFF2F', '#98FB98', '#90EE90']\n    },\n    strong: {\n      healthMultiplier: 1.5,\n      damageMultiplier: 1.1,\n      attackInterval: 2000,\n      spawnWeight: 20,\n      names: ['Demon', 'Dragon', 'Boss', 'Champion', 'Overlord', 'Destroyer', 'Tyrant'],\n      colors: ['#FF0000', '#DC143C', '#B22222', '#8B0000', '#FF6347', '#FF4500', '#FF1493']\n    },\n    elite: {\n      healthMultiplier: 2.2,\n      damageMultiplier: 1.5,\n      attackInterval: 1500,\n      spawnWeight: 10,\n      names: [\n        'Archfiend',\n        'Ancient',\n        'Nightmare',\n        'Apocalypse',\n        'Nemesis',\n        'Harbinger',\n        'Sovereign'\n      ],\n      colors: ['#4B0082', '#8B008B', '#9400D3', '#8A2BE2', '#9932CC', '#BA55D3', '#DDA0DD']\n    }\n  };\n\n  static createRandom(waveNumber: number, settings: GameSettings): AIEnemy {\n    // Choose random enemy type based on weight\n    const typeWeights = [];\n    Object.entries(AIEnemy.ENEMY_TYPES).forEach(([type, data]) => {\n      for (let i = 0; i < data.spawnWeight; i++) {\n        typeWeights.push(type);\n      }\n    });\n\n    const selectedType = typeWeights[Math.floor(Math.random() * typeWeights.length)];\n    const enemyId = 'ai_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);\n\n    return new AIEnemy(enemyId, waveNumber, selectedType, settings);\n  }\n\n  getBorderStyle(): { border: string; boxShadow: string } {\n    switch (this.enemyType) {\n      case 'weak':\n        return { border: '2px solid #ffaa00', boxShadow: '0 0 8px rgba(255, 170, 0, 0.5)' };\n      case 'medium':\n        return {\n          border: '2px solid #ff6600',\n          boxShadow: '0 0 10px rgba(255, 102, 0, 0.5)'\n        };\n      case 'strong':\n        return { border: '2px solid #ff0000', boxShadow: '0 0 12px rgba(255, 0, 0, 0.7)' };\n      case 'elite':\n        return {\n          border: '3px solid #8B008B',\n          boxShadow: '0 0 15px rgba(139, 0, 139, 0.8)'\n        };\n      default:\n        return { border: '2px solid #ff0000', boxShadow: '0 0 10px rgba(255, 0, 0, 0.5)' };\n    }\n  }\n\n  getHealthBarColor(): string {\n    return 'linear-gradient(90deg, #ff4444, #cc0000)';\n  }\n\n  shouldAttack(targets: Character[]): Character | null {\n    if (targets.length === 0) return null;\n\n    // AI (Enemy tag) only attacks Players (never other Enemies or Emojis)\n    const playerTargets = targets.filter(\n      target => target.hasTag(PawnTag.Player) && !target.isDead && target.health > 0\n    );\n    if (playerTargets.length === 0) return null;\n\n    // Check if it's time to attack\n    const now = Date.now();\n    if (now < this.nextAutoAttack) return null;\n\n    // Reduced aggressiveness for AI\n    const aggressiveness = 0.4;\n    if (Math.random() > aggressiveness) return null;\n\n    // Select random player target\n    return playerTargets[Math.floor(Math.random() * playerTargets.length)];\n  }\n\n  updateNextAttackTime(): void {\n    const baseInterval = this.autoAttackInterval || 2000;\n    const activityBonus = Math.max(0.3, 1 - this.activityCount * 0.01);\n    const personalityBonus = this.personality > 0.7 ? 0.5 : 0.7;\n    const aiBonus = 1.5; // AI attacks slower than players\n\n    this.nextAutoAttack = Date.now() + baseInterval * activityBonus * personalityBonus * aiBonus;\n  }\n\n  /**\n   * Override calculateAttackDamage to include AI-specific multipliers\n   */\n  override calculateAttackDamage(baseDamage: number, _usePower = false): number {\n    let damage = Math.floor(baseDamage * (0.5 + Math.random() * 0.8));\n\n    // Apply AI damage multiplier\n    if (this.damageMultiplier) {\n      damage = Math.floor(damage * this.damageMultiplier);\n    }\n\n    // Call parent for activity bonus (but AI doesn't use power)\n    damage = super.calculateAttackDamage(damage, false);\n\n    return damage;\n  }\n\n  /**\n   * Override calculateAutoAttackDamage to include AI-specific multipliers\n   */\n  override calculateAutoAttackDamage(baseDamage: number): number {\n    let damage = Math.floor(baseDamage * (0.5 + Math.random() * 0.8));\n\n    // Apply AI damage multiplier\n    if (this.damageMultiplier) {\n      damage = Math.floor(damage * this.damageMultiplier);\n    }\n\n    // Call parent for activity bonus\n    damage = super.calculateAutoAttackDamage(damage);\n\n    return damage;\n  }\n\n  addKill(): void {\n    super.addKill();\n    this.score = this.score - 50 + 25; // AI gets less points (25 instead of 50)\n  }\n\n  getDisplayInfo(): ReturnType<Character['getStats']> & {\n    type: EnemyType;\n    waveNumber: number;\n    damageMultiplier: number;\n    isAI: boolean;\n  } {\n    return {\n      ...this.getStats(),\n      type: this.enemyType,\n      waveNumber: this.waveNumber,\n      damageMultiplier: this.damageMultiplier,\n      isAI: true\n    };\n  }\n}\n\nexport { AIEnemy };\n","import { EventSystem } from './events/EventSystem.js';\nimport { RenderSystem } from './systems/RenderSystem.js';\nimport { CombatSystem } from './systems/CombatSystem.js';\nimport { WaveSystem } from './systems/WaveSystem.js';\nimport { UISystem } from './ui/UISystem.js';\nimport { CommandHandler } from './systems/CommandHandler.js';\nimport { Player } from './entities/Player.js';\nimport { AIEnemy } from './entities/AIEnemy.js';\nimport type { Character } from './entities/Character.js';\nimport type { EmojiPawn } from './entities/EmojiPawn.js';\nimport type { Command, MessageData } from '../twitchClient.js';\nimport type { AutoCombat } from './components/AutoCombat.js';\n\nexport interface GameSettings {\n  maxPlayers: number;\n  baseHealth: number;\n  baseDamage: number;\n  healAmount: number;\n  defenseReduction: number;\n  chatActivityReward: number;\n  waveInterval: number;\n  inactiveTimeout: number;\n  autoAttackChance: number;\n}\n\ninterface GameStats {\n  totalDamage: number;\n  totalHeals: number;\n  totalAttacks: number;\n  startTime: number | null;\n  uptime: number;\n}\n\nclass GameEngine {\n  isRunning: boolean;\n  isGameOver: boolean;\n  players: Map<string, Player>;\n  aiEnemies: Map<string, AIEnemy>;\n  emojiPawns: Map<string, EmojiPawn>;\n  settings: GameSettings;\n  gameStats: GameStats;\n  gameLoop: ReturnType<typeof setInterval> | null;\n  gameOverTimer: ReturnType<typeof setTimeout> | null;\n  gameSeed: number | null;\n  survivingPlayers: Character[];\n  eventSystem!: EventSystem;\n  renderSystem!: RenderSystem;\n  combatSystem!: CombatSystem;\n  waveSystem!: WaveSystem;\n  uiSystem!: UISystem;\n  commandHandler!: CommandHandler;\n  currentWave: number;\n  gameMode: string;\n\n  constructor() {\n    this.isRunning = false;\n    this.isGameOver = false;\n    this.players = new Map();\n    this.aiEnemies = new Map();\n    this.emojiPawns = new Map();\n\n    // Game settings\n    this.settings = {\n      maxPlayers: 50,\n      baseHealth: 100,\n      baseDamage: 10,\n      healAmount: 75,\n      defenseReduction: 0.2,\n      chatActivityReward: 2,\n      waveInterval: 60000, // 60 seconds\n      inactiveTimeout: 300000, // 5 minutes\n      autoAttackChance: 0.3\n    };\n\n    // Game statistics\n    this.gameStats = {\n      totalDamage: 0,\n      totalHeals: 0,\n      totalAttacks: 0,\n      startTime: null,\n      uptime: 0\n    };\n\n    // Game timers\n    this.gameLoop = null;\n    this.gameOverTimer = null;\n\n    // Project-wide random seed (resets each game start)\n    this.gameSeed = null;\n\n    // Players that survive between rounds\n    this.survivingPlayers = [];\n    this.currentWave = 1;\n    this.gameMode = 'endless';\n\n    // Initialize systems\n    this.initializeSystems();\n\n    // Start game loop\n    this.startGameLoop();\n  }\n\n  initializeSystems(): void {\n    // Initialize all game systems\n    this.eventSystem = new EventSystem();\n    this.renderSystem = new RenderSystem();\n    this.combatSystem = new CombatSystem(this.settings);\n    this.waveSystem = new WaveSystem(this.settings);\n    this.uiSystem = new UISystem();\n    this.commandHandler = new CommandHandler(this);\n\n    // Connect event system and game engine to other systems\n    this.combatSystem.setGameEngine(this);\n    this.waveSystem.setEventSystem(this.eventSystem);\n    this.waveSystem.setGameEngine(this);\n\n    // Setup event listeners\n    this.setupEventListeners();\n  }\n\n  setupEventListeners(): void {\n    // Action feed events\n    this.eventSystem.on('actionFeed', (data: { message: string; type: string } | unknown) => {\n      const actionData = data as { message: string; type: string };\n      this.uiSystem.addActionToFeed(actionData.message, actionData.type);\n    });\n\n    // Elimination events\n    this.eventSystem.on(\n      'elimination',\n      (data: { victim: Character; killer: Character } | unknown) => {\n        const elimData = data as { victim: Character; killer: Character };\n        this.handleElimination(elimData.victim, elimData.killer);\n      }\n    );\n\n    // EmojiPawn death events - pawn requests its own removal\n    this.eventSystem.on('emojiPawnDeath', (data: { pawnId: string; pawn: EmojiPawn } | unknown) => {\n      const deathData = data as { pawnId: string; pawn: EmojiPawn };\n      this.removeEmojiPawn(deathData.pawnId);\n    });\n\n    // Banana events\n    this.eventSystem.on('bananaEvent', (data: { player: Character } | unknown) => {\n      const bananaData = data as { player: Character };\n      this.handleBananaEvent(bananaData.player);\n    });\n\n    // Chaos mode events\n    this.eventSystem.on('chaosMode', (data: { duration: number } | unknown) => {\n      const chaosData = data as { duration: number };\n      this.handleChaosMode(chaosData.duration);\n    });\n\n    // Wave events\n    this.eventSystem.on('waveComplete', (data: { waveNumber: number } | unknown) => {\n      const waveData = data as { waveNumber: number };\n      this.handleWaveComplete(waveData.waveNumber);\n    });\n\n    // Wave start events\n    this.eventSystem.on('waveStart', (data: { waveNumber: number } | unknown) => {\n      const waveData = data as { waveNumber: number };\n      this.handleWaveComplete(waveData.waveNumber);\n    });\n\n    // Health update events\n    this.eventSystem.on(\n      'healthUpdate',\n      (data: { pawn?: Character | EmojiPawn; player?: Character } | unknown) => {\n        const healthData = data as { pawn?: Character | EmojiPawn; player?: Character };\n        const entity = healthData.pawn || healthData.player;\n        if (entity) {\n          this.renderSystem.updatePlayerHealth(entity);\n        }\n      }\n    );\n\n    // Score update events for real-time leaderboard\n    this.eventSystem.on('scoreUpdate', _data => {\n      this.updateLeaderboard();\n    });\n  }\n\n  initializeGame(): void {\n    console.log('Game initialized');\n    this.startGameLoop();\n  }\n\n  startGame(): void {\n    if (this.isRunning) return;\n\n    // Generate new seed for this game session\n    this.gameSeed = Math.random();\n    console.log('New game seed generated:', this.gameSeed);\n\n    this.isRunning = true;\n    this.isGameOver = false;\n    this.gameStats.startTime = Date.now();\n\n    // Start all systems\n    this.waveSystem.start();\n    // Auto-attacks are now handled by AutoCombat components, no need for separate system\n\n    this.updateActiveViewers();\n    this.updateLeaderboard();\n\n    console.log('Game started!');\n    this.eventSystem.emit('actionFeed', {\n      message: 'üéÆ Spiel gestartet! Schreibt einfach im Chat um mitzuk√§mpfen!',\n      type: 'system'\n    });\n  }\n\n  stopGame(): void {\n    this.isRunning = false;\n    this.isGameOver = false;\n    this.gameStats.startTime = null;\n\n    // Stop all systems\n    this.waveSystem.stop();\n    // Auto-attacks are now handled by AutoCombat components, no need to stop separate system\n\n    if (this.gameOverTimer) {\n      clearTimeout(this.gameOverTimer);\n      this.gameOverTimer = null;\n    }\n\n    // Clear battlefield\n    this.renderSystem.clearBattlefield();\n    this.players.clear();\n    this.aiEnemies.clear();\n\n    this.updateActiveViewers();\n    this.updateLeaderboard();\n    this.uiSystem.removeGameOverBanner();\n\n    console.log('Game stopped!');\n    this.eventSystem.emit('actionFeed', {\n      message: 'üõë Spiel gestoppt!',\n      type: 'system'\n    });\n  }\n\n  startGameLoop(): void {\n    if (this.gameLoop) return;\n\n    this.gameLoop = setInterval(() => {\n      // Update emoji pawns movement\n      if (this.isRunning) {\n        const allCharacters = [\n          ...Array.from(this.players.values()),\n          ...Array.from(this.aiEnemies.values())\n        ];\n        this.emojiPawns.forEach(emojiPawn => {\n          emojiPawn.updateMovement(allCharacters);\n        });\n      }\n      this.updateGame();\n    }, 100); // 10 FPS\n  }\n\n  updateGame(): void {\n    if (!this.isRunning) return;\n\n    // Update components for all characters\n    const deltaTime = 100; // 100ms per update cycle (10 FPS)\n    this.players.forEach(player => {\n      player.updateComponents(deltaTime);\n    });\n    this.aiEnemies.forEach(enemy => {\n      enemy.updateComponents(deltaTime);\n    });\n\n    // Update game statistics\n    this.gameStats.uptime = Date.now() - (this.gameStats.startTime || Date.now());\n\n    // Update player effects and positions\n    this.players.forEach(player => {\n      this.renderSystem.updatePlayerEffects(player);\n    });\n\n    // Random events\n    if (Math.random() < 0.002) {\n      this.eventSystem.triggerRandomEvent(this.players);\n    }\n\n    // Check for game over\n    this.checkGameOverCondition();\n  }\n\n  processCommand(command: Command, messageData: MessageData): void {\n    this.commandHandler.processCommand(command, messageData);\n  }\n\n  handleElimination(victim: Character | EmojiPawn, killer?: Character): void {\n    // Skip elimination handling for EmojiPawns (they handle their own onDeath behaviors)\n    if ('emoji' in victim && 'handleHit' in victim) {\n      return;\n    }\n\n    const killerText = killer.isAI ? `${killer.displayName} (KI)` : killer.displayName;\n    const victimText = victim.isAI ? `${victim.displayName} (KI)` : victim.displayName;\n    const pointsText = victim.isAI ? '+25' : '+50';\n\n    this.eventSystem.emit('actionFeed', {\n      message: `üíÄ ${victimText} wurde eliminiert! (${pointsText} Punkte f√ºr ${killerText})`,\n      type: 'elimination'\n    });\n\n    // Remove AI enemies after elimination\n    if (victim.isAI) {\n      setTimeout(() => {\n        this.removeAIEnemy(victim.id);\n      }, 2000);\n    } else {\n      this.eventSystem.emit('actionFeed', {\n        message: `üíÄ ${victim.displayName} wartet auf die n√§chste Welle zum Respawn!`,\n        type: 'death'\n      });\n    }\n\n    // Check if only one player is left alive - if so, speed up next wave\n    this.checkAndAdjustWaveTimer();\n\n    this.uiSystem.addScreenShake();\n  }\n\n  checkAndAdjustWaveTimer(): void {\n    if (!this.isRunning || !this.waveSystem.isActive) return;\n\n    // Count alive players (not dead, health > 0)\n    const alivePlayers = Array.from(this.players.values()).filter(\n      player => !player.isDead && player.health > 0\n    );\n\n    // Count alive enemies\n    const aliveEnemies = Array.from(this.aiEnemies.values()).filter(\n      enemy => !enemy.isDead && enemy.health > 0\n    );\n\n    // If only 1 player is alive and no enemies, set timer to 5 seconds\n    if (alivePlayers.length === 1 && aliveEnemies.length === 0 && this.waveSystem.currentWave > 0) {\n      const now = Date.now();\n      const currentNextWaveTime = this.waveSystem.getTimeToNextWave();\n\n      // Only adjust if we're not already using 5s interval\n      if (currentNextWaveTime > 5500) {\n        this.waveSystem.setNextWaveTime(now + 5000);\n        console.log(\n          `[GameEngine] Only 1 player alive, setting next wave timer to 5 seconds (was ${Math.ceil(currentNextWaveTime / 1000)}s)`\n        );\n      }\n    }\n  }\n\n  handleBananaEvent(_player: Character): void {\n    // Banana event is handled in the command handler\n    // This is just for additional effects if needed\n  }\n\n  handleChaosMode(duration: number): void {\n    const oldChance = this.settings.autoAttackChance;\n    this.settings.autoAttackChance = 0.8;\n\n    setTimeout(() => {\n      this.settings.autoAttackChance = oldChance;\n    }, duration);\n  }\n\n  handleWaveComplete(waveNumber: number): void {\n    // Respawn all dead players and heal living ones\n    this.players.forEach(player => {\n      if (player.isDead || player.health <= 0) {\n        player.respawn();\n        this.renderSystem.updatePlayerTitle(player);\n      } else {\n        player.health = player.maxHealth;\n        // Emit health update event\n        this.eventSystem.emit('healthUpdate', {\n          pawn: player,\n          player: player, // Backwards compatibility\n          health: player.health,\n          maxHealth: player.maxHealth\n        });\n      }\n\n      // Reset heals for all players\n      player.healsUsed = 0;\n      this.renderSystem.updatePlayerTitle(player);\n    });\n\n    // Remove only defeated AI enemies between waves (cleanup)\n    this.aiEnemies.forEach(enemy => {\n      if (enemy.isDead || enemy.health <= 0) {\n        this.renderSystem.removePlayer(enemy.id);\n        this.aiEnemies.delete(enemy.id);\n      } else {\n        // Heal living enemies between waves\n        enemy.health = enemy.maxHealth;\n      }\n    });\n\n    // Don't spawn enemies in the first wave - give players time to join\n    if (waveNumber === 1) {\n      this.eventSystem.emit('actionFeed', {\n        message: `üåä Wave ${waveNumber} gestartet! Schreibt im Chat um beizutreten! Gegner erscheinen ab Wave 2.`,\n        type: 'wave'\n      });\n    } else {\n      // Spawn AI enemies from wave 2 onwards, only fill up to target count\n      const playerCount = this.players.size;\n      const targetEnemyCount = Math.min(playerCount + (waveNumber - 1), playerCount + 10);\n      const currentEnemyCount = this.aiEnemies.size;\n      const enemiesToSpawn = Math.max(0, targetEnemyCount - currentEnemyCount);\n\n      if (enemiesToSpawn > 0) {\n        this.spawnAIEnemies(enemiesToSpawn, waveNumber);\n      }\n\n      this.eventSystem.emit('actionFeed', {\n        message: `üåä Wave ${waveNumber} gestartet! Alle Spieler vollst√§ndig geheilt und Heilungen zur√ºckgesetzt!`,\n        type: 'wave'\n      });\n    }\n\n    this.uiSystem.addScreenShake();\n  }\n\n  handleAutoAttackResults(_results: unknown): void {\n    // Auto-attack results are handled in the command handler\n    // This is just for additional processing if needed\n  }\n\n  spawnAIEnemies(count: number, waveNumber: number): void {\n    for (let i = 0; i < count; i++) {\n      const enemy = AIEnemy.createRandom(waveNumber, this.settings);\n      enemy.setEventSystem(this.eventSystem);\n      this.aiEnemies.set(enemy.id, enemy);\n      this.renderSystem.spawnAIEnemy(enemy);\n\n      // Connect AutoCombat component to GameEngine\n      const autoCombat = enemy.getComponent<AutoCombat>('AutoCombat');\n      if (autoCombat) {\n        autoCombat.setGameEngine(this);\n      }\n\n      setTimeout(() => {\n        this.eventSystem.emit('actionFeed', {\n          message: `üëπ ${enemy.displayName} erscheint auf dem Schlachtfeld!`,\n          type: 'enemy-spawn'\n        });\n      }, i * 500);\n    }\n  }\n\n  removeAIEnemy(enemyId: string): void {\n    const enemy = this.aiEnemies.get(enemyId);\n    if (enemy) {\n      this.renderSystem.removePlayer(enemyId);\n      this.aiEnemies.delete(enemyId);\n      this.updateActiveViewers();\n    }\n  }\n\n  addEmojiPawn(emojiPawn: EmojiPawn): void {\n    emojiPawn.setEventSystem(this.eventSystem);\n    this.emojiPawns.set(emojiPawn.id, emojiPawn);\n    this.renderSystem.spawnEmojiPawn(emojiPawn);\n  }\n\n  removeEmojiPawn(emojiPawnId: string): void {\n    const emojiPawn = this.emojiPawns.get(emojiPawnId);\n    if (emojiPawn) {\n      // Remove pawn from render system and game engine\n      // This is called when the pawn requests its own removal via event\n      this.renderSystem.removePlayer(emojiPawnId);\n      this.emojiPawns.delete(emojiPawnId);\n    }\n  }\n\n  checkGameOverCondition(): void {\n    if (!this.isRunning || this.isGameOver) return;\n\n    const alivePlayers = Array.from(this.players.values()).filter(p => p.health > 0);\n    const aliveAI = Array.from(this.aiEnemies.values()).filter(e => e.health > 0);\n    const currentWave = this.waveSystem.getCurrentWave();\n\n    // Don't trigger game over in wave 1 since no enemies spawn\n    if (currentWave === 1) return;\n\n    if (alivePlayers.length === 0 && aliveAI.length > 0) {\n      this.triggerGameOver();\n    }\n  }\n\n  triggerGameOver(): void {\n    this.isGameOver = true;\n\n    // Stop systems\n    this.waveSystem.stop();\n    this.combatSystem.stopAutoAttackSystem();\n\n    // Get top players\n    const topPlayers = Array.from(this.players.values())\n      .sort((a, b) => b.score - a.score)\n      .slice(0, 3);\n\n    this.uiSystem.showGameOverBanner(topPlayers);\n\n    // Store top players for next round\n    this.survivingPlayers = topPlayers;\n\n    // Restart after 10 seconds\n    this.gameOverTimer = setTimeout(() => {\n      this.restartGame();\n    }, 10000);\n\n    this.eventSystem.emit('actionFeed', {\n      message: 'üíÄ GAME OVER! Alle Spieler sind besiegt! Neues Spiel startet in 10 Sekunden...',\n      type: 'game-over'\n    });\n  }\n\n  restartGame(): void {\n    // Store surviving players before stopGame clears them\n    const survivingPlayers = this.survivingPlayers || [];\n\n    this.stopGame();\n\n    // Reset settings\n    this.settings.baseDamage = 10;\n    this.settings.baseHealth = 100;\n\n    // Reset stats (but keep top players' scores)\n    this.gameStats = {\n      totalDamage: 0,\n      totalHeals: 0,\n      totalAttacks: 0,\n      startTime: null,\n      uptime: 0\n    };\n\n    // Restart\n    this.startGame();\n\n    // Add surviving top players back to the game\n    if (survivingPlayers.length > 0) {\n      survivingPlayers.forEach(player => {\n        // Recreate player from scratch like a fresh join\n        const messageData: MessageData = {\n          displayName: player.displayName,\n          username: player.displayName,\n          color: player.color,\n          message: '',\n          badges: [],\n          isMod: false,\n          isSubscriber: false,\n          isVip: false,\n          timestamp: new Date()\n        };\n\n        const newPlayer = new Player(player.id, messageData, this.settings);\n        newPlayer.setEventSystem(this.eventSystem);\n        this.players.set(player.id, newPlayer);\n        this.renderSystem.spawnPlayer(newPlayer);\n\n        // Connect AutoCombat component to GameEngine\n        const autoCombat = newPlayer.getComponent<AutoCombat>('AutoCombat');\n        if (autoCombat) {\n          autoCombat.setGameEngine(this);\n        }\n\n        this.eventSystem.emit('actionFeed', {\n          message: `‚öîÔ∏è ${newPlayer.displayName} ist dem Kampf beigetreten! (${newPlayer.playerClass})`,\n          type: 'join'\n        });\n      });\n\n      this.updateActiveViewers();\n      this.updateLeaderboard();\n    } else {\n      this.eventSystem.emit('actionFeed', {\n        message: 'üéÆ Neues Spiel gestartet! Schreibt im Chat um beizutreten!',\n        type: 'system'\n      });\n    }\n\n    // Clear surviving players for next game over\n    this.survivingPlayers = [];\n  }\n\n  updateActiveViewers(): void {\n    this.uiSystem.updateActiveViewers(this.players.size, this.aiEnemies.size);\n  }\n\n  updateLeaderboard(): void {\n    this.uiSystem.updateLeaderboard(this.players);\n  }\n\n  // Get game statistics\n  getGameStats(): GameStats & {\n    activePlayers: number;\n    currentWave: number;\n    topPlayer: Character | null;\n  } {\n    return {\n      ...this.gameStats,\n      activePlayers: this.players.size,\n      currentWave: this.waveSystem.getCurrentWave(),\n      topPlayer: this.getTopPlayer()\n    };\n  }\n\n  getTopPlayer(): Character | null {\n    if (this.players.size === 0) return null;\n\n    return Array.from(this.players.values()).reduce((top, player) =>\n      player.score > top.score ? player : top\n    );\n  }\n}\n\nexport { GameEngine };\n","import type { ParticleOptions } from './types.js';\n\n/**\n * Particle class - represents a single particle in the particle system\n */\nexport class Particle {\n  x: number;\n  y: number;\n  velocity: { x: number; y: number };\n  color: string;\n  size: number;\n  life: number;\n  maxLife: number;\n  gravity: number;\n  friction: number;\n  element: HTMLElement;\n\n  constructor(x: number, y: number, options: ParticleOptions = {}) {\n    this.x = x;\n    this.y = y;\n    this.velocity = options.velocity || { x: 0, y: 0 };\n    this.color = options.color || '#ffffff';\n    this.size = options.size || 2;\n    this.life = options.life || 60;\n    this.maxLife = this.life;\n    this.gravity = options.gravity || 0.1;\n    this.friction = options.friction || 0.98;\n\n    this.createElement();\n  }\n\n  createElement(): void {\n    this.element = document.createElement('div');\n    this.element.className = 'particle';\n    this.element.style.position = 'fixed';\n    this.element.style.left = this.x + 'px';\n    this.element.style.top = this.y + 'px';\n    this.element.style.width = this.size + 'px';\n    this.element.style.height = this.size + 'px';\n    this.element.style.background = this.color;\n    this.element.style.borderRadius = '50%';\n    this.element.style.pointerEvents = 'none';\n    this.element.style.zIndex = '1000';\n  }\n\n  update(): void {\n    this.life--;\n\n    if (this.life <= 0) {\n      this.element.remove();\n      return;\n    }\n\n    this.velocity.y += this.gravity;\n    this.velocity.x *= this.friction;\n    this.velocity.y *= this.friction;\n\n    this.x += this.velocity.x;\n    this.y += this.velocity.y;\n\n    this.element.style.left = this.x + 'px';\n    this.element.style.top = this.y + 'px';\n\n    const opacity = this.life / this.maxLife;\n    this.element.style.opacity = opacity.toString();\n  }\n}\n","import { Particle } from './Particle.js';\nimport type { ParticleOptions } from './types.js';\n\n/**\n * ParticleSystem class - manages all particles and their rendering\n */\nexport class ParticleSystem {\n  particles: Particle[];\n  maxParticles: number;\n  container: HTMLElement | null;\n\n  constructor() {\n    this.particles = [];\n    this.maxParticles = 200;\n    this.container = null;\n  }\n\n  initialize(): void {\n    this.container = document.getElementById('particles');\n    if (!this.container) {\n      this.container = document.createElement('div');\n      this.container.id = 'particles';\n      this.container.className = 'particles';\n      document.body.appendChild(this.container);\n    }\n  }\n\n  update(): void {\n    this.particles = this.particles.filter(particle => {\n      particle.update();\n      return particle.life > 0;\n    });\n  }\n\n  createParticle(x: number, y: number, options: ParticleOptions = {}): Particle {\n    if (this.particles.length >= this.maxParticles) {\n      this.particles.shift();\n    }\n\n    const particle = new Particle(x, y, options);\n    this.particles.push(particle);\n    if (this.container) {\n      this.container.appendChild(particle.element);\n    }\n\n    return particle;\n  }\n\n  createImpactParticles(element: HTMLElement): void {\n    const rect = element.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n\n    for (let i = 0; i < 8; i++) {\n      const angle = (i / 8) * Math.PI * 2;\n      const velocity = {\n        x: Math.cos(angle) * 3,\n        y: Math.sin(angle) * 3\n      };\n\n      this.createParticle(centerX, centerY, {\n        velocity: velocity,\n        color: '#ff6b6b',\n        size: 3,\n        life: 30\n      });\n    }\n  }\n\n  createHealingParticles(element: HTMLElement): void {\n    const rect = element.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n\n    for (let i = 0; i < 12; i++) {\n      const angle = Math.random() * Math.PI * 2;\n      const velocity = {\n        x: Math.cos(angle) * 2,\n        y: Math.sin(angle) * 2 - 1\n      };\n\n      this.createParticle(centerX, centerY, {\n        velocity: velocity,\n        color: '#4ecdc4',\n        size: 2,\n        life: 60\n      });\n    }\n  }\n\n  createDefenseParticles(element: HTMLElement): void {\n    const rect = element.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n\n    for (let i = 0; i < 16; i++) {\n      const angle = (i / 16) * Math.PI * 2;\n      const radius = 30;\n      const x = centerX + Math.cos(angle) * radius;\n      const y = centerY + Math.sin(angle) * radius;\n\n      this.createParticle(x, y, {\n        velocity: { x: 0, y: -0.5 },\n        color: '#45b7d1',\n        size: 1,\n        life: 120\n      });\n    }\n  }\n\n  createPowerParticles(element: HTMLElement): void {\n    const rect = element.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n\n    for (let i = 0; i < 10; i++) {\n      const velocity = {\n        x: (Math.random() - 0.5) * 4,\n        y: (Math.random() - 0.5) * 4\n      };\n\n      this.createParticle(centerX, centerY, {\n        velocity: velocity,\n        color: '#ff6b6b',\n        size: 4,\n        life: 40\n      });\n    }\n  }\n\n  createExplosionParticles(position: { x: number; y: number }): void {\n    for (let i = 0; i < 20; i++) {\n      const angle = Math.random() * Math.PI * 2;\n      const speed = Math.random() * 8 + 2;\n      const velocity = {\n        x: Math.cos(angle) * speed,\n        y: Math.sin(angle) * speed\n      };\n\n      this.createParticle(position.x, position.y, {\n        velocity: velocity,\n        color: ['#ff6b6b', '#ff4757', '#ffa502'][Math.floor(Math.random() * 3)],\n        size: Math.random() * 4 + 2,\n        life: Math.random() * 60 + 30\n      });\n    }\n  }\n\n  createSpawnParticles(element: HTMLElement): void {\n    const rect = element.getBoundingClientRect();\n    const centerX = rect.left + rect.width / 2;\n    const centerY = rect.top + rect.height / 2;\n\n    for (let i = 0; i < 15; i++) {\n      const velocity = {\n        x: (Math.random() - 0.5) * 3,\n        y: (Math.random() - 0.5) * 3 - 1\n      };\n\n      this.createParticle(centerX, centerY, {\n        velocity: velocity,\n        color: '#96ceb4',\n        size: 3,\n        life: 90\n      });\n    }\n  }\n}\n","import type { Sounds } from './types.js';\n\n/**\n * SoundSystem class - manages sound effects using Web Audio API\n */\nexport class SoundSystem {\n  sounds: Sounds;\n  volume: number;\n  enabled: boolean;\n  audioContext: AudioContext | null;\n\n  constructor() {\n    this.sounds = {} as Sounds;\n    this.volume = 0.3;\n    this.enabled = true;\n    this.audioContext = null;\n  }\n\n  initialize(): void {\n    // Create audio context\n    try {\n      this.audioContext = new (window.AudioContext ||\n        (window as unknown as { webkitAudioContext: typeof AudioContext }).webkitAudioContext)();\n      this.createSounds();\n    } catch (error) {\n      console.warn('Audio not supported:', error);\n      this.enabled = false;\n    }\n  }\n\n  createSounds(): void {\n    // Create simple synthetic sounds\n    this.sounds = {\n      attack: this.createAttackSound(),\n      heal: this.createHealSound(),\n      defend: this.createDefendSound(),\n      power: this.createPowerSound(),\n      explosion: this.createExplosionSound(),\n      spawn: this.createSpawnSound()\n    };\n  }\n\n  createAttackSound(): () => void {\n    return () => {\n      if (!this.enabled || !this.audioContext) return;\n\n      const oscillator = this.audioContext.createOscillator();\n      const gainNode = this.audioContext.createGain();\n\n      oscillator.connect(gainNode);\n      gainNode.connect(this.audioContext.destination);\n\n      oscillator.frequency.setValueAtTime(800, this.audioContext.currentTime);\n      oscillator.frequency.exponentialRampToValueAtTime(200, this.audioContext.currentTime + 0.1);\n\n      gainNode.gain.setValueAtTime(this.volume, this.audioContext.currentTime);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.1);\n\n      oscillator.start();\n      oscillator.stop(this.audioContext.currentTime + 0.1);\n    };\n  }\n\n  createHealSound(): () => void {\n    return () => {\n      if (!this.enabled || !this.audioContext) return;\n\n      const oscillator = this.audioContext.createOscillator();\n      const gainNode = this.audioContext.createGain();\n\n      oscillator.connect(gainNode);\n      gainNode.connect(this.audioContext.destination);\n\n      oscillator.frequency.setValueAtTime(400, this.audioContext.currentTime);\n      oscillator.frequency.exponentialRampToValueAtTime(800, this.audioContext.currentTime + 0.3);\n\n      gainNode.gain.setValueAtTime(this.volume * 0.5, this.audioContext.currentTime);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.3);\n\n      oscillator.start();\n      oscillator.stop(this.audioContext.currentTime + 0.3);\n    };\n  }\n\n  createDefendSound(): () => void {\n    return () => {\n      if (!this.enabled || !this.audioContext) return;\n\n      const oscillator = this.audioContext.createOscillator();\n      const gainNode = this.audioContext.createGain();\n\n      oscillator.connect(gainNode);\n      gainNode.connect(this.audioContext.destination);\n\n      oscillator.frequency.setValueAtTime(300, this.audioContext.currentTime);\n      oscillator.type = 'square';\n\n      gainNode.gain.setValueAtTime(this.volume * 0.3, this.audioContext.currentTime);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.2);\n\n      oscillator.start();\n      oscillator.stop(this.audioContext.currentTime + 0.2);\n    };\n  }\n\n  createPowerSound(): () => void {\n    return () => {\n      if (!this.enabled || !this.audioContext) return;\n\n      const oscillator = this.audioContext.createOscillator();\n      const gainNode = this.audioContext.createGain();\n\n      oscillator.connect(gainNode);\n      gainNode.connect(this.audioContext.destination);\n\n      oscillator.frequency.setValueAtTime(600, this.audioContext.currentTime);\n      oscillator.frequency.exponentialRampToValueAtTime(1200, this.audioContext.currentTime + 0.15);\n\n      gainNode.gain.setValueAtTime(this.volume * 0.7, this.audioContext.currentTime);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.15);\n\n      oscillator.start();\n      oscillator.stop(this.audioContext.currentTime + 0.15);\n    };\n  }\n\n  createExplosionSound(): () => void {\n    return () => {\n      if (!this.enabled || !this.audioContext) return;\n\n      const oscillator = this.audioContext.createOscillator();\n      const gainNode = this.audioContext.createGain();\n\n      oscillator.connect(gainNode);\n      gainNode.connect(this.audioContext.destination);\n\n      oscillator.frequency.setValueAtTime(150, this.audioContext.currentTime);\n      oscillator.frequency.exponentialRampToValueAtTime(50, this.audioContext.currentTime + 0.5);\n      oscillator.type = 'sawtooth';\n\n      gainNode.gain.setValueAtTime(this.volume, this.audioContext.currentTime);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.5);\n\n      oscillator.start();\n      oscillator.stop(this.audioContext.currentTime + 0.5);\n    };\n  }\n\n  createSpawnSound(): () => void {\n    return () => {\n      if (!this.enabled || !this.audioContext) return;\n\n      const oscillator = this.audioContext.createOscillator();\n      const gainNode = this.audioContext.createGain();\n\n      oscillator.connect(gainNode);\n      gainNode.connect(this.audioContext.destination);\n\n      oscillator.frequency.setValueAtTime(200, this.audioContext.currentTime);\n      oscillator.frequency.exponentialRampToValueAtTime(600, this.audioContext.currentTime + 0.4);\n\n      gainNode.gain.setValueAtTime(this.volume * 0.4, this.audioContext.currentTime);\n      gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + 0.4);\n\n      oscillator.start();\n      oscillator.stop(this.audioContext.currentTime + 0.4);\n    };\n  }\n\n  playSound(soundName: keyof Sounds): void {\n    if (this.sounds[soundName] && this.audioContext) {\n      this.sounds[soundName]();\n    }\n  }\n\n  setVolume(volume: number): void {\n    this.volume = Math.max(0, Math.min(1, volume));\n  }\n\n  setEnabled(enabled: boolean): void {\n    this.enabled = enabled;\n  }\n}\n","import { ParticleSystem } from './ParticleSystem.js';\nimport { SoundSystem } from './SoundSystem.js';\nimport type { Animation, PlayerLike } from './types.js';\n\n/**\n * EffectsManager class - main manager for all visual and audio effects\n */\nexport class EffectsManager {\n  particleSystem: ParticleSystem;\n  soundSystem: SoundSystem;\n  animationQueue: Animation[];\n  isProcessing: boolean;\n\n  constructor() {\n    this.particleSystem = new ParticleSystem();\n    this.soundSystem = new SoundSystem();\n    this.animationQueue = [];\n    this.isProcessing = false;\n\n    this.initializeEffects();\n  }\n\n  initializeEffects(): void {\n    // Initialize particle system\n    this.particleSystem.initialize();\n\n    // Initialize sound system\n    this.soundSystem.initialize();\n\n    // Start animation loop\n    this.startAnimationLoop();\n  }\n\n  startAnimationLoop(): void {\n    const animate = () => {\n      this.processAnimationQueue();\n      this.particleSystem.update();\n      requestAnimationFrame(animate);\n    };\n    animate();\n  }\n\n  processAnimationQueue(): void {\n    // Verarbeite alle verf√ºgbaren Animationen, nicht nur eine\n    while (this.animationQueue.length > 0) {\n      const animation = this.animationQueue.shift();\n      // Execute animation with error handling\n      this.executeAnimation(animation).catch(error => {\n        console.error(\n          `[EffectsManager] Error executing animation type '${animation.type}':`,\n          error\n        );\n      });\n    }\n  }\n\n  async executeAnimation(animation: Animation): Promise<void> {\n    switch (animation.type) {\n      case 'attack':\n        await this.playAttackEffect(animation);\n        break;\n      case 'heal':\n        await this.playHealEffect(animation);\n        break;\n      case 'defend':\n        await this.playDefendEffect(animation);\n        break;\n      case 'power':\n        await this.playPowerEffect(animation);\n        break;\n      case 'explosion':\n        await this.playExplosionEffect(animation);\n        break;\n      case 'spawn':\n        await this.playSpawnEffect(animation);\n        break;\n      case 'shockwave':\n        await this.playShockwaveEffect(animation);\n        break;\n    }\n  }\n\n  // Public methods to trigger effects\n  triggerAttackEffect(\n    attacker: PlayerLike,\n    target: PlayerLike,\n    isPowerAttack = false,\n    isCounterAttack = false\n  ): void {\n    console.log(\n      `[EffectsManager] Triggering attack effect: ${attacker.displayName} -> ${target.displayName} (powered: ${isPowerAttack}, counter: ${isCounterAttack})`\n    );\n\n    this.animationQueue.push({\n      type: 'attack',\n      attacker: attacker,\n      target: target,\n      isPowerAttack: isPowerAttack,\n      isCounterAttack: isCounterAttack,\n      timestamp: Date.now()\n    });\n\n    this.soundSystem.playSound('attack');\n  }\n\n  triggerHealEffect(player: PlayerLike): void {\n    this.animationQueue.push({\n      type: 'heal',\n      player: player,\n      timestamp: Date.now()\n    });\n\n    this.soundSystem.playSound('heal');\n  }\n\n  triggerDefendEffect(player: PlayerLike, duration = 5000): void {\n    console.log(\n      `[EffectsManager] Triggering defend effect for ${player.displayName} (element: ${player.element ? 'exists' : 'null'})`\n    );\n\n    this.animationQueue.push({\n      type: 'defend',\n      player: player,\n      duration: duration,\n      timestamp: Date.now()\n    });\n\n    this.soundSystem.playSound('defend');\n  }\n\n  triggerPowerEffect(player: PlayerLike): void {\n    this.animationQueue.push({\n      type: 'power',\n      player: player,\n      timestamp: Date.now()\n    });\n\n    this.soundSystem.playSound('power');\n  }\n\n  triggerExplosionEffect(position: { x: number; y: number }): void {\n    this.animationQueue.push({\n      type: 'explosion',\n      position: position,\n      timestamp: Date.now()\n    });\n\n    this.soundSystem.playSound('explosion');\n  }\n\n  triggerSpawnEffect(player: PlayerLike): void {\n    this.animationQueue.push({\n      type: 'spawn',\n      player: player,\n      timestamp: Date.now()\n    });\n\n    this.soundSystem.playSound('spawn');\n  }\n\n  triggerShockwaveEffect(\n    position: { x: number; y: number },\n    onHit?: (radius: number, hitPosition: { x: number; y: number }) => void\n  ): void {\n    this.animationQueue.push({\n      type: 'shockwave',\n      position: position,\n      timestamp: Date.now()\n    });\n\n    // Store callback for shockwave hit detection\n    if (onHit) {\n      (this as unknown as { shockwaveHitCallback?: typeof onHit }).shockwaveHitCallback = onHit;\n    }\n\n    this.soundSystem.playSound('explosion');\n  }\n\n  // Animation implementations\n  async playAttackEffect(animation: Animation): Promise<void> {\n    const { attacker, target, isPowerAttack = false, isCounterAttack = false } = animation;\n\n    console.log(\n      `[EffectsManager] Playing attack effect: ${attacker.displayName} -> ${target.displayName} (powered: ${isPowerAttack}, counter: ${isCounterAttack})`\n    );\n\n    if (!attacker.element || !target.element) {\n      console.warn(`[EffectsManager] Missing elements for attack effect`);\n      return;\n    }\n\n    // Create attack beam - powered attacks are blue, counter attacks are yellow, normal are red\n    const beam = this.createAttackBeam(\n      attacker.element,\n      target.element,\n      isPowerAttack,\n      isCounterAttack\n    );\n\n    // Animate beam\n    await this.animateBeam(beam, isPowerAttack, isCounterAttack);\n\n    // Create impact particles\n    this.particleSystem.createImpactParticles(target.element);\n\n    // Screen shake\n    this.createScreenShake();\n\n    // Clean up\n    beam.remove();\n\n    console.log(`[EffectsManager] Beam removed`);\n    this.debugActiveBeams();\n  }\n\n  async playHealEffect(animation: Animation): Promise<void> {\n    const { player } = animation;\n\n    if (!player.element) return;\n\n    // Create healing particles\n    this.particleSystem.createHealingParticles(player.element);\n\n    // Healing glow\n    await this.createHealingGlow(player.element);\n  }\n\n  async playDefendEffect(animation: Animation): Promise<void> {\n    const { player, duration = 5000 } = animation;\n\n    if (!player.element) {\n      console.warn(\n        `[EffectsManager] Cannot play defend effect: player.element is null for ${player.displayName}`\n      );\n      return;\n    }\n\n    console.log(\n      `[EffectsManager] Playing defend effect for ${player.displayName} with duration ${duration}ms`\n    );\n\n    // Create shield effect with dynamic duration\n    await this.createShieldEffect(player.element, duration);\n\n    // Defense particles\n    this.particleSystem.createDefenseParticles(player.element);\n  }\n\n  async playPowerEffect(animation: Animation): Promise<void> {\n    const { player } = animation;\n\n    if (!player.element) return;\n\n    // Create power charge effect\n    await this.createPowerChargeEffect(player.element);\n\n    // Power particles\n    this.particleSystem.createPowerParticles(player.element);\n  }\n\n  async playExplosionEffect(animation: Animation): Promise<void> {\n    const { position } = animation;\n\n    // Create explosion particles\n    this.particleSystem.createExplosionParticles(position);\n\n    // Screen flash\n    this.createScreenFlash();\n\n    // Screen shake\n    this.createScreenShake();\n  }\n\n  async playSpawnEffect(animation: Animation): Promise<void> {\n    const { player } = animation;\n\n    if (!player.element) return;\n\n    // Create spawn particles\n    this.particleSystem.createSpawnParticles(player.element);\n\n    // Spawn glow\n    await this.createSpawnGlow(player.element);\n  }\n\n  async playShockwaveEffect(animation: Animation): Promise<void> {\n    const { position } = animation;\n    if (!position) return;\n\n    // Create initial explosion effect\n    this.particleSystem.createExplosionParticles(position);\n    this.createScreenFlash();\n    this.createScreenShake();\n\n    // Create and animate expanding shockwave ring\n    await this.createShockwaveRing(position);\n  }\n\n  async createShockwaveRing(startPosition: { x: number; y: number }): Promise<void> {\n    const battlefield = document.getElementById('battlefield');\n    if (!battlefield) return;\n\n    const battlefieldRect = battlefield.getBoundingClientRect();\n    const maxRadius = Math.max(battlefieldRect.width, battlefieldRect.height) * 0.8; // 80% of battlefield size\n    const expansionDuration = 3000; // 3 seconds for full expansion\n    const startTime = performance.now();\n    const hitCheckInterval = 50; // Check for hits every 50ms\n    let lastHitCheck = startTime;\n\n    const shockwave = document.createElement('div');\n    shockwave.className = 'shockwave';\n    shockwave.style.position = 'absolute';\n    shockwave.style.left = startPosition.x + 'px';\n    shockwave.style.top = startPosition.y + 'px';\n    shockwave.style.width = '0px';\n    shockwave.style.height = '0px';\n    shockwave.style.borderRadius = '50%';\n    shockwave.style.border = '3px solid rgba(255, 68, 68, 0.8)';\n    shockwave.style.boxShadow =\n      '0 0 20px rgba(255, 68, 68, 0.6), inset 0 0 20px rgba(255, 68, 68, 0.4)';\n    shockwave.style.transform = 'translate(-50%, -50%)';\n    shockwave.style.pointerEvents = 'none';\n    shockwave.style.zIndex = '1000';\n    shockwave.style.transition = 'none';\n    shockwave.style.willChange = 'width, height, box-shadow';\n\n    battlefield.appendChild(shockwave);\n\n    const hitCallback = (\n      this as unknown as {\n        shockwaveHitCallback?: (radius: number, hitPosition: { x: number; y: number }) => void;\n      }\n    ).shockwaveHitCallback;\n\n    const animate = (currentTime: number) => {\n      const elapsed = currentTime - startTime;\n      const progress = Math.min(elapsed / expansionDuration, 1);\n      const currentRadius = progress * maxRadius;\n      const diameter = currentRadius * 2;\n\n      // Smooth animation using requestAnimationFrame\n      shockwave.style.width = diameter + 'px';\n      shockwave.style.height = diameter + 'px';\n      shockwave.style.boxShadow = `0 0 ${currentRadius * 0.3}px rgba(255, 68, 68, 0.8), inset 0 0 ${currentRadius * 0.2}px rgba(255, 68, 68, 0.6)`;\n\n      // Call hit callback periodically (not every frame for performance)\n      if (hitCallback && currentTime - lastHitCheck >= hitCheckInterval) {\n        lastHitCheck = currentTime;\n        hitCallback(currentRadius, {\n          x: startPosition.x,\n          y: startPosition.y\n        });\n      }\n\n      if (progress < 1) {\n        requestAnimationFrame(animate);\n      } else {\n        // Fade out and remove\n        shockwave.style.transition = 'opacity 0.5s ease-out';\n        shockwave.style.opacity = '0';\n        setTimeout(() => {\n          shockwave.remove();\n        }, 500);\n      }\n    };\n\n    requestAnimationFrame(animate);\n  }\n\n  createShockwaveHitEffect(element: HTMLElement): void {\n    // Create a red flash/pulse effect when pawn is hit by shockwave\n    const hitEffect = document.createElement('div');\n    hitEffect.className = 'shockwave-hit-effect';\n    hitEffect.style.position = 'absolute';\n    hitEffect.style.top = '-10px';\n    hitEffect.style.left = '-10px';\n    hitEffect.style.right = '-10px';\n    hitEffect.style.bottom = '-10px';\n    hitEffect.style.background =\n      'radial-gradient(circle, rgba(255, 68, 68, 0.6) 0%, transparent 70%)';\n    hitEffect.style.borderRadius = '50%';\n    hitEffect.style.animation = 'shockwaveHitPulse 0.8s ease-out';\n    hitEffect.style.pointerEvents = 'none';\n    hitEffect.style.zIndex = '100';\n\n    element.appendChild(hitEffect);\n\n    setTimeout(() => {\n      hitEffect.remove();\n    }, 800);\n  }\n\n  // Helper methods\n  createAttackBeam(\n    source: HTMLElement,\n    target: HTMLElement,\n    isPowerAttack = false,\n    isCounterAttack = false\n  ): HTMLElement {\n    console.log(\n      `[EffectsManager] Creating attack beam from ${source.title} to ${target.title} (powered: ${isPowerAttack}, counter: ${isCounterAttack})`\n    );\n\n    const beam = document.createElement('div');\n    beam.className = 'attack-beam';\n    beam.style.position = 'absolute';\n    beam.style.height = isPowerAttack ? '3px' : '2px';\n\n    // Blue for powered attacks, yellow for counter attacks, red for normal\n    if (isPowerAttack) {\n      beam.style.background = 'linear-gradient(90deg, #4a90e2, #1e88e5)';\n      beam.style.borderRadius = '1.5px';\n      beam.style.boxShadow = '0 0 15px #4a90e2';\n    } else if (isCounterAttack) {\n      beam.style.background = 'linear-gradient(90deg, #ffd700, #ffaa00)';\n      beam.style.borderRadius = '1.5px';\n      beam.style.boxShadow = '0 0 15px #ffd700';\n    } else {\n      beam.style.background = 'linear-gradient(90deg, #ff6b6b, #ff4757)';\n      beam.style.borderRadius = '1px';\n      beam.style.boxShadow = '0 0 10px #ff6b6b';\n    }\n    beam.style.zIndex = '1000';\n\n    const sourceRect = source.getBoundingClientRect();\n    const targetRect = target.getBoundingClientRect();\n    const battlefield = document.getElementById('battlefield');\n    if (!battlefield) {\n      throw new Error('Battlefield element not found');\n    }\n    const battlefieldRect = battlefield.getBoundingClientRect();\n\n    const startX = sourceRect.left - battlefieldRect.left + sourceRect.width / 2;\n    const startY = sourceRect.top - battlefieldRect.top + sourceRect.height / 2;\n    const endX = targetRect.left - battlefieldRect.left + targetRect.width / 2;\n    const endY = targetRect.top - battlefieldRect.top + targetRect.height / 2;\n\n    const distance = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));\n    const angle = Math.atan2(endY - startY, endX - startX);\n\n    beam.style.left = startX + 'px';\n    beam.style.top = startY + 'px';\n    beam.style.width = distance + 'px';\n    beam.style.transform = `rotate(${angle}rad)`;\n    beam.style.transformOrigin = '0 50%';\n\n    // Store original width for animation\n    beam.dataset.fullWidth = distance + 'px';\n\n    battlefield.appendChild(beam);\n\n    console.log(\n      `[EffectsManager] Beam created: ${startX},${startY} -> ${endX},${endY} (distance: ${distance}px)`\n    );\n\n    // Debug active beams\n    this.debugActiveBeams();\n\n    return beam;\n  }\n\n  async animateBeam(\n    beam: HTMLElement,\n    isPowerAttack = false,\n    isCounterAttack = false\n  ): Promise<void> {\n    console.log(\n      `[EffectsManager] Animating beam (powered: ${isPowerAttack}, counter: ${isCounterAttack})`\n    );\n\n    // Get original transform for rotation\n    const originalTransform = beam.style.transform;\n\n    // Start with beam scaled to 0 (invisible)\n    beam.style.transform = `${originalTransform} scaleX(0)`;\n    beam.style.transition = 'transform 0.2s ease-out';\n\n    // Expand beam from source to target\n    setTimeout(() => {\n      beam.style.transform = `${originalTransform} scaleX(1)`;\n    }, 10);\n\n    // Create blaster particles along the beam path after it reaches target\n    return new Promise<void>(resolve => {\n      setTimeout(() => {\n        // Only create blaster particles for powered attacks\n        if (isPowerAttack) {\n          this.createBlasterParticles(beam, isPowerAttack, isCounterAttack);\n        }\n\n        // Remove beam with fade only (no scale back)\n        beam.style.transition = 'opacity 0.15s ease-out';\n        beam.style.opacity = '0';\n\n        setTimeout(resolve, 150);\n      }, 200);\n    });\n  }\n\n  async createHealingGlow(element: HTMLElement): Promise<void> {\n    const glow = document.createElement('div');\n    glow.className = 'healing-glow';\n    glow.style.position = 'absolute';\n    glow.style.top = '-10px';\n    glow.style.left = '-10px';\n    glow.style.right = '-10px';\n    glow.style.bottom = '-10px';\n    glow.style.background = 'radial-gradient(circle, rgba(78, 205, 196, 0.6) 0%, transparent 70%)';\n    glow.style.borderRadius = '50%';\n    glow.style.animation = 'healingGlow 1s ease-out';\n    glow.style.pointerEvents = 'none';\n\n    element.appendChild(glow);\n\n    return new Promise<void>(resolve => {\n      setTimeout(() => {\n        glow.remove();\n        resolve();\n      }, 1000);\n    });\n  }\n\n  async createShieldEffect(element: HTMLElement, duration = 5000): Promise<void> {\n    const shield = document.createElement('div');\n    shield.className = 'shield-effect';\n    shield.style.position = 'absolute';\n    shield.style.top = '-15px';\n    shield.style.left = '-15px';\n    shield.style.right = '-15px';\n    shield.style.bottom = '-15px';\n    shield.style.border = '2px solid #45b7d1';\n    shield.style.borderRadius = '50%';\n    shield.style.animation = `shieldPulse ${duration}ms ease-out`;\n    shield.style.pointerEvents = 'none';\n\n    element.appendChild(shield);\n\n    return new Promise<void>(resolve => {\n      setTimeout(() => {\n        shield.remove();\n        resolve();\n      }, duration);\n    });\n  }\n\n  async createPowerChargeEffect(element: HTMLElement): Promise<void> {\n    const charge = document.createElement('div');\n    charge.className = 'power-charge';\n    charge.style.position = 'absolute';\n    charge.style.top = '-20px';\n    charge.style.left = '-20px';\n    charge.style.right = '-20px';\n    charge.style.bottom = '-20px';\n    charge.style.background =\n      'radial-gradient(circle, rgba(255, 107, 107, 0.4) 0%, transparent 70%)';\n    charge.style.borderRadius = '50%';\n    charge.style.animation = 'powerCharge 0.5s ease-out';\n    charge.style.pointerEvents = 'none';\n\n    element.appendChild(charge);\n\n    return new Promise<void>(resolve => {\n      setTimeout(() => {\n        charge.remove();\n        resolve();\n      }, 500);\n    });\n  }\n\n  async createSpawnGlow(element: HTMLElement): Promise<void> {\n    const glow = document.createElement('div');\n    glow.className = 'spawn-glow';\n    glow.style.position = 'absolute';\n    glow.style.top = '-25px';\n    glow.style.left = '-25px';\n    glow.style.right = '-25px';\n    glow.style.bottom = '-25px';\n    glow.style.background = 'radial-gradient(circle, rgba(150, 206, 180, 0.8) 0%, transparent 70%)';\n    glow.style.borderRadius = '50%';\n    glow.style.animation = 'spawnGlow 2s ease-out';\n    glow.style.pointerEvents = 'none';\n\n    element.appendChild(glow);\n\n    return new Promise<void>(resolve => {\n      setTimeout(() => {\n        glow.remove();\n        resolve();\n      }, 2000);\n    });\n  }\n\n  createScreenShake(): void {\n    const gameContainer = document.querySelector('.game-container');\n    if (!gameContainer) return;\n\n    gameContainer.classList.add('screen-shake');\n    setTimeout(() => {\n      gameContainer.classList.remove('screen-shake');\n    }, 500);\n  }\n\n  createScreenFlash(): void {\n    const flash = document.createElement('div');\n    flash.style.position = 'fixed';\n    flash.style.top = '0';\n    flash.style.left = '0';\n    flash.style.width = '100%';\n    flash.style.height = '100%';\n    flash.style.background = 'rgba(255, 255, 255, 0.3)';\n    flash.style.pointerEvents = 'none';\n    flash.style.zIndex = '9999';\n    flash.style.opacity = '0';\n    flash.style.transition = 'opacity 0.1s ease-out';\n\n    document.body.appendChild(flash);\n\n    setTimeout(() => {\n      flash.style.opacity = '1';\n      setTimeout(() => {\n        flash.style.opacity = '0';\n        setTimeout(() => {\n          flash.remove();\n        }, 100);\n      }, 100);\n    }, 10);\n  }\n\n  createBlasterParticles(beam: HTMLElement, isPowerAttack = false, isCounterAttack = false): void {\n    const battlefield = document.getElementById('battlefield');\n    if (!battlefield) return;\n    const battlefieldRect = battlefield.getBoundingClientRect();\n\n    // Get beam start and end positions\n    const beamLeft = parseFloat(beam.style.left);\n    const beamTop = parseFloat(beam.style.top);\n    const beamWidth = parseFloat(beam.style.width);\n    const angleMatch = beam.style.transform.match(/rotate\\(([^)]+)/);\n    const angle = angleMatch ? parseFloat(angleMatch[1]) : 0;\n\n    // Create particles along the beam path\n    const particleCount = 12;\n    for (let i = 0; i < particleCount; i++) {\n      const t = i / particleCount;\n      const x = battlefieldRect.left + beamLeft + Math.cos(angle) * (beamWidth * t);\n      const y = battlefieldRect.top + beamTop + Math.sin(angle) * (beamWidth * t);\n\n      // Small random offset perpendicular to beam\n      const perpAngle = angle + Math.PI / 2;\n      const offset = (Math.random() - 0.5) * 8;\n      const perpX = x + Math.cos(perpAngle) * offset;\n      const perpY = y + Math.sin(perpAngle) * offset;\n\n      // Create particle\n      const particle = document.createElement('div');\n      particle.style.position = 'fixed';\n      particle.style.left = perpX + 'px';\n      particle.style.top = perpY + 'px';\n      particle.style.width = '4px';\n      particle.style.height = '4px';\n\n      // Blue particles for powered attacks, yellow for counter attacks, red for normal\n      if (isPowerAttack) {\n        particle.style.background = `hsl(${Math.random() * 60 + 210}, 90%, ${50 + Math.random() * 30}%)`;\n      } else if (isCounterAttack) {\n        particle.style.background = `hsl(${Math.random() * 60 + 50}, 100%, ${50 + Math.random() * 30}%)`;\n      } else {\n        particle.style.background = `hsl(${Math.random() * 60 + 330}, 100%, ${60 + Math.random() * 20}%)`;\n      }\n\n      particle.style.borderRadius = '50%';\n      particle.style.boxShadow = `0 0 8px ${particle.style.background}`;\n      particle.style.pointerEvents = 'none';\n      particle.style.zIndex = '1001';\n\n      // Random spread velocity\n      const spreadAngle = angle + (Math.random() - 0.5) * 0.5;\n      const speed = 2 + Math.random() * 3;\n      particle.style.transition = 'all 0.3s ease-out';\n\n      document.body.appendChild(particle);\n\n      // Animate particle\n      setTimeout(() => {\n        particle.style.transform = `translate(${Math.cos(spreadAngle) * speed * 30}px, ${Math.sin(spreadAngle) * speed * 30}px) scale(0)`;\n        particle.style.opacity = '0';\n\n        setTimeout(() => {\n          particle.remove();\n        }, 300);\n      }, 10);\n    }\n  }\n\n  debugActiveBeams(): void {\n    const battlefield = document.getElementById('battlefield');\n    if (!battlefield) return;\n    const beams = battlefield.querySelectorAll<HTMLElement>('.attack-beam');\n    console.log(`[EffectsManager] Active beams on battlefield: ${beams.length}`);\n    beams.forEach((beam, index) => {\n      console.log(\n        `[EffectsManager] Beam ${index + 1}: ${beam.style.left}, ${beam.style.top} -> ${beam.style.width}`\n      );\n    });\n  }\n}\n","import type { GameEngine } from '../game/GameEngine.js';\nimport type { MessageData } from '../twitchClient.js';\nimport type { Character } from '../game/entities/Character.js';\n\n/**\n * Debug System - Provides debugging and testing tools for development\n */\nexport class DebugSystem {\n  gameEngine: GameEngine | null;\n  testPlayerCounter: number;\n  isDebugMode: boolean;\n\n  constructor() {\n    this.gameEngine = null;\n    this.testPlayerCounter = 1;\n    this.isDebugMode = false;\n  }\n\n  setGameEngine(gameEngine: GameEngine): void {\n    this.gameEngine = gameEngine;\n  }\n\n  enableDebugMode(): void {\n    this.isDebugMode = true;\n    console.log('[DebugSystem] Debug mode enabled');\n  }\n\n  disableDebugMode(): void {\n    this.isDebugMode = false;\n    console.log('[DebugSystem] Debug mode disabled');\n  }\n\n  /**\n   * Spawn a test player with a unique ID\n   */\n  spawnTestPlayer(playerName?: string, aggressive = false): string {\n    if (!this.gameEngine) {\n      console.error('[DebugSystem] GameEngine not set');\n      return '';\n    }\n\n    const playerId = `test_player_${this.testPlayerCounter++}`;\n    const displayName = playerName || `TestPlayer${this.testPlayerCounter - 1}`;\n\n    const messageData: MessageData = {\n      username: playerId,\n      displayName: displayName,\n      message: '',\n      color: this.generateRandomColor(),\n      badges: [],\n      isMod: false,\n      isSubscriber: false,\n      isVip: false,\n      timestamp: new Date()\n    };\n\n    // Execute join command\n    this.gameEngine.commandHandler.executeCommand('join', playerId, messageData);\n\n    // Make player aggressive if requested\n    if (aggressive) {\n      const player = this.gameEngine.players.get(playerId);\n      if (player) {\n        // Force aggressive personality (70%+)\n        (player as unknown as { personality: number }).personality = 0.75;\n        // Set aggressive class\n        (player as unknown as { playerClass: string }).playerClass = 'Berserker';\n      }\n    }\n\n    console.log(`[DebugSystem] Spawned test player: ${displayName} (${playerId})`);\n    return playerId;\n  }\n\n  /**\n   * Spawn multiple test players at once\n   */\n  spawnMultipleTestPlayers(count: number, aggressiveCount = 0): string[] {\n    const playerIds: string[] = [];\n\n    for (let i = 0; i < count; i++) {\n      const isAggressive = i < aggressiveCount;\n      const playerId = this.spawnTestPlayer(undefined, isAggressive);\n      playerIds.push(playerId);\n    }\n\n    console.log(`[DebugSystem] Spawned ${count} test players (${aggressiveCount} aggressive)`);\n    return playerIds;\n  }\n\n  /**\n   * Execute a command for a test player\n   */\n  executeTestCommand(command: string, playerId: string, targetId?: string): void {\n    if (!this.gameEngine) {\n      console.error('[DebugSystem] GameEngine not set');\n      return;\n    }\n\n    const player = this.gameEngine.players.get(playerId);\n    if (!player) {\n      console.error(`[DebugSystem] Player ${playerId} not found`);\n      return;\n    }\n\n    const messageData: MessageData = {\n      username: playerId,\n      displayName: player.displayName,\n      message: `!${command}`,\n      color: player.color,\n      badges: [],\n      isMod: false,\n      isSubscriber: false,\n      isVip: false,\n      timestamp: new Date()\n    };\n\n    this.gameEngine.commandHandler.executeCommand(\n      command,\n      playerId,\n      messageData,\n      undefined,\n      targetId || null\n    );\n    console.log(`[DebugSystem] Executed command: ${command} for ${player.displayName}`);\n  }\n\n  /**\n   * Kill a test player (for testing death effects)\n   */\n  killPlayer(playerId?: string): void {\n    if (!this.gameEngine) {\n      console.error('[DebugSystem] GameEngine not set');\n      return;\n    }\n\n    let player: Character | null = null;\n\n    if (playerId) {\n      // Kill specific player if ID provided\n      player = this.gameEngine.players.get(playerId) || null;\n    } else {\n      // Kill random alive player if no ID provided\n      const alivePlayers = Array.from(this.gameEngine.players.values()).filter(\n        p => !p.isDead && p.health > 0\n      );\n\n      if (alivePlayers.length === 0) {\n        console.error('[DebugSystem] No alive players found to kill');\n        return;\n      }\n\n      // Pick random alive player\n      player = alivePlayers[Math.floor(Math.random() * alivePlayers.length)];\n    }\n\n    if (!player) {\n      console.error(`[DebugSystem] Player not found`);\n      return;\n    }\n\n    // Find a killer (or use the player itself as killer for self-inflicted death)\n    const killer = player;\n\n    // Kill the player via combat system to trigger all effects\n    const wasKilled = player.takeDamage(player.health);\n\n    if (wasKilled) {\n      // Use combat system's handleKill to trigger explosion and other effects\n      this.gameEngine.combatSystem.handleKill(\n        killer,\n        player,\n        () => this.gameEngine?.combatSystem.getAllPawns() || []\n      );\n\n      // Emit elimination event to trigger GameEngine.handleElimination\n      this.gameEngine.eventSystem.emit('elimination', {\n        victim: player,\n        killer: killer\n      });\n    }\n\n    console.log(`[DebugSystem] Killed player: ${player.displayName}`);\n  }\n\n  /**\n   * Damage a player by amount\n   */\n  damagePlayer(playerId: string, amount: number): void {\n    if (!this.gameEngine) {\n      console.error('[DebugSystem] GameEngine not set');\n      return;\n    }\n\n    const player = this.gameEngine.players.get(playerId);\n    if (!player) {\n      console.error(`[DebugSystem] Player ${playerId} not found`);\n      return;\n    }\n\n    player.takeDamage(amount);\n    console.log(`[DebugSystem] Damaged player ${player.displayName} by ${amount} HP`);\n  }\n\n  /**\n   * Heal a player by amount\n   */\n  healPlayer(playerId: string, amount: number): void {\n    if (!this.gameEngine) {\n      console.error('[DebugSystem] GameEngine not set');\n      return;\n    }\n\n    const player = this.gameEngine.players.get(playerId);\n    if (!player) {\n      console.error(`[DebugSystem] Player ${playerId} not found`);\n      return;\n    }\n\n    player.gainHealth(amount);\n    console.log(`[DebugSystem] Healed player ${player.displayName} by ${amount} HP`);\n  }\n\n  /**\n   * Force next wave\n   */\n  forceNextWave(): void {\n    if (!this.gameEngine) {\n      console.error('[DebugSystem] GameEngine not set');\n      return;\n    }\n\n    this.gameEngine.waveSystem.forceNextWave();\n    console.log('[DebugSystem] Forced next wave');\n  }\n\n  /**\n   * Get all players\n   */\n  getAllPlayers(): Character[] {\n    if (!this.gameEngine) {\n      return [];\n    }\n\n    return Array.from(this.gameEngine.players.values());\n  }\n\n  /**\n   * Get player by ID\n   */\n  getPlayer(playerId: string): Character | null {\n    if (!this.gameEngine) {\n      return null;\n    }\n\n    return this.gameEngine.players.get(playerId) || null;\n  }\n\n  /**\n   * Clear all players\n   */\n  clearAllPlayers(): void {\n    if (!this.gameEngine) {\n      console.error('[DebugSystem] GameEngine not set');\n      return;\n    }\n\n    const count = this.gameEngine.players.size;\n    this.gameEngine.players.clear();\n    this.gameEngine.renderSystem.clearBattlefield();\n    console.log(`[DebugSystem] Cleared ${count} players`);\n  }\n\n  /**\n   * Start the game\n   */\n  startGame(): void {\n    if (!this.gameEngine) {\n      console.error('[DebugSystem] GameEngine not set');\n      return;\n    }\n\n    this.gameEngine.startGame();\n    console.log('[DebugSystem] Game started');\n  }\n\n  /**\n   * Stop the game\n   */\n  stopGame(): void {\n    if (!this.gameEngine) {\n      console.error('[DebugSystem] GameEngine not set');\n      return;\n    }\n\n    this.gameEngine.stopGame();\n    console.log('[DebugSystem] Game stopped');\n  }\n\n  /**\n   * Get game stats\n   */\n  getGameStats(): unknown {\n    if (!this.gameEngine) {\n      return null;\n    }\n\n    return this.gameEngine.getGameStats();\n  }\n\n  generateRandomColor(): string {\n    const colors = [\n      '#ff6b6b',\n      '#4ecdc4',\n      '#45b7d1',\n      '#96ceb4',\n      '#feca57',\n      '#ff9ff3',\n      '#54a0ff',\n      '#5f27cd',\n      '#00d2d3',\n      '#ff9f43',\n      '#a55eea',\n      '#26de81',\n      '#fd79a8',\n      '#fdcb6e',\n      '#e17055'\n    ];\n    return colors[Math.floor(Math.random() * colors.length)];\n  }\n}\n","/**\n * Notification Manager - Handles all notification display logic\n */\nexport class NotificationManager {\n  notifications: HTMLElement[];\n\n  constructor() {\n    this.notifications = [];\n  }\n\n  showNotification(message: string, type: 'info' | 'success' | 'error' = 'info'): void {\n    const notification = document.createElement('div');\n    notification.className = `notification ${type}`;\n    notification.textContent = message;\n\n    // Calculate position based on existing notifications\n    const topOffset = 20 + this.notifications.length * 70; // 70px spacing between notifications\n\n    notification.style.cssText = `\n      position: fixed;\n      top: ${topOffset}px;\n      right: 20px;\n      background: ${type === 'success' ? '#4ecdc4' : type === 'error' ? '#ff6b6b' : '#45b7d1'};\n      color: white;\n      padding: 15px 20px;\n      border-radius: 8px;\n      z-index: 10000;\n      font-family: 'Orbitron', monospace;\n      font-weight: bold;\n      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);\n      animation: slideIn 0.3s ease;\n      max-width: 300px;\n      word-wrap: break-word;\n    `;\n\n    // Add to notifications array\n    this.notifications.push(notification);\n    document.body.appendChild(notification);\n\n    // Remove after 3 seconds\n    setTimeout(() => {\n      notification.style.animation = 'slideOut 0.3s ease';\n      setTimeout(() => {\n        // Remove from array\n        const index = this.notifications.indexOf(notification);\n        if (index > -1) {\n          this.notifications.splice(index, 1);\n        }\n\n        // Remove from DOM\n        if (notification.parentNode) {\n          notification.remove();\n        }\n\n        // Reposition remaining notifications\n        this.repositionNotifications();\n      }, 300);\n    }, 3000);\n  }\n\n  repositionNotifications(): void {\n    this.notifications.forEach((notification, index) => {\n      const newTop = 20 + index * 70;\n      notification.style.top = `${newTop}px`;\n    });\n  }\n\n  showError(message: string): void {\n    this.showNotification(message, 'error');\n    console.error('Game Error:', message);\n  }\n}\n","interface AppSettings {\n  channelName: string;\n  gameMode: string;\n  autoStart: boolean;\n  volume: number;\n}\n\n/**\n * Settings Manager - Handles all settings loading, saving, and version checking\n */\nexport class SettingsManager {\n  private codeVersion: string;\n  defaultSettings: AppSettings;\n\n  constructor() {\n    this.codeVersion = '1.0.0-' + Date.now();\n    this.defaultSettings = {\n      channelName: 'xAkiitoh',\n      gameMode: 'endless',\n      autoStart: true,\n      volume: 0.3\n    };\n  }\n\n  getCodeVersion(): string {\n    return this.codeVersion;\n  }\n\n  loadSettings(): AppSettings {\n    const settings = { ...this.defaultSettings };\n\n    try {\n      const saved = localStorage.getItem('streamAFKGameSettings');\n      if (saved) {\n        Object.assign(settings, JSON.parse(saved));\n      }\n    } catch (error) {\n      console.warn('Failed to load settings:', error);\n    }\n\n    return settings;\n  }\n\n  saveSettings(settings: AppSettings): void {\n    try {\n      localStorage.setItem('streamAFKGameSettings', JSON.stringify(settings));\n    } catch (error) {\n      console.warn('Failed to save settings:', error);\n    }\n  }\n\n  checkCodeVersion(): boolean {\n    try {\n      const savedVersion = localStorage.getItem('streamAFKGameVersion');\n      if (savedVersion !== this.codeVersion) {\n        console.log('Code version changed, clearing localStorage...');\n        this.clearLocalStorage();\n        localStorage.setItem('streamAFKGameVersion', this.codeVersion);\n        return true; // Version changed\n      }\n      return false; // No version change\n    } catch (error) {\n      console.warn('Failed to check code version:', error);\n      return false;\n    }\n  }\n\n  clearLocalStorage(): void {\n    try {\n      // Clear all game-related localStorage items\n      const keysToRemove: string[] = [];\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i);\n        if (key && key.startsWith('streamAFKGame')) {\n          keysToRemove.push(key);\n        }\n      }\n\n      keysToRemove.forEach(key => {\n        localStorage.removeItem(key);\n      });\n\n      console.log('LocalStorage cleared successfully');\n    } catch (error) {\n      console.warn('Failed to clear localStorage:', error);\n    }\n  }\n}\n\nexport type { AppSettings };\n","type EventHandler = (data?: unknown) => void;\ntype EventHandlers = Record<string, EventHandler[]>;\n\nexport interface MessageData {\n  username: string;\n  displayName: string;\n  message: string;\n  color: string;\n  badges: string[];\n  isMod: boolean;\n  isSubscriber: boolean;\n  isVip: boolean;\n  timestamp: Date;\n}\n\nexport interface Command {\n  type: string;\n  user: string;\n  target?: string;\n  message?: string;\n}\n\nclass TwitchClient {\n  channelName: string;\n  socket: WebSocket | null;\n  connected: boolean;\n  reconnectAttempts: number;\n  maxReconnectAttempts: number;\n  reconnectDelay: number;\n  eventHandlers: EventHandlers;\n  messageQueue: unknown[];\n  rateLimitCount: number;\n  rateLimitWindow: number;\n  maxMessagesPerWindow: number;\n\n  constructor(channelName: string) {\n    this.channelName = channelName;\n    this.socket = null;\n    this.connected = false;\n    this.reconnectAttempts = 0;\n    this.maxReconnectAttempts = 5;\n    this.reconnectDelay = 5000;\n    this.eventHandlers = {};\n    this.messageQueue = [];\n    this.rateLimitCount = 0;\n    this.rateLimitWindow = 30000; // 30 seconds\n    this.maxMessagesPerWindow = 20;\n\n    this.initializeConnection();\n  }\n\n  initializeConnection(): void {\n    try {\n      // Use tmi.js alternative - WebSocket connection to Twitch IRC\n      this.connectToTwitch();\n    } catch (error) {\n      console.error('Failed to initialize Twitch connection:', error);\n      this.handleConnectionError();\n    }\n  }\n\n  connectToTwitch(): void {\n    // Create WebSocket connection to Twitch IRC\n    this.socket = new WebSocket('wss://irc-ws.chat.twitch.tv:443');\n\n    this.socket.onopen = () => {\n      console.log('Connected to Twitch IRC');\n      this.authenticate();\n    };\n\n    this.socket.onmessage = event => {\n      this.handleMessage(event.data);\n    };\n\n    this.socket.onclose = () => {\n      console.log('Disconnected from Twitch IRC');\n      this.connected = false;\n      this.updateConnectionStatus(false);\n      this.handleReconnect();\n    };\n\n    this.socket.onerror = error => {\n      console.error('WebSocket error:', error);\n      this.handleConnectionError();\n    };\n  }\n\n  authenticate(): void {\n    // Anonymous connection (read-only)\n    this.socket.send('PASS SCHMOOPIIE');\n    this.socket.send('NICK justinfan12345');\n    this.socket.send(`JOIN #${this.channelName.toLowerCase()}`);\n  }\n\n  handleMessage(rawMessage: string): void {\n    const messages = rawMessage.split('\\r\\n');\n\n    messages.forEach(message => {\n      if (message.trim() === '') return;\n\n      if (message.startsWith('PING')) {\n        this.socket.send('PONG :tmi.twitch.tv');\n        return;\n      }\n\n      if (message.includes('PRIVMSG')) {\n        this.parsePrivmsg(message);\n      } else if (message.includes('JOIN')) {\n        this.connected = true;\n        this.reconnectAttempts = 0;\n        this.updateConnectionStatus(true);\n        this.emit('connected');\n      }\n    });\n  }\n\n  parsePrivmsg(message: string): void {\n    // Parse Twitch IRC PRIVMSG format\n    const match = message.match(/:(.+?)!.+?PRIVMSG #(.+?) :(.+)/);\n    if (!match) return;\n\n    const [, username, , text] = match;\n\n    // Extract user info from tags if available\n    const userInfo = {\n      username: username,\n      displayName: username,\n      color: this.generateUserColor(username),\n      badges: [],\n      isMod: false,\n      isSubscriber: false,\n      isVip: false\n    };\n\n    // Parse tags for additional user info\n    if (message.startsWith('@')) {\n      const tagsMatch = message.match(/^@(.+?) :/);\n      if (tagsMatch) {\n        const tags = this.parseTags(tagsMatch[1]);\n        userInfo.displayName = tags['display-name'] || username;\n        userInfo.color = tags.color || this.generateUserColor(username);\n        userInfo.badges = tags.badges ? tags.badges.split(',').map(b => b.split('/')[0]) : [];\n        userInfo.isMod = tags.mod === '1';\n        userInfo.isSubscriber = tags.subscriber === '1';\n        userInfo.isVip = tags.vip === '1';\n      }\n    }\n\n    const messageData = {\n      username: userInfo.username,\n      displayName: userInfo.displayName,\n      message: text,\n      color: userInfo.color,\n      badges: userInfo.badges,\n      isMod: userInfo.isMod,\n      isSubscriber: userInfo.isSubscriber,\n      isVip: userInfo.isVip,\n      timestamp: new Date()\n    };\n\n    // Rate limiting\n    if (this.isRateLimited()) {\n      return;\n    }\n\n    this.rateLimitCount++;\n    setTimeout(() => this.rateLimitCount--, this.rateLimitWindow);\n\n    this.emit('message', messageData);\n  }\n\n  parseTags(tagString: string): Record<string, string> {\n    const tags: Record<string, string> = {};\n    tagString.split(';').forEach(tag => {\n      const [key, value] = tag.split('=');\n      tags[key] = value;\n    });\n    return tags;\n  }\n\n  generateUserColor(username: string): string {\n    const colors = [\n      '#FF6B6B',\n      '#4ECDC4',\n      '#45B7D1',\n      '#96CEB4',\n      '#FFEAA7',\n      '#DDA0DD',\n      '#98D8C8',\n      '#F7DC6F',\n      '#BB8FCE',\n      '#85C1E9'\n    ];\n    let hash = 0;\n    for (let i = 0; i < username.length; i++) {\n      hash = username.charCodeAt(i) + ((hash << 5) - hash);\n    }\n    return colors[Math.abs(hash) % colors.length];\n  }\n\n  isRateLimited(): boolean {\n    return this.rateLimitCount >= this.maxMessagesPerWindow;\n  }\n\n  handleConnectionError(): void {\n    this.connected = false;\n    this.updateConnectionStatus(false);\n    this.handleReconnect();\n  }\n\n  handleReconnect(): void {\n    if (this.reconnectAttempts >= this.maxReconnectAttempts) {\n      console.error('Max reconnection attempts reached');\n      this.emit('connectionFailed');\n      return;\n    }\n\n    this.reconnectAttempts++;\n    console.log(\n      `Reconnecting in ${this.reconnectDelay / 1000} seconds... (Attempt ${this.reconnectAttempts})`\n    );\n\n    setTimeout(() => {\n      this.connectToTwitch();\n    }, this.reconnectDelay);\n  }\n\n  updateConnectionStatus(connected: boolean): void {\n    const statusElement = document.getElementById('connectionStatus');\n    const statusDot = statusElement.querySelector('.status-dot');\n    const statusText = statusElement.querySelector('span:last-child');\n\n    if (connected) {\n      statusDot.classList.add('connected');\n      statusText.textContent = `Verbunden mit ${this.channelName}`;\n    } else {\n      statusDot.classList.remove('connected');\n      statusText.textContent =\n        this.reconnectAttempts > 0\n          ? `Verbindung getrennt (${this.reconnectAttempts}/${this.maxReconnectAttempts})`\n          : 'Verbinde...';\n    }\n  }\n\n  // Event system\n  on(event: string, callback: EventHandler): void {\n    if (!this.eventHandlers[event]) {\n      this.eventHandlers[event] = [];\n    }\n    this.eventHandlers[event].push(callback);\n  }\n\n  emit(event: string, data?: unknown): void {\n    if (this.eventHandlers[event]) {\n      this.eventHandlers[event].forEach(callback => {\n        try {\n          callback(data);\n        } catch (error) {\n          console.error(`Error in event handler for ${event}:`, error);\n        }\n      });\n    }\n  }\n\n  // Game command parsing\n  parseCommand(message: MessageData): Command | null {\n    const text = message.message.trim();\n    const words = text.split(' ');\n    const command = words[0].toLowerCase();\n\n    // Spezifische Befehle (optional)\n    switch (command) {\n      case '!defend':\n        return { type: 'defend', user: message.username };\n\n      case '!power':\n        return { type: 'power', user: message.username };\n\n      case '!heal':\n        return { type: 'heal', user: message.username };\n\n      case '!stats':\n        return { type: 'stats', user: message.username };\n\n      case '!help':\n        return { type: 'help', user: message.username };\n\n      case '!banana':\n        return { type: 'banana', user: message.username };\n\n      default:\n        // JEDE Nachricht z√§hlt als Aktivit√§t und bringt den Spieler ins Spiel\n        if (text.length > 0) {\n          return { type: 'activity', user: message.username, message: message.message };\n        }\n        return null;\n    }\n  }\n\n  // Disconnect\n  disconnect(): void {\n    if (this.socket) {\n      this.socket.close();\n      this.socket = null;\n    }\n    this.connected = false;\n    this.updateConnectionStatus(false);\n  }\n\n  // Reconnect manually\n  reconnect(): void {\n    this.disconnect();\n    this.reconnectAttempts = 0;\n    setTimeout(() => {\n      this.initializeConnection();\n    }, 1000);\n  }\n\n  // Get connection status\n  isConnected(): boolean {\n    return this.connected;\n  }\n\n  // Change channel\n  changeChannel(newChannel: string): void {\n    this.channelName = newChannel;\n    this.reconnect();\n  }\n}\n\nexport { TwitchClient };\n","import { TwitchClient } from '../twitchClient.js';\nimport type { AppSettings } from '../utils/SettingsManager.js';\nimport type { GameEngine } from '../game/GameEngine.js';\nimport type { MessageData } from '../twitchClient.js';\n\n/**\n * Twitch Integration - Handles all Twitch client setup and message handling\n */\nexport class TwitchIntegration {\n  twitchClient: TwitchClient | null;\n  channelName: string;\n  onConnectedCallback?: () => void;\n  onMessageCallback?: (messageData: MessageData) => void;\n  onConnectionFailedCallback?: () => void;\n\n  constructor(settings: AppSettings) {\n    this.twitchClient = null;\n    this.channelName = settings.channelName;\n  }\n\n  initialize(\n    onConnected?: () => void,\n    onMessage?: (messageData: MessageData) => void,\n    onConnectionFailed?: () => void\n  ): void {\n    this.onConnectedCallback = onConnected;\n    this.onMessageCallback = onMessage;\n    this.onConnectionFailedCallback = onConnectionFailed;\n\n    this.twitchClient = new TwitchClient(this.channelName);\n\n    // Setup Twitch event handlers\n    this.twitchClient.on('connected', () => {\n      console.log('Connected to Twitch chat');\n      if (this.onConnectedCallback) {\n        this.onConnectedCallback();\n      }\n    });\n\n    this.twitchClient.on('message', (messageData: MessageData) => {\n      if (this.onMessageCallback) {\n        this.onMessageCallback(messageData);\n      }\n    });\n\n    this.twitchClient.on('connectionFailed', () => {\n      console.error('Failed to connect to Twitch');\n      if (this.onConnectionFailedCallback) {\n        this.onConnectionFailedCallback();\n      }\n    });\n  }\n\n  handleMessage(messageData: MessageData, gameEngine: GameEngine): void {\n    try {\n      // Debug: Log the messageData to see what we're getting\n      console.log('Received messageData:', messageData);\n\n      // Parse command from message\n      const command = this.twitchClient?.parseCommand(messageData);\n      console.log('Parsed command:', command);\n\n      if (command && gameEngine) {\n        // Process game command (includes effect triggering via CombatSystem)\n        gameEngine.processCommand(command, messageData);\n      }\n    } catch (error) {\n      console.error('Error processing Twitch message:', error);\n    }\n  }\n\n  changeChannel(channelName: string): void {\n    this.channelName = channelName;\n    if (this.twitchClient) {\n      this.twitchClient.changeChannel(channelName);\n    }\n  }\n\n  disconnect(): void {\n    if (this.twitchClient) {\n      this.twitchClient.disconnect();\n    }\n  }\n\n  isConnected(): boolean {\n    return this.twitchClient?.isConnected() || false;\n  }\n}\n","import { DebugSystem } from '../debug/DebugSystem.js';\nimport type { GameEngine } from '../game/GameEngine.js';\n\n/**\n * UI Manager - Handles all UI setup (Debug Panel, Config Panel, Help System, Tooltips)\n */\nexport class UIManager {\n  debugSystem: DebugSystem | null;\n  gameEngine: GameEngine | null;\n\n  constructor() {\n    this.debugSystem = null;\n    this.gameEngine = null;\n  }\n\n  setDebugSystem(debugSystem: DebugSystem): void {\n    this.debugSystem = debugSystem;\n  }\n\n  setGameEngine(gameEngine: GameEngine): void {\n    this.gameEngine = gameEngine;\n  }\n\n  setupUI(channelName: string, gameMode: string): void {\n    // Update UI elements with current settings\n    const channelInput = document.getElementById('channelName') as HTMLInputElement | null;\n    if (channelInput) {\n      channelInput.value = channelName;\n    }\n\n    const gameModeSelect = document.getElementById('gameMode') as HTMLSelectElement | null;\n    if (gameModeSelect) {\n      gameModeSelect.value = gameMode;\n    }\n\n    // Add tooltips\n    this.addTooltips();\n\n    // Setup config panel toggle\n    this.setupConfigPanel();\n\n    // Initialize help system\n    this.setupHelpSystem();\n\n    // Setup debug panel\n    this.setupDebugPanel();\n  }\n\n  addTooltips(): void {\n    const commands = document.querySelectorAll('.command');\n    commands.forEach(command => {\n      const code = command.querySelector('code');\n      if (code) {\n        const tooltip = this.createTooltip(this.getCommandDescription(code.textContent || ''));\n        command.appendChild(tooltip);\n      }\n    });\n  }\n\n  createTooltip(text: string): HTMLElement {\n    const tooltip = document.createElement('div');\n    tooltip.className = 'tooltip';\n    tooltip.textContent = text;\n    tooltip.style.cssText = `\n      position: absolute;\n      background: rgba(0, 0, 0, 0.9);\n      color: white;\n      padding: 5px 10px;\n      border-radius: 4px;\n      font-size: 0.8em;\n      white-space: nowrap;\n      z-index: 1000;\n      opacity: 0;\n      pointer-events: none;\n      transition: opacity 0.2s;\n      bottom: 100%;\n      left: 50%;\n      transform: translateX(-50%);\n    `;\n    return tooltip;\n  }\n\n  getCommandDescription(command: string): string {\n    const descriptions: Record<string, string> = {\n      'Einfach chatten!': 'Jede Chat-Nachricht bringt dich automatisch ins Spiel',\n      'Mehr chatten = st√§rker!': 'Je aktiver du bist, desto st√§rker wirst du',\n      '!defend': 'Aktiviere Verteidigung f√ºr 5 Sekunden',\n      '!power': 'Lade deine Spezialattacke auf (max. 3x)',\n      '!heal': 'Heile dich selbst (begrenzt verf√ºgbar)'\n    };\n    return descriptions[command] || 'Automatisches Kampfsystem';\n  }\n\n  setupConfigPanel(): void {\n    const configPanel = document.getElementById('configPanel');\n    if (!configPanel) return;\n\n    // Add minimize/maximize functionality\n    const header = document.createElement('div');\n    header.className = 'config-header';\n    header.innerHTML = `\n      <h3>Konfiguration</h3>\n      <button class=\"minimize-btn\">+</button>\n    `;\n    header.style.cssText = `\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n    `;\n\n    const minimizeBtn = header.querySelector('.minimize-btn') as HTMLButtonElement | null;\n    if (!minimizeBtn) return;\n    minimizeBtn.style.cssText = `\n      background: none;\n      border: 1px solid rgba(255, 255, 255, 0.3);\n      color: white;\n      width: 25px;\n      height: 25px;\n      border-radius: 50%;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    `;\n\n    const existingH3 = configPanel.querySelector('h3');\n    if (existingH3) {\n      existingH3.remove();\n    }\n\n    configPanel.insertBefore(header, configPanel.firstChild);\n\n    // Start with config panel collapsed\n    let isMinimized = true;\n    const sections = configPanel.querySelectorAll<HTMLElement>('.config-section');\n    sections.forEach(section => {\n      section.style.display = 'none';\n    });\n\n    minimizeBtn.addEventListener('click', () => {\n      isMinimized = !isMinimized;\n      const sections = configPanel.querySelectorAll<HTMLElement>('.config-section');\n      sections.forEach(section => {\n        section.style.display = isMinimized ? 'none' : 'block';\n      });\n      minimizeBtn.textContent = isMinimized ? '+' : '‚àí';\n    });\n  }\n\n  setupHelpSystem(): void {\n    // Add help button\n    const helpBtn = document.createElement('button');\n    helpBtn.textContent = '?';\n    helpBtn.className = 'help-btn';\n    helpBtn.style.cssText = `\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      width: 40px;\n      height: 40px;\n      border-radius: 50%;\n      background: linear-gradient(45deg, #4ecdc4, #45b7d1);\n      border: none;\n      color: white;\n      font-size: 1.2em;\n      font-weight: bold;\n      cursor: pointer;\n      z-index: 1000;\n      transition: all 0.3s ease;\n    `;\n\n    helpBtn.addEventListener('click', () => this.showHelp());\n    document.body.appendChild(helpBtn);\n  }\n\n  showHelp(): void {\n    const helpModal = document.createElement('div');\n    helpModal.className = 'help-modal';\n    helpModal.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0.8);\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      z-index: 10000;\n    `;\n\n    const helpContent = document.createElement('div');\n    helpContent.className = 'help-content';\n    helpContent.style.cssText = `\n      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);\n      border: 1px solid rgba(255, 255, 255, 0.2);\n      border-radius: 15px;\n      padding: 30px;\n      max-width: 600px;\n      max-height: 80vh;\n      overflow-y: auto;\n      color: white;\n      font-family: 'Orbitron', monospace;\n    `;\n\n    helpContent.innerHTML = `\n      <h2 style=\"color: #4ecdc4; margin-bottom: 20px;\">üéÆ Stream AFK Game - Hilfe</h2>\n      \n      <h3 style=\"color: #ff6b6b; margin-bottom: 10px;\">Wie es funktioniert:</h3>\n      <ul style=\"margin-bottom: 20px;\">\n        <li><strong>Einfach chatten!</strong> - Jede Nachricht bringt dich automatisch ins Spiel</li>\n        <li><strong>Keine Befehle n√∂tig</strong> - Das System macht alles automatisch</li>\n        <li><strong>Mehr Aktivit√§t = St√§rker</strong> - Je mehr du chattest, desto st√§rker wirst du</li>\n        <li><strong>Automatische K√§mpfe</strong> - Spieler greifen sich automatisch an</li>\n        <li><strong>Zuf√§llige Events</strong> - √úberraschende Boni und Events</li>\n      </ul>\n      \n      <h3 style=\"color: #ff6b6b; margin-bottom: 10px;\">Optionale Befehle:</h3>\n      <ul style=\"margin-bottom: 20px;\">\n        <li><code>!defend</code> - Aktiviere Verteidigung (10 Sek.)</li>\n        <li><code>!power</code> - Lade Spezialattacke auf</li>\n        <li><code>!heal</code> - Heile dich (begrenzt verf√ºgbar)</li>\n        <li><code>!stats</code> - Zeige deine Statistiken</li>\n      </ul>\n      \n      <h3 style=\"color: #ff6b6b; margin-bottom: 10px;\">Features:</h3>\n      <ul style=\"margin-bottom: 20px;\">\n        <li>‚ú® Automatisches Kampfsystem</li>\n        <li>üéØ Zuf√§llige Angriffe auf andere Spieler</li>\n        <li>üéÅ Aktivit√§ts-Boni f√ºr Chat-Teilnahme</li>\n        <li>üåü Zuf√§llige Events und √úberraschungen</li>\n        <li>üèÜ Echtzeit-Leaderboard</li>\n        <li>‚ö° Spektakul√§re Effekte</li>\n      </ul>\n      \n      <h3 style=\"color: #ff6b6b; margin-bottom: 10px;\">Tastenk√ºrzel:</h3>\n      <ul style=\"margin-bottom: 20px;\">\n        <li><code>Strg + G</code> - Spiel starten/stoppen</li>\n        <li><code>Strg + R</code> - Twitch-Verbindung neu starten</li>\n        <li><code>Strg + C</code> - Spiel zur√ºcksetzen</li>\n      </ul>\n      \n      <button id=\"closeHelp\" style=\"\n        background: linear-gradient(45deg, #4ecdc4, #45b7d1);\n        border: none;\n        color: white;\n        padding: 10px 20px;\n        border-radius: 8px;\n        cursor: pointer;\n        font-family: 'Orbitron', monospace;\n        font-weight: bold;\n        margin-top: 20px;\n      \">Schlie√üen</button>\n    `;\n\n    helpModal.appendChild(helpContent);\n    document.body.appendChild(helpModal);\n\n    // Close handlers\n    const closeBtn = helpContent.querySelector('#closeHelp');\n    closeBtn?.addEventListener('click', () => {\n      helpModal.remove();\n    });\n\n    helpModal.addEventListener('click', e => {\n      if (e.target === helpModal) {\n        helpModal.remove();\n      }\n    });\n  }\n\n  setupDebugPanel(): void {\n    // Create debug panel if it doesn't exist\n    let debugPanel = document.getElementById('debugPanel');\n    if (!debugPanel) {\n      debugPanel = document.createElement('div');\n      debugPanel.id = 'debugPanel';\n      debugPanel.style.cssText = `\n        position: fixed;\n        top: 10px;\n        left: 10px;\n        background: rgba(0, 0, 0, 0.9);\n        color: white;\n        padding: 15px;\n        border-radius: 8px;\n        z-index: 10000;\n        font-family: 'Courier New', monospace;\n        font-size: 12px;\n        max-width: 400px;\n        max-height: 80vh;\n        overflow-y: auto;\n        display: none;\n        border: 2px solid #ff4444;\n      `;\n      document.body.appendChild(debugPanel);\n    }\n\n    debugPanel.innerHTML = `\n      <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;\">\n        <h3 style=\"margin: 0; color: #ff4444;\">üîß Debug Panel</h3>\n        <button id=\"debugPanelClose\" style=\"background: #ff4444; border: none; color: white; padding: 5px 10px; border-radius: 4px; cursor: pointer;\">√ó</button>\n      </div>\n      <div style=\"display: flex; flex-direction: column; gap: 10px;\">\n        <button id=\"debugSpawn1\" class=\"debug-btn\">Spawn 1 Player</button>\n        <button id=\"debugSpawn3\" class=\"debug-btn\">Spawn 3 Players</button>\n        <button id=\"debugSpawn5\" class=\"debug-btn\">Spawn 5 Players (2 Aggressive)</button>\n        <button id=\"debugNextWave\" class=\"debug-btn\">Force Next Wave</button>\n        <button id=\"debugAttack\" class=\"debug-btn\">Test Attack</button>\n        <button id=\"debugKill\" class=\"debug-btn\">Kill Random Player</button>\n        <button id=\"debugClear\" class=\"debug-btn\">Clear All Players</button>\n        <hr style=\"border-color: #444; margin: 10px 0;\">\n        <div style=\"font-size: 10px; color: #aaa;\">\n          <strong>Shortcuts:</strong><br>\n          Ctrl+D: Toggle Panel<br>\n          1: Spawn 1 Player<br>\n          2: Spawn 3 Players<br>\n          3: Spawn 5 Players<br>\n          4: Next Wave<br>\n          5: Test Attack<br>\n          6: Kill Player<br>\n        </div>\n      </div>\n    `;\n\n    // Add button styles\n    const style = document.createElement('style');\n    style.textContent = `\n      .debug-btn {\n        background: #333;\n        border: 1px solid #555;\n        color: white;\n        padding: 8px 12px;\n        border-radius: 4px;\n        cursor: pointer;\n        font-size: 12px;\n      }\n      .debug-btn:hover {\n        background: #444;\n        border-color: #ff4444;\n      }\n    `;\n    document.head.appendChild(style);\n\n    // Event listeners\n    document.getElementById('debugPanelClose')?.addEventListener('click', () => {\n      this.toggleDebugPanel();\n    });\n\n    document.getElementById('debugSpawn1')?.addEventListener('click', () => {\n      this.debugSystem?.spawnTestPlayer();\n    });\n\n    document.getElementById('debugSpawn3')?.addEventListener('click', () => {\n      this.debugSystem?.spawnMultipleTestPlayers(3);\n    });\n\n    document.getElementById('debugSpawn5')?.addEventListener('click', () => {\n      this.debugSystem?.spawnMultipleTestPlayers(5, 2);\n    });\n\n    document.getElementById('debugNextWave')?.addEventListener('click', () => {\n      this.debugSystem?.forceNextWave();\n    });\n\n    document.getElementById('debugAttack')?.addEventListener('click', () => {\n      const players = this.debugSystem?.getAllPlayers();\n      if (players && players.length > 0) {\n        const firstPlayer = players[0];\n        this.debugSystem?.executeTestCommand(\n          'attack',\n          firstPlayer.id,\n          players.length > 1 ? players[1].id : undefined\n        );\n      }\n    });\n\n    document.getElementById('debugKill')?.addEventListener('click', () => {\n      // Kill random alive player (no ID needed)\n      this.debugSystem?.killPlayer();\n    });\n\n    document.getElementById('debugClear')?.addEventListener('click', () => {\n      this.debugSystem?.clearAllPlayers();\n    });\n  }\n\n  toggleDebugPanel(): void {\n    const debugPanel = document.getElementById('debugPanel');\n    if (debugPanel) {\n      const isVisible = debugPanel.style.display !== 'none';\n      debugPanel.style.display = isVisible ? 'none' : 'block';\n    }\n  }\n\n  handleDebugShortcuts(e: KeyboardEvent): void {\n    if (!this.debugSystem?.isDebugMode) return;\n\n    // Ctrl+D for debug panel toggle\n    if (e.ctrlKey && e.key === 'd') {\n      e.preventDefault();\n      this.toggleDebugPanel();\n      return;\n    }\n\n    // Number keys for quick actions (only if not typing in input)\n    if (!(e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement)) {\n      switch (e.key) {\n        case '1':\n          e.preventDefault();\n          this.debugSystem?.spawnTestPlayer();\n          break;\n        case '2':\n          e.preventDefault();\n          this.debugSystem?.spawnMultipleTestPlayers(3);\n          break;\n        case '3':\n          e.preventDefault();\n          this.debugSystem?.spawnMultipleTestPlayers(5, 2);\n          break;\n        case '4':\n          e.preventDefault();\n          this.debugSystem?.forceNextWave();\n          break;\n        case '5': {\n          e.preventDefault();\n          const players = this.debugSystem?.getAllPlayers();\n          if (players && players.length > 0) {\n            const firstPlayer = players[0];\n            this.debugSystem?.executeTestCommand(\n              'attack',\n              firstPlayer.id,\n              players.length > 1 ? players[1].id : undefined\n            );\n          }\n          break;\n        }\n        case '6':\n          e.preventDefault();\n          // Kill random alive player (no ID needed)\n          this.debugSystem?.killPlayer();\n          break;\n      }\n    }\n  }\n}\n","import { GameEngine } from './game/GameEngine.js';\nimport { EffectsManager } from './effects/index.js';\nimport { DebugSystem } from './debug/DebugSystem.js';\nimport { NotificationManager } from './utils/NotificationManager.js';\nimport { SettingsManager, type AppSettings } from './utils/SettingsManager.js';\nimport { TwitchIntegration } from './integration/TwitchIntegration.js';\nimport { UIManager } from './ui/UIManager.js';\nimport type { Character } from './game/entities/Character.js';\nimport type { MessageData } from './twitchClient.js';\n\n/**\n * Main application entry point\n * Orchestrates all components and manages application lifecycle\n */\nclass StreamAFKGame {\n  // Core systems\n  gameEngine: GameEngine | null;\n  effectsManager: EffectsManager | null;\n  debugSystem: DebugSystem | null;\n\n  // Manager classes\n  notificationManager: NotificationManager;\n  settingsManager: SettingsManager;\n  twitchIntegration: TwitchIntegration | null;\n  uiManager: UIManager;\n\n  // State\n  isInitialized: boolean;\n  settings: AppSettings;\n\n  constructor() {\n    // Initialize managers\n    this.notificationManager = new NotificationManager();\n    this.settingsManager = new SettingsManager();\n    this.uiManager = new UIManager();\n\n    // Initialize systems (will be set in initializeApp)\n    this.gameEngine = null;\n    this.effectsManager = null;\n    this.debugSystem = new DebugSystem();\n    this.twitchIntegration = null;\n\n    // Initialize state\n    this.isInitialized = false;\n    this.settings = this.settingsManager.loadSettings();\n\n    // Start initialization\n    this.initializeApp();\n  }\n\n  async initializeApp(): Promise<void> {\n    console.log('Initializing Stream AFK Game...');\n\n    try {\n      // Initialize core components\n      this.gameEngine = new GameEngine();\n      this.effectsManager = new EffectsManager();\n\n      // Initialize debug system\n      this.debugSystem.setGameEngine(this.gameEngine);\n      this.debugSystem.enableDebugMode();\n\n      // Initialize UI manager\n      this.uiManager.setDebugSystem(this.debugSystem);\n      this.uiManager.setGameEngine(this.gameEngine);\n\n      // Make managers globally available\n      window.effectsManager = this.effectsManager;\n      window.debugSystem = this.debugSystem;\n\n      // Check code version and show notification if changed\n      const versionChanged = this.settingsManager.checkCodeVersion();\n      if (versionChanged) {\n        this.notificationManager.showNotification(\n          'Code aktualisiert - Einstellungen zur√ºckgesetzt!',\n          'info'\n        );\n      }\n\n      // Setup event listeners\n      this.setupEventListeners();\n\n      // Initialize Twitch integration\n      this.initializeTwitchIntegration();\n\n      // Setup UI\n      this.uiManager.setupUI(this.settings.channelName, this.settings.gameMode);\n\n      this.isInitialized = true;\n      console.log('Stream AFK Game initialized successfully!');\n      console.log('Current settings:', this.settings);\n    } catch (error) {\n      console.error('Failed to initialize game:', error);\n      this.notificationManager.showError(\n        'Fehler beim Initialisieren des Spiels: ' + (error as Error).message\n      );\n    }\n  }\n\n  initializeTwitchIntegration(): void {\n    this.twitchIntegration = new TwitchIntegration(this.settings);\n\n    this.twitchIntegration.initialize(\n      // onConnected\n      () => {\n        console.log('Connected to Twitch chat');\n        this.notificationManager.showNotification('Verbunden mit Twitch Chat!', 'success');\n\n        // Auto-start game after successful Twitch connection\n        if (this.settings.autoStart && this.isInitialized) {\n          console.log('Auto-starting game after Twitch connection...');\n          setTimeout(() => {\n            this.startGame();\n          }, 1000);\n        }\n      },\n      // onMessage\n      (messageData: MessageData) => {\n        if (this.gameEngine) {\n          this.twitchIntegration?.handleMessage(messageData, this.gameEngine);\n        }\n      },\n      // onConnectionFailed\n      () => {\n        console.error('Failed to connect to Twitch');\n        this.notificationManager.showError(\n          'Verbindung zu Twitch fehlgeschlagen. Versuche es sp√§ter erneut.'\n        );\n      }\n    );\n  }\n\n  setupEventListeners(): void {\n    // Start/Stop game buttons\n    const startBtn = document.getElementById('startGame');\n    const stopBtn = document.getElementById('stopGame');\n\n    startBtn?.addEventListener('click', () => this.startGame());\n    stopBtn?.addEventListener('click', () => this.stopGame());\n\n    // Channel name input\n    const channelInput = document.getElementById('channelName') as HTMLInputElement | null;\n    channelInput?.addEventListener('change', e => {\n      const target = e.target as HTMLInputElement;\n      this.settings.channelName = target.value;\n      this.settingsManager.saveSettings(this.settings);\n      this.reconnectTwitch();\n    });\n\n    // Game mode selector\n    const gameModeSelect = document.getElementById('gameMode');\n    gameModeSelect?.addEventListener('change', e => {\n      const target = e.target as HTMLSelectElement;\n      this.settings.gameMode = target.value;\n      if (this.gameEngine) {\n        this.gameEngine.gameMode = target.value;\n      }\n      this.settingsManager.saveSettings(this.settings);\n    });\n\n    // Keyboard shortcuts\n    document.addEventListener('keydown', e => {\n      // Debug shortcuts (only in debug mode)\n      if (this.debugSystem?.isDebugMode) {\n        this.uiManager.handleDebugShortcuts(e);\n      }\n\n      // Main shortcuts\n      if (e.ctrlKey) {\n        switch (e.key) {\n          case 'g':\n            e.preventDefault();\n            if (this.gameEngine?.isRunning) {\n              this.stopGame();\n            } else {\n              this.startGame();\n            }\n            break;\n          case 'r':\n            e.preventDefault();\n            this.reconnectTwitch();\n            break;\n          case 'c':\n            e.preventDefault();\n            this.clearGame();\n            break;\n        }\n      }\n    });\n\n    // Window events\n    window.addEventListener('beforeunload', () => {\n      this.cleanup();\n    });\n\n    window.addEventListener('resize', () => {\n      this.handleResize();\n    });\n  }\n\n  startGame(): void {\n    if (!this.isInitialized) {\n      this.notificationManager.showError('Spiel noch nicht initialisiert');\n      return;\n    }\n\n    if (!this.twitchIntegration?.isConnected()) {\n      this.notificationManager.showError('Nicht mit Twitch verbunden');\n      return;\n    }\n\n    this.gameEngine?.startGame();\n    this.notificationManager.showNotification('Spiel gestartet!', 'success');\n\n    // Update UI\n    const startBtn = document.getElementById('startGame') as HTMLButtonElement | null;\n    const stopBtn = document.getElementById('stopGame') as HTMLButtonElement | null;\n\n    if (startBtn) {\n      startBtn.disabled = true;\n    }\n    if (stopBtn) {\n      stopBtn.disabled = false;\n    }\n  }\n\n  stopGame(): void {\n    if (!this.isInitialized) return;\n\n    this.gameEngine?.stopGame();\n    this.notificationManager.showNotification('Spiel gestoppt!', 'info');\n\n    // Update UI\n    const startBtn = document.getElementById('startGame') as HTMLButtonElement | null;\n    const stopBtn = document.getElementById('stopGame') as HTMLButtonElement | null;\n\n    if (startBtn) {\n      startBtn.disabled = false;\n    }\n    if (stopBtn) {\n      stopBtn.disabled = true;\n    }\n  }\n\n  clearGame(): void {\n    if (!this.isInitialized || !this.gameEngine) return;\n\n    this.gameEngine.players.clear();\n    this.gameEngine.renderSystem.clearBattlefield();\n    this.gameEngine.currentWave = 1;\n    this.gameEngine.waveSystem.updateWaveDisplay();\n    this.gameEngine.updateActiveViewers();\n    this.gameEngine.updateLeaderboard();\n\n    // Clear action feed\n    const actionFeed = document.getElementById('actionFeed');\n    if (actionFeed) {\n      actionFeed.innerHTML = '';\n    }\n\n    this.notificationManager.showNotification('Spiel zur√ºckgesetzt!', 'info');\n  }\n\n  reconnectTwitch(): void {\n    if (!this.twitchIntegration) return;\n\n    this.notificationManager.showNotification('Verbindung wird neu aufgebaut...', 'info');\n    this.twitchIntegration.changeChannel(this.settings.channelName);\n  }\n\n  handleResize(): void {\n    // Adjust game elements for new window size\n    if (this.gameEngine?.players) {\n      this.gameEngine.players.forEach(player => {\n        if (player.element) {\n          player.position = player.generateRandomPosition();\n          player.element.style.left = player.position.x + 'px';\n          player.element.style.top = player.position.y + 'px';\n        }\n      });\n    }\n  }\n\n  cleanup(): void {\n    this.twitchIntegration?.disconnect();\n    this.gameEngine?.stopGame();\n    this.settingsManager.saveSettings(this.settings);\n  }\n\n  // Public API methods\n  getGameStats(): ReturnType<GameEngine['getGameStats']> | null {\n    return this.gameEngine ? this.gameEngine.getGameStats() : null;\n  }\n\n  getActivePlayers(): Character[] {\n    return this.gameEngine ? Array.from(this.gameEngine.players.values()) : [];\n  }\n\n  isGameRunning(): boolean {\n    return this.gameEngine ? this.gameEngine.isRunning : false;\n  }\n}\n\n// Initialize the game when the page loads\ndocument.addEventListener('DOMContentLoaded', () => {\n  console.log('DOM loaded, initializing game...');\n\n  // Add CSS animations\n  const style = document.createElement('style');\n  style.textContent = `\n    @keyframes slideIn {\n      from { transform: translateX(100%); opacity: 0; }\n      to { transform: translateX(0); opacity: 1; }\n    }\n    \n    @keyframes slideOut {\n      from { transform: translateX(0); opacity: 1; }\n      to { transform: translateX(100%); opacity: 0; }\n    }\n    \n    @keyframes shockwaveHitPulse {\n      0% {\n        transform: scale(0.8);\n        opacity: 1;\n      }\n      50% {\n        transform: scale(1.2);\n        opacity: 0.8;\n      }\n      100% {\n        transform: scale(1.5);\n        opacity: 0;\n      }\n    }\n    \n    .command:hover .tooltip {\n      opacity: 1 !important;\n    }\n  `;\n  document.head.appendChild(style);\n\n  // Initialize the game\n  window.streamAFKGame = new StreamAFKGame();\n});\n\nexport { StreamAFKGame };\n"],"names":["EventSystem","__publicField","eventType","handler","handlers","index","data","error","players","events","event","playerArray","player","_players","rect","funMessages","randomMessage","RenderSystem","avatar","enemy","emojiPawn","healthBar","healthFill","element","emojiElement","healthPercent","displayText","borderStyle","color","statusBar","remainingHeals","powerCharge","nameLabel","title","healthPercentage","playerAvatar","playerId","newPos","battlefieldRect","playerName","hash","borderTypes","borderColors","typeIndex","colorIndex","str","i","char","num","amt","R","G","B","announcement","playerRect","posX","posY","clampedPosX","PawnTag","Pawn","id","displayName","maxHealth","tag","tags","eventSystem","colors","battlefield","margin","newPosition","damage","attacker","actualDamage","wasKilled","incomingDamage","_attacker","amount","oldHealth","CombatSystem","settings","gameEngine","target","messageData","isPowerAttack","attackerCharacter","powerChargeBefore","targetCharacter","result","getAllPawns","isAggressivePlayer","explosionPosition","hitPawns","radius","hitPosition","allPawns","shockwaveDamage","pawn","distance","distanceRatio","defender","counterDamage","now","attackResults","attackDelay","entity","allEntities","validTargetTags","possibleTargets","priorityOrder","targetsWithTag","t","charEntity","aggressiveness","baseInterval","activityBonus","personalityBonus","gameContainer","callback","results","WaveSystem","alivePlayers","aliveEnemies","shouldUse5sInterval","currentlyUsing5sInterval","timeRemaining","elapsed","waveInfo","waveInterval","waveElement","timerElement","secondsRemaining","newTime","UISystem","playerCount","aiCount","sortedPlayers","a","b","item","rank","name","score","message","type","actionItem","items","topPlayers","topPlayersHTML","banner","countdown","countdownInterval","bananaCount","banana","duration","notification","isConnected","statusElement","dot","text","stats","statsMessage","playerElement","Component","ComponentContainer","component","entityToSet","componentType","deltaTime","Character","warriorClasses","tankClasses","rogueClasses","baseDamage","usePower","activityMultiplier","powerUsed","hasPowerToUse","powerChargeAfter","power","points","effectType","timeout","AutoCombat","config","_deltaTime","targetWithHealth","validTargets","isSelf","isAlive","isEnemy","priorityTag","personality","combinedAggressiveness","randomVariation","nextInterval","pawns","emoji","newConfig","Player","partialData","tempPawn","autoCombat","JoinCommand","context","DefendCommand","commandHandler","cooldown","lastDefendCommand","remaining","PowerCommand","lastPowerCommand","HealCommand","lastHealCommand","healAmount","StatsCommand","EmojiPawn","size","behavior","targets","offset","closest","dist","closestDist","dx","dy","moveX","moveY","targetPos","characterAttacker","_MonkeyEmojiPawn","baseHealth","customTags","MonkeyEmojiPawn","_BananaEmojiPawn","BananaEmojiPawn","BananaCommand","monkeyCount","monkey","p","randomOffset","originalPos","ActivityCommand","bonusChance","bonusType","personalityDelay","randomDelay","totalDelay","getCommands","getCommandRegistry","commands","COMMANDS","getCommand","commandName","hasCommand","getAllCommandNames","executeCommand","targetId","CommandClass","CommandRegistry","CommandHandler","command","commandContext","_AIEnemy","waveNumber","enemyType","enemyData","randomName","randomColor","waveMultiplier","typeWeights","selectedType","enemyId","playerTargets","aiBonus","_usePower","AIEnemy","GameEngine","actionData","elimData","deathData","bananaData","chaosData","waveData","healthData","_data","allCharacters","victim","killer","killerText","victimText","pointsText","currentNextWaveTime","_player","oldChance","targetEnemyCount","currentEnemyCount","enemiesToSpawn","_results","count","emojiPawnId","aliveAI","e","survivingPlayers","newPlayer","top","Particle","x","y","options","opacity","ParticleSystem","particle","centerX","centerY","angle","velocity","position","speed","SoundSystem","oscillator","gainNode","soundName","volume","enabled","EffectsManager","animate","animation","isCounterAttack","onHit","beam","startPosition","maxRadius","expansionDuration","startTime","hitCheckInterval","lastHitCheck","shockwave","hitCallback","currentTime","progress","currentRadius","diameter","hitEffect","source","sourceRect","targetRect","startX","startY","endX","endY","originalTransform","resolve","glow","shield","charge","flash","beamLeft","beamTop","beamWidth","angleMatch","particleCount","perpAngle","perpX","perpY","spreadAngle","beams","DebugSystem","aggressive","aggressiveCount","playerIds","isAggressive","NotificationManager","topOffset","newTop","SettingsManager","saved","keysToRemove","key","TwitchClient","channelName","rawMessage","match","username","userInfo","tagsMatch","tagString","value","connected","statusDot","statusText","newChannel","TwitchIntegration","onConnected","onMessage","onConnectionFailed","UIManager","debugSystem","gameMode","channelInput","gameModeSelect","code","tooltip","configPanel","header","minimizeBtn","existingH3","isMinimized","section","helpBtn","helpModal","helpContent","debugPanel","style","firstPlayer","isVisible","StreamAFKGame","startBtn","stopBtn","actionFeed"],"mappings":"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"}